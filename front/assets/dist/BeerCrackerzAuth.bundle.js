!function(){"use strict";var e={d:function(t,n){for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t={};e.d(t,{default:function(){return w}});var n=Object.freeze({blue:new window.L.Icon({iconUrl:"assets/img/marker/marker-icon-blue.png",shadowUrl:"assets/img/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),gold:new window.L.Icon({iconUrl:"assets/img/marker/marker-icon-gold.png",shadowUrl:"assets/img/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),red:new window.L.Icon({iconUrl:"assets/img/marker/marker-icon-red.png",shadowUrl:"assets/img/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),green:new window.L.Icon({iconUrl:"assets/img/marker/marker-icon-green.png",shadowUrl:"assets/img/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),orange:new window.L.Icon({iconUrl:"assets/img/marker/marker-icon-orange.png",shadowUrl:"assets/img/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),yellow:new window.L.Icon({iconUrl:"assets/img/marker/marker-icon-yellow.png",shadowUrl:"assets/img/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),violet:new window.L.Icon({iconUrl:"assets/img/marker/marker-icon-violet.png",shadowUrl:"assets/img/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),grey:new window.L.Icon({iconUrl:"assets/img/marker/marker-icon-grey.png",shadowUrl:"assets/img/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),black:new window.L.Icon({iconUrl:"assets/img/marker/marker-icon-black.png",shadowUrl:"assets/img/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),user:new window.L.Icon({iconUrl:"assets/img/marker/user-position.png",shadowUrl:"assets/img/marker/user-position-shadow.png",iconSize:[32,32],iconAnchor:[16,16],popupAnchor:[1,-34],shadowSize:[32,32]})});function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._container=null,this._items=[],this._currentRate=n||0,this._clicked=n||-1,this._init(t),this._events()}var t,n;return t=e,(n=[{key:"_init",value:function(e){this._container=e;for(var t=0;t<e.children.length;++t)this._items.push(e.children[t]);for(var n=0;n<this._currentRate+1;++n)this._items[n].classList.add("active"),this._items[n].classList.add("selected")}},{key:"_events",value:function(){this._container.addEventListener("mouseover",this._containerHovered.bind(this),!1),this._container.addEventListener("mouseout",this._pointerExit.bind(this),!1);for(var e=0;e<this._items.length;++e)this._items[e].addEventListener("click",this._starClicked.bind(this),!1)}},{key:"_containerHovered",value:function(e){"IMG"===e.target.tagName&&(this._currentRate=parseInt(e.target.dataset.id),this._container.dataset.rate=this._currentRate,this.updateStars())}},{key:"_pointerExit",value:function(){this._currentRate=-1===this._clicked?0:this._clicked,this._container.dataset.rate=this._currentRate,this.updateStars()}},{key:"_starClicked",value:function(e){this._currentRate=parseInt(e.target.dataset.id),this._container.dataset.rate=this._currentRate,this._clicked=this._currentRate,this.updateStars()}},{key:"updateStars",value:function(){for(var e=0;e<this._items.length;++e)e<=this._currentRate?(this._items[e].classList.add("active"),e<=this._clicked&&this._items[e].classList.add("selected")):(this._items[e].classList.remove("active"),this._items[e].classList.remove("selected"))}},{key:"currentRate",get:function(){return this._currentRate}}])&&r(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,n=[{key:"fetchTemplate",value:function(e){return new Promise((function(t,n){fetch(e).then((function(e){e.text().then((function(e){t(document.createRange().createContextualFragment(e))})).catch(n)})).catch(n)}))}},{key:"fetchFile",value:function(e){return new Promise((function(t,n){fetch(e).then((function(e){e.text().then(t).catch(n)})).catch(n)}))}},{key:"getReq",value:function(e){return new Promise((function(t,n){var r={method:"GET",headers:new Headers,mode:"cors",cache:"default",url:"http://localhost:8000"};fetch(e,r).then((function(e){e.json().then(t).catch(n)})).catch(n)}))}},{key:"postReq",value:function(e,t){return new Promise((function(n,r){var o={method:"POST",headers:new Headers,mode:"cors",cache:"default",body:t};fetch(e,o).then((function(e){e.json().then(n).catch(r)})).catch(r)}))}},{key:"stripDom",value:function(e){return(new DOMParser).parseFromString(e,"text/html").body.textContent||""}},{key:"replaceString",value:function(e,t,n){e.innerHTML=e.innerHTML.replace(t,n)}},{key:"getDistanceBetweenCoords",value:function(e,t){var n=e[1]*Math.PI/180,r=e[0]*Math.PI/180,o=t[1]*Math.PI/180,a=t[0]*Math.PI/180,i=a-r,s=o-n,c=Math.pow(Math.sin(i/2),2)+Math.cos(r)*Math.cos(a)*Math.pow(Math.sin(s/2),2);return 2*Math.asin(Math.sqrt(c))*6371*1e3}},{key:"precisionRound",value:function(e,t){var n=Math.pow(10,t||0);return Math.round(e*n)/n}},{key:"initDebugInterface",value:function(){var e=window.BeerCrackerz.nls.debug.bind(window.BeerCrackerz.nls),t=document.createElement("DIV"),n=document.createElement("P"),r=document.createElement("P"),o=document.createElement("P"),a=document.createElement("P"),i=document.createElement("P"),s=document.createElement("P"),c=document.createElement("P"),l=document.createElement("P"),u=document.createElement("P"),d=document.createElement("BUTTON");return t.classList.add("debug-container"),n.classList.add("debug-user-lat"),r.classList.add("debug-user-lng"),o.classList.add("debug-updates-amount"),a.classList.add("debug-user-accuracy"),i.classList.add("debug-high-accuracy"),s.classList.add("debug-pos-max-age"),c.classList.add("debug-pos-timeout"),l.classList.add("debug-zoom-level"),u.classList.add("debug-marks-amount"),d.classList.add("debug-export-data"),n.innerHTML="<b>".concat(e("lat"),"</b> : -"),r.innerHTML="<b>".concat(e("lng"),"</b> : -"),o.innerHTML="<b>".concat(e("updates"),"</b> : 0"),a.innerHTML="<b>".concat(e("accuracy"),"</b> : -"),i.innerHTML="<b>".concat(e("highAccuracy"),"</b> : -"),s.innerHTML="<b>".concat(e("posAge"),"</b> : -"),c.innerHTML="<b>".concat(e("posTimeout"),"</b> : -"),l.innerHTML="<b>".concat(e("zoom"),"</b> : -"),u.innerHTML="<b>".concat(e("marks"),"</b> : -"),d.innerHTML=e("export"),t.appendChild(n),t.appendChild(r),t.appendChild(o),t.appendChild(a),t.appendChild(i),t.appendChild(s),t.appendChild(c),t.appendChild(l),t.appendChild(u),t.appendChild(d),d.addEventListener("click",window.BeerCrackerz.downloadData.bind(window.BeerCrackerz)),t}},{key:"updateDebugInterface",value:function(t,n,r){if(!0===window.DEBUG){var o=window.BeerCrackerz,a=o.nls.debug.bind(o.nls),i=parseInt(t.querySelector(".debug-updates-amount").innerHTML.split(" : ")[1])+1,s=o.marks.spot.length+o.marks.store.length+o.marks.bar.length;t.querySelector(".debug-user-lat").innerHTML="\n        <b>".concat(a("lat"),"</b> : ").concat(n.lat,"\n      "),t.querySelector(".debug-user-lng").innerHTML="\n        <b>".concat(a("lng"),"</b> : ").concat(n.lng,"\n      "),t.querySelector(".debug-updates-amount").innerHTML="\n        <b>".concat(a("updates"),"</b> : ").concat(i,"\n      "),t.querySelector(".debug-user-accuracy").innerHTML="\n        <b>".concat(a("accuracy"),"</b> : ").concat(e.precisionRound(n.accuracy,2),"m\n      "),t.querySelector(".debug-high-accuracy").innerHTML="\n        <b>".concat(a("highAccuracy"),"</b> : ").concat(!0===r.enableHighAccuracy?a("enabled"):a("disabled"),"\n      "),t.querySelector(".debug-pos-max-age").innerHTML="\n        <b>".concat(a("posAge"),"</b> : ").concat(r.maximumAge/1e3,"s\n      "),t.querySelector(".debug-pos-timeout").innerHTML="\n        <b>".concat(a("posTimeout"),"</b> : ").concat(r.timeout/1e3,"s\n      "),t.querySelector(".debug-zoom-level").innerHTML="\n        <b>".concat(a("zoom"),"</b> : ").concat(o.map.getZoom(),"\n      "),t.querySelector(".debug-marks-amount").innerHTML="\n        <b>".concat(a("marks"),"</b> : ").concat(s,"\n      ")}}},{key:"getPoints",value:function(t){return new Promise((function(n){e.getReq("http://localhost:8000/".concat(t)).then(n)}))}},{key:"getSpots",value:function(){return new Promise((function(t){e.getPoints("spot").then(t)}))}},{key:"getStores",value:function(){return new Promise((function(t){e.getPoints("store").then(t)}))}},{key:"getBars",value:function(){return new Promise((function(t){e.getPoints("bar").then(t)}))}},{key:"getPreference",value:function(e){return localStorage.getItem(e)||null}},{key:"setPreference",value:function(e,t){localStorage.setItem(e,t)}},{key:"RANGE_COLOR",get:function(){return"#ffd87d"}},{key:"USER_COLOR",get:function(){return"#63fff5"}},{key:"SPOT_COLOR",get:function(){return"#26ad23"}},{key:"STORE_COLOR",get:function(){return"#247dc9"}},{key:"BAR_COLOR",get:function(){return"#ca2a3d"}},{key:"CIRCLE_RADIUS",get:function(){return 100}},{key:"NEW_MARKER_RANGE",get:function(){return 200}},{key:"MAP_BOUNDS",get:function(){return window.L.latLngBounds(window.L.latLng(-89.98155760646617,-180),window.L.latLng(89.99346179538875,180))}},{key:"HIGH_ACCURACY",get:function(){return{enableHighAccuracy:!0,maximumAge:1e3,timeout:900}}},{key:"OPTIMIZED_ACCURACY",get:function(){return{enableHighAccuracy:!1,maximumAge:3e4,timeout:29e3}}},{key:"SUPPORTED_LANGUAGE",get:function(){return["en","fr","es","de"]}}],null&&a(t.prototype,null),n&&a(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function s(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,(r=[{key:"placeMarker",value:function(e){var t=this,r=n.black;"store"===e.type?r=n.blue:"spot"===e.type?r=n.green:"bar"===e.type?r=n.red:"user"===e.type&&(r=n.user);var o=window.L.marker([e.lat,e.lng],{icon:r}).on("click",(function(){"true"===i.getPreference("map-center-on-user")&&t.toggleFocusLock(),t.map.flyTo([e.lat,e.lng],18)}));return e.dom&&o.bindPopup(e.dom),-1===["spot","store","bar"].indexOf(e.type)&&o.addTo(this.map),o}},{key:"drawUserMarker",value:function(){this.user.marker?(this.user.marker.setLatLng(this.user),this.user.range.setLatLng(this.user),this.user.circle.setLatLng(this.user),this.user.circle.setRadius(this.user.accuracy)):(this.user.type="user",this.user.marker=this.placeMarker(this.user),this.user.radius=this.user.accuracy,this.user.circle=this.drawCircle(this.user),this.user.range=this.drawCircle({lat:this.user.lat,lng:this.user.lng,radius:i.NEW_MARKER_RANGE,color:i.RANGE_COLOR}),"true"===i.getPreference("poi-show-circle")&&(this.user.circle.setStyle({opacity:1,fillOpacity:.1}),this.user.range.setStyle({opacity:1,fillOpacity:.1})),this.user.marker.on("click",this.mapClicked.bind(this)))}},{key:"definePOI",value:function(e,t){var n=this,r={wrapper:document.createElement("DIV"),title:document.createElement("P"),spot:document.createElement("BUTTON"),store:document.createElement("BUTTON"),bar:document.createElement("BUTTON")};r.wrapper.className="new-poi",r.title.innerHTML=this.nls.map("newTitle"),r.spot.innerHTML=this.nls.map("newSpot"),r.store.innerHTML=this.nls.map("newStore"),r.bar.innerHTML=this.nls.map("newBar"),r.spot.dataset.type="spot",r.store.dataset.type="store",r.bar.dataset.type="bar",r.wrapper.appendChild(r.title),r.wrapper.appendChild(r.spot),r.wrapper.appendChild(r.store),r.wrapper.appendChild(r.bar),e.dom=r.wrapper;var o=this.placeMarker(e).openPopup();e.marker=o,e.addedCallback=t;var a=function(t){o.isBeingDefined=!0,o.closePopup(),n.defineMarkFactory(t.target.dataset.type,e)};return r.spot.addEventListener("click",a),r.store.addEventListener("click",a),r.bar.addEventListener("click",a),o.on("popupclose",(function(){o.isBeingDefined||(o.popupClosed=!0,o.removeFrom(n.map))})),o}},{key:"defineMarkFactory",value:function(e,t){var n=this;i.fetchTemplate("assets/html/modal/new".concat(e,".html")).then((function(r){var a=r.querySelector("#".concat(e,"-name")),s=r.querySelector("#".concat(e,"-desc")),c=new o(r.querySelector("#".concat(e,"-rating"))),l=r.querySelector("#".concat(e,"-submit")),u=r.querySelector("#".concat(e,"-cancel")),d=r.querySelector("#modal-close");i.replaceString(r.querySelector("#nls-".concat(e,"-title")),"{{".concat(e.toUpperCase(),"_TITLE}}"),n.nls[e]("title")),i.replaceString(r.querySelector("#nls-".concat(e,"-subtitle")),"{{".concat(e.toUpperCase(),"_SUBTITLE}}"),n.nls[e]("subtitle")),i.replaceString(r.querySelector("#nls-".concat(e,"-name")),"{{".concat(e.toUpperCase(),"_NAME}}"),n.nls[e]("nameLabel")),i.replaceString(r.querySelector("#nls-".concat(e,"-desc")),"{{".concat(e.toUpperCase(),"_DESC}}"),n.nls[e]("descLabel")),i.replaceString(r.querySelector("#nls-".concat(e,"-rate")),"{{".concat(e.toUpperCase(),"_RATE}}"),n.nls[e]("rateLabel")),i.replaceString(l,"{{".concat(e.toUpperCase(),"_SUBMIT}}"),n.nls.nav("add")),i.replaceString(u,"{{".concat(e.toUpperCase(),"_CANCEL}}"),n.nls.nav("cancel"));var m=function(){t.marker.isBeingDefined=!1,t.marker.removeFrom(n.map),n.closeModal(null,!0)};l.addEventListener("click",(function(){""===a.value?n._notification.raise(n.nls.notif("markNameEmpty")):(m(),t.type=e,t.name=a.value,t.description=s.value,t.rate=c.currentRate,n.markPopupFactory(t).then((function(e){t.dom=e,t.marker=n.placeMarker(t),t.addedCallback(t)})))})),u.addEventListener("click",m),d.addEventListener("click",m),n.newMarkModal(r)}))}},{key:"defineNewSpot",value:function(e){this.defineMarkFactory("spot",e)}},{key:"defineNewStore",value:function(e){this.defineMarkFactory("store",e)}},{key:"defineNewBar",value:function(e){this.defineMarkFactory("bar",e)}},{key:"markPopupFactory",value:function(e){var t=this;return new Promise((function(n){i.fetchTemplate("assets/html/popup/".concat(e.type,".html")).then((function(r){var o=document.createElement("DIV");o.appendChild(r);var a=e.user||t.user.username,s=i.stripDom(e.description)||t.nls.popup("".concat(e.type,"NoDesc"));i.replaceString(o,"{{".concat(e.type.toUpperCase(),"_NAME}}"),i.stripDom(e.name)),i.replaceString(o,"{{".concat(e.type.toUpperCase(),"_FINDER}}"),a),i.replaceString(o,"{{".concat(e.type.toUpperCase(),"_RATE}}"),e.rate+1),i.replaceString(o,"{{".concat(e.type.toUpperCase(),"_DESC}}"),s),i.replaceString(o,"{{".concat(e.type.toUpperCase(),"_FOUND_BY}}"),t.nls.popup("".concat(e.type,"FoundBy")));for(var c=o.querySelector("#".concat(e.type,"-rating")),l=0;l<e.rate+1;++l)c.children[l].classList.add("active");i.getDistanceBetweenCoords([t.user.lat,t.user.lng],[e.lat,e.lng])>i.CIRCLE_RADIUS&&console.log("Too far"),a!==t.user.username?o.removeChild(o.querySelector("#popup-edit")):(o.querySelector("#edit-mark").addEventListener("click",t.editMarker.bind(t,e),!1),o.querySelector("#delete-mark").addEventListener("click",t.deleteMarker.bind(t,e),!1)),e.color=i["".concat(e.type.toUpperCase(),"_COLOR")],e.circle=t.drawCircle(e),e.tooltip=window.L.tooltip({permanent:!0,direction:"center",className:"marker-tooltip",interactive:!0}).setContent(e.name).setLatLng(e.circle.getLatLng()),"true"===i.getPreference("poi-marker-label")&&e.tooltip.addTo(t.map),n(o)}))}))}},{key:"drawCircle",value:function(e){return window.L.circle(e,{color:e.color,fillColor:e.color,opacity:0,fillOpacity:0,radius:e.radius?e.radius:i.CIRCLE_RADIUS}).addTo(this.map)}},{key:"setMarkerCircles",value:function(e,t){for(var n=0;n<e.length;++n)t?(e[n].circle.setStyle({opacity:1,fillOpacity:.1}),e[n].circle.addTo(this.map)):(e[n].circle.setStyle({opacity:0,fillOpacity:0}),e[n].circle.removeFrom(this.map))}},{key:"setMarkerLabels",value:function(e,t){for(var n=0;n<e.length;++n)t?e[n].tooltip.addTo(this.map):e[n].tooltip.removeFrom(this.map)}}])&&s(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),l=Object.freeze({planOsm:window.L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',maxZoom:21,maxNativeZoom:19,minZoom:2}),satEsri:window.L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:'&copy; <a href="https://www.arcgis.com/home/item.html?id=10df2279f9684e4a9f6a7f08febac2a9">Esri Imagery</a>',minZoom:2,maxNativeZoom:19,maxZoom:21})});function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var d=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._map=t,this._container=document.querySelector("#zoom-slider"),this._slider=document.querySelector("#slider-position"),this._zoomRange=this._map.getMaxZoom()-this._map.getMinZoom(),this._timeoutId=-1,this._events()}var t,n;return t=e,(n=[{key:"_events",value:function(){var e=this;this._map.on("zoomstart",(function(){clearTimeout(e._timeoutId),e._timeoutId=-1,e._container.classList.add("opened")})),this._map.on("zoomend",(function(){var t=e._map.getZoom()-e._map.getMinZoom();e._slider.style.height="".concat(100*t/e._zoomRange,"%"),e._timeoutId=setTimeout((function(){return e._container.classList.remove("opened")}),1500)})),this._map.on("zoom",(function(){clearTimeout(e._timeoutId),e._timeoutId=-1;var t=e._map.getZoom()-e._map.getMinZoom();e._slider.style.height="".concat(100*t/e._zoomRange,"%")})),this._container.addEventListener("mouseover",(function(){clearTimeout(e._timeoutId),e._timeoutId=-1})),this._container.addEventListener("mouseleave",(function(){e._timeoutId=setTimeout((function(){return e._container.classList.remove("opened")}),1500)})),this._container.querySelector("#zoom-more").addEventListener("click",(function(){e._map.setZoom(e._map.getZoom()+1)})),this._container.querySelector("#zoom-less").addEventListener("click",(function(){e._map.setZoom(e._map.getZoom()-1)}))}}])&&u(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function m(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var p=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._lang=-1!==i.SUPPORTED_LANGUAGE.indexOf(t)?t:"en",this._values={},this._init().then(n)}var t,n;return t=e,(n=[{key:"_init",value:function(){var e=this;return new Promise((function(t,n){i.fetchFile("assets/nls/".concat(e._lang,".json")).then((function(n){e._values=JSON.parse(n),t()})).catch(n)}))}},{key:"debug",value:function(e){return this._values.debug[e]||""}},{key:"notif",value:function(e){return this._values.notif[e]||""}},{key:"nav",value:function(e){return this._values.nav[e]||""}},{key:"map",value:function(e){return this._values.map[e]||""}},{key:"spot",value:function(e){return this._values.spot[e]||""}},{key:"store",value:function(e){return this._values.store[e]||""}},{key:"bar",value:function(e){return this._values.bar[e]||""}},{key:"popup",value:function(e){return this._values.popup[e]||""}},{key:"modal",value:function(e){return this._values.modal[e]||""}},{key:"login",value:function(e){return this._values.auth.login[e]||""}},{key:"register",value:function(e){return this._values.auth.register[e]||""}},{key:"forgotPassword",value:function(e){return this._values.auth.forgotPassword[e]||""}}])&&m(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var g=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._container=document.querySelector("#notification-wrapper"),this._message=document.querySelector("#notification-message"),this._timeoutId=null}var t,n;return t=e,(n=[{key:"raise",value:function(e){var t=this;clearTimeout(this._timeoutId),this._message.innerHTML=e,this._container.classList.add("opened"),this._timeoutId=setTimeout((function(){t._container.classList.remove("opened"),t._message.innerHTML=""}),2e3)}}])&&h(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function f(e){return f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f(e)}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _(e,t){return _=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},_(e,t)}function v(e,t){if(t&&("object"===f(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return b(e)}function b(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function k(e){return k=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},k(e)}var w=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&_(e,t)}(s,e);var t,n,r,o,a=(r=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=k(r);if(o){var n=k(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return v(this,e)});function s(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(e=a.call(this))._user={lat:48.853121540141096,lng:2.3498955769881156,accuracy:0,marker:null,circle:null,range:null,color:i.USER_COLOR,id:-1,username:""},e._marks={spot:[],store:[],bar:[]},e._clusters={spot:{},store:{},bar:{}},e._aside=null,e._isAsideExpanded=!0,e._lang=new p(window.navigator.language.substring(0,2),e._init.bind(b(e))),e}return t=s,(n=[{key:"_init",value:function(){this._handleLoginAside(),this._notification=new g,this._initMap().then(this._initGeolocation.bind(this)).then(this._initEvents.bind(this)).then(this._initMarkers.bind(this))}},{key:"_handleLoginAside",value:function(){var e=this;document.title=this.nls.login("headTitle"),i.replaceString(document.body,"{{LOGIN_SUBTITLE}}",this.nls.login("subtitle")),i.replaceString(document.body,"{{LOGIN_HIDDEN_ERROR}}",this.nls.login("hiddenError")),i.replaceString(document.body,"{{LOGIN_USERNAME_LABEL}}",this.nls.login("username")),i.replaceString(document.body,"{{LOGIN_USERNAME_PASSWORD}}",this.nls.login("password")),i.replaceString(document.body,"{{LOGIN_FORGOT_PASSWORD}}",this.nls.login("forgot")),i.replaceString(document.body,"{{LOGIN_BUTTON}}",this.nls.login("login")),i.replaceString(document.body,"{{LOGIN_NOT_REGISTERED}}",this.nls.login("notRegistered")),i.replaceString(document.body,"{{LOGIN_REGISTER}}",this.nls.login("register"));var t=document.getElementById("login-error"),n=document.getElementById("username"),r=document.getElementById("password"),o=function(e){console.log(e),window.location="authindex.html"};document.getElementById("login-submit").addEventListener("click",(function(){t.classList.remove("visible"),n.classList.remove("error"),r.classList.remove("error"),(""===n.value&&""===r.value?(t.classList.add("visible"),t.innerHTML=e.nls.login("bothEmpty"),n.classList.add("error"),r.classList.add("error"),0):""===n.value?(t.classList.add("visible"),t.innerHTML=e.nls.login("usernameEmpty"),n.classList.add("error"),0):""!==r.value||(t.classList.add("visible"),t.innerHTML=e.nls.login("passwordEmpty"),r.classList.add("error"),0))&&i.postReq("/api/login/submit").then(o).catch((function(){t.classList.add("visible"),t.innerHTML=e.nls.login("serverError")}))}),!1),document.getElementById("register-aside").addEventListener("click",this._loadRegisterAside.bind(this),!1),document.getElementById("forgot-password").addEventListener("click",this._loadForgotPasswordAside.bind(this),!1),document.getElementById("aside-expander").addEventListener("click",this._toggleAside.bind(this),!1)}},{key:"_handleRegisterAside",value:function(){var e=this;document.title=this.nls.register("headTitle"),i.replaceString(document.body,"{{REGISTER_SUBTITLE}}",this.nls.register("subtitle")),i.replaceString(document.body,"{{REGISTER_HIDDEN_ERROR}}",this.nls.register("hiddenError")),i.replaceString(document.body,"{{REGISTER_USERNAME_LABEL}}",this.nls.register("username")),i.replaceString(document.body,"{{REGISTER_MAIL_LABEL}}",this.nls.register("mail")),i.replaceString(document.body,"{{REGISTER_USERNAME_PASSWORD_1}}",this.nls.register("password1")),i.replaceString(document.body,"{{REGISTER_USERNAME_PASSWORD_2}}",this.nls.register("password2")),i.replaceString(document.body,"{{REGISTER_BUTTON}}",this.nls.register("register")),i.replaceString(document.body,"{{REGISTER_ALREADY_DONE}}",this.nls.register("notRegistered")),i.replaceString(document.body,"{{REGISTER_LOGIN}}",this.nls.register("login"));var t=document.getElementById("register-error"),n=document.getElementById("username"),r=document.getElementById("mail"),o=document.getElementById("password1"),a=document.getElementById("password2"),s=function(e){console.log(e),window.location="authindex.html"};document.getElementById("register-submit").addEventListener("click",(function(){t.classList.remove("visible"),n.classList.remove("error"),r.classList.remove("error"),o.classList.remove("error"),a.classList.remove("error"),(""===n.value||""===r.value||""===o.value||""===a.value?(t.classList.add("visible"),t.innerHTML=e.nls.register("fieldEmpty"),""===n.value&&n.classList.add("error"),""===r.value&&r.classList.add("error"),""===o.value&&o.classList.add("error"),""===a.value&&a.classList.add("error"),0):o.value===a.value||(t.classList.add("visible"),t.innerHTML=e.nls.register("notMatchingPassword"),o.classList.add("error"),a.classList.add("error"),0))&&i.postReq("/api/register/submit").then(s).catch((function(){t.classList.add("visible"),t.innerHTML=e.nls.register("serverError")}))}),!1),document.getElementById("login-aside").addEventListener("click",this._loadLoginAside.bind(this),!1),document.getElementById("aside-expander").addEventListener("click",this._toggleAside.bind(this),!1)}},{key:"_handleResetPasswordAdise",value:function(){var e=this;document.title=this.nls.forgotPassword("headTitle"),i.replaceString(document.body,"{{FORGOT_PASSWORD_SUBTITLE}}",this.nls.forgotPassword("subtitle")),i.replaceString(document.body,"{{FORGOT_PASSWORD_ERROR}}",this.nls.register("hiddenError")),i.replaceString(document.body,"{{FORGOT_PASSWORD_MAIL_LABEL}}",this.nls.forgotPassword("mail")),i.replaceString(document.body,"{{FORGOT_PASSWORD_BUTTON}}",this.nls.forgotPassword("submit")),i.replaceString(document.body,"{{FORGOT_PASSWORD_LOGIN_LABEL}}",this.nls.forgotPassword("loginLabel")),i.replaceString(document.body,"{{FORGOT_PASSWORD_LOGIN}}",this.nls.forgotPassword("login"));var t=document.getElementById("forgot-password-error"),n=document.getElementById("mail"),r=function(e){console.log(e),window.location="authindex.html"};document.getElementById("forgot-password-submit").addEventListener("click",(function(){t.classList.remove("visible"),n.classList.remove("error"),(""!==n.value||(t.classList.add("visible"),t.innerHTML=e.nls.forgotPassword("fieldEmpty"),""===n.value&&n.classList.add("error"),0))&&i.postReq("/api/password/reset").then(r).catch((function(){t.classList.add("visible"),t.innerHTML=e.nls.forgotPassword("serverError")}))}),!1),document.getElementById("login-aside").addEventListener("click",this._loadLoginAside.bind(this),!1),document.getElementById("aside-expander").addEventListener("click",this._toggleAside.bind(this),!1)}},{key:"_loadAside",value:function(e){var t=this;return new Promise((function(n,r){i.fetchTemplate("assets/html/aside/".concat(e,".html")).then((function(r){document.body.className="",document.body.classList.add(e),t._aside=document.getElementById("aside"),t._aside.innerHTML="",t._aside.appendChild(r),n()})).catch(r)}))}},{key:"_loadLoginAside",value:function(){var e=this;this._loadAside("login").then((function(){e._handleLoginAside()})).catch((function(){console.error("Couldn't fetch or build the login aside")}))}},{key:"_loadRegisterAside",value:function(){var e=this;this._loadAside("register").then((function(){e._handleRegisterAside()})).catch((function(){console.error("Couldn't fetch or build the register aside")}))}},{key:"_loadForgotPasswordAside",value:function(){var e=this;this._loadAside("forgot-password").then((function(){e._handleResetPasswordAdise()})).catch((function(){console.error("Couldn't fetch or build the forgot password aside")}))}},{key:"_toggleAside",value:function(){var e=this;!0===this._isAsideExpanded?(this._isAsideExpanded=!1,document.getElementById("aside").style.right="-40rem",document.documentElement.style.setProperty("--aside-width","0"),requestAnimationFrame((function(){e._map.invalidateSize()})),setTimeout((function(){document.getElementById("aside-expander").style.left="-44.8rem",document.getElementById("aside-expander-icon").src="assets/img/logo/left.svg"}),100)):(this._isAsideExpanded=!0,document.getElementById("aside").style.maxWidth="40rem",document.getElementById("aside").style.right="0",document.getElementById("aside-expander").style.transition="none",document.getElementById("aside-expander").style.left="0",document.getElementById("aside-expander-icon").src="assets/img/logo/right.svg",setTimeout((function(){document.documentElement.style.setProperty("--aside-width","40rem"),document.getElementById("aside").style.maxWidth="var(--aside-width)",document.getElementById("aside-expander").style.transition="all .5s"}),500))}},{key:"_initMap",value:function(){var e=this;return new Promise((function(t){e._map=window.L.map("beer-crakerz-map",{zoomControl:!1}).setView([e._user.lat,e._user.lng],18),window.L.control.scale().addTo(e._map),e.drawUserMarker();var n=l.planOsm,r=l.satEsri;e._map.setMaxBounds(i.MAP_BOUNDS);var o={};o["<p>".concat(e.nls.map("planLayerOSM"),"</p>")]=n,o["<p>".concat(e.nls.map("satLayerEsri"),"</p>")]=r,n.addTo(e._map),window.L.control.layers(o,{},{position:"bottomright"}).addTo(e._map),e._zoomSlider=new d(e._map),t()}))}},{key:"_initGeolocation",value:function(){var e=this;return new Promise((function(t){if("geolocation"in navigator){var n="true"===i.getPreference("map-high-accuracy")?i.HIGH_ACCURACY:i.OPTIMIZED_ACCURACY;e._watchId=navigator.geolocation.watchPosition((function(t){e._user.lat=t.coords.latitude,e._user.lng=t.coords.longitude,e._user.accuracy=t.coords.accuracy,e._map&&(e.drawUserMarker(),e._map.setView(e._user))}),null,n),t()}else e._notification.raise(e.nls.notif("geolocationError")),t()}))}},{key:"_initEvents",value:function(){var e=this;return new Promise((function(t){e._map.on("click",e.mapClicked.bind(e)),e._map.on("drag",(function(){e._map.panInsideBounds(i.MAP_BOUNDS,{animate:!0}),"true"===i.getPreference("map-center-on-user")&&e.toggleFocusLock()})),e._map.on("zoomstart",(function(){e._isZooming=!0,"true"===i.getPreference("poi-show-circle")&&(e.setMarkerCircles(e._marks.spot,!1),e.setMarkerCircles(e._marks.store,!1),e.setMarkerCircles(e._marks.bar,!1),e.setMarkerCircles([e._user],!1),e.setMarkerCircles([{circle:e._user.range}],!1))})),e._map.on("zoomend",(function(){e._isZooming=!1,"true"===i.getPreference("poi-show-circle")&&e._map.getZoom()>=15&&(e.setMarkerCircles(e._marks.spot,!0),e.setMarkerCircles(e._marks.store,!0),e.setMarkerCircles(e._marks.bar,!0),e.setMarkerCircles([e._user],!0),e.setMarkerCircles([{circle:e._user.range}],!0)),"true"===i.getPreference("poi-marker-label")&&(e._map.getZoom()<15?(e.setMarkerLabels(e._marks.spot,!1),e.setMarkerLabels(e._marks.store,!1),e.setMarkerLabels(e._marks.bar,!1)):(e.setMarkerLabels(e._marks.spot,!0),e.setMarkerLabels(e._marks.store,!0),e.setMarkerLabels(e._marks.bar,!0)))})),e._map.on("baselayerchange",(function(e){i.setPreference("map-plan-layer",i.stripDom(e.name))})),t()}))}},{key:"_initMarkers",value:function(){var e=this;return new Promise((function(t){var n={animateAddingMarkers:!0,disableClusteringAtZoom:18,spiderfyOnMaxZoom:!1};e._clusters.spot=new window.L.MarkerClusterGroup(Object.assign(n,{iconCreateFunction:function(e){return window.L.divIcon({className:"cluster-icon-wrapper",html:'\n              <img src="assets/img/marker/cluster-icon-green.png" class="cluster-icon">\n              <span class="cluster-label">'.concat(e.getChildCount(),"</span>\n            ")})}})),e._clusters.store=new window.L.MarkerClusterGroup(Object.assign(n,{iconCreateFunction:function(e){return window.L.divIcon({className:"cluster-icon-wrapper",html:'\n              <img src="assets/img/marker/cluster-icon-blue.png" class="cluster-icon">\n              <span class="cluster-label">'.concat(e.getChildCount(),"</span>\n            ")})}})),e._clusters.bar=new window.L.MarkerClusterGroup(Object.assign(n,{iconCreateFunction:function(e){return window.L.divIcon({className:"cluster-icon-wrapper",html:'\n              <img src="assets/img/marker/cluster-icon-red.png" class="cluster-icon">\n              <span class="cluster-label">'.concat(e.getChildCount(),"</span>\n            ")})}})),"true"===i.getPreference("poi-show-spot")&&e._map.addLayer(e._clusters.spot),"true"===i.getPreference("poi-show-store")&&e._map.addLayer(e._clusters.store),"true"===i.getPreference("poi-show-bar")&&e._map.addLayer(e._clusters.bar);var r=function(t){e.markPopupFactory(t).then((function(n){t.dom=n,t.marker=e.placeMarker(t),e._marks[t.type].push(t),e._clusters[t.type].addLayer(t.marker)}))};i.getSpots().then((function(e){for(var t=0;t<e.length;++t)e[t].type="spot",e[t].user="messmaker",e[t].userId=42,e[t].lat=e[t].latitude,e[t].lng=e[t].longitude,r(e[t])})),i.getStores().then((function(e){for(var t=0;t<e.length;++t)e[t].type="store",e[t].user="messmaker",e[t].userId=42,e[t].lat=e[t].latitude,e[t].lng=e[t].longitude,r(e[t])})),i.getBars().then((function(e){for(var t=0;t<e.length;++t)e[t].type="bar",e[t].user="messmaker",e[t].userId=42,e[t].lat=e[t].latitude,e[t].lng=e[t].longitude,r(e[t])})),t()}))}},{key:"mapClicked",value:function(){console.log("lkjdslm")}},{key:"map",get:function(){return this._map}},{key:"marks",get:function(){return this._marks}},{key:"user",get:function(){return this._user}},{key:"nls",get:function(){return this._lang}}])&&y(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(c);window.BeerCrackerz=t.default}();