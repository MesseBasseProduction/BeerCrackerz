!function(){"use strict";var e={d:function(n,t){for(var r in t)e.o(t,r)&&!e.o(n,r)&&Object.defineProperty(n,r,{enumerable:!0,get:t[r]})},o:function(e,n){return Object.prototype.hasOwnProperty.call(e,n)}},n={};function t(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.d(n,{default:function(){return c}});var r=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,r;return n=e,r=[{key:"fetchTemplate",value:function(e){return new Promise((function(n,t){fetch(e).then((function(e){e.text().then((function(e){n(document.createRange().createContextualFragment(e))})).catch(t)})).catch(t)}))}},{key:"fetchFile",value:function(e){return new Promise((function(n,t){fetch(e).then((function(e){e.text().then(n).catch(t)})).catch(t)}))}},{key:"getReq",value:function(e){return new Promise((function(n,t){var r={method:"GET",headers:new Headers,mode:"cors",cache:"default",url:"http://localhost:8000"};fetch(e,r).then((function(e){e.json().then(n).catch(t)})).catch(t)}))}},{key:"postReq",value:function(e,n){return new Promise((function(t,r){var a={method:"POST",headers:new Headers,mode:"cors",cache:"default",body:n};fetch(e,a).then((function(e){e.json().then(t).catch(r)})).catch(r)}))}},{key:"stripDom",value:function(e){return(new DOMParser).parseFromString(e,"text/html").body.textContent||""}},{key:"replaceString",value:function(e,n,t){e.innerHTML=e.innerHTML.replace(n,t)}},{key:"getDistanceBetweenCoords",value:function(e,n){var t=e[1]*Math.PI/180,r=e[0]*Math.PI/180,a=n[1]*Math.PI/180,i=n[0]*Math.PI/180,o=i-r,c=a-t,s=Math.pow(Math.sin(o/2),2)+Math.cos(r)*Math.cos(i)*Math.pow(Math.sin(c/2),2);return 2*Math.asin(Math.sqrt(s))*6371*1e3}},{key:"precisionRound",value:function(e,n){var t=Math.pow(10,n||0);return Math.round(e*t)/t}},{key:"initDebugInterface",value:function(){var e=window.BeerCrackerz.nls.debug.bind(window.BeerCrackerz.nls),n=document.createElement("DIV"),t=document.createElement("P"),r=document.createElement("P"),a=document.createElement("P"),i=document.createElement("P"),o=document.createElement("P"),c=document.createElement("P"),s=document.createElement("P"),u=document.createElement("P"),l=document.createElement("P"),d=document.createElement("BUTTON");return n.classList.add("debug-container"),t.classList.add("debug-user-lat"),r.classList.add("debug-user-lng"),a.classList.add("debug-updates-amount"),i.classList.add("debug-user-accuracy"),o.classList.add("debug-high-accuracy"),c.classList.add("debug-pos-max-age"),s.classList.add("debug-pos-timeout"),u.classList.add("debug-zoom-level"),l.classList.add("debug-marks-amount"),d.classList.add("debug-export-data"),t.innerHTML="<b>".concat(e("lat"),"</b> : -"),r.innerHTML="<b>".concat(e("lng"),"</b> : -"),a.innerHTML="<b>".concat(e("updates"),"</b> : 0"),i.innerHTML="<b>".concat(e("accuracy"),"</b> : -"),o.innerHTML="<b>".concat(e("highAccuracy"),"</b> : -"),c.innerHTML="<b>".concat(e("posAge"),"</b> : -"),s.innerHTML="<b>".concat(e("posTimeout"),"</b> : -"),u.innerHTML="<b>".concat(e("zoom"),"</b> : -"),l.innerHTML="<b>".concat(e("marks"),"</b> : -"),d.innerHTML=e("export"),n.appendChild(t),n.appendChild(r),n.appendChild(a),n.appendChild(i),n.appendChild(o),n.appendChild(c),n.appendChild(s),n.appendChild(u),n.appendChild(l),n.appendChild(d),d.addEventListener("click",window.BeerCrackerz.downloadData.bind(window.BeerCrackerz)),n}},{key:"updateDebugInterface",value:function(n,t,r){if(!0===window.DEBUG){var a=window.BeerCrackerz,i=a.nls.debug.bind(a.nls),o=parseInt(n.querySelector(".debug-updates-amount").innerHTML.split(" : ")[1])+1,c=a.marks.spot.length+a.marks.store.length+a.marks.bar.length;n.querySelector(".debug-user-lat").innerHTML="\n        <b>".concat(i("lat"),"</b> : ").concat(t.lat,"\n      "),n.querySelector(".debug-user-lng").innerHTML="\n        <b>".concat(i("lng"),"</b> : ").concat(t.lng,"\n      "),n.querySelector(".debug-updates-amount").innerHTML="\n        <b>".concat(i("updates"),"</b> : ").concat(o,"\n      "),n.querySelector(".debug-user-accuracy").innerHTML="\n        <b>".concat(i("accuracy"),"</b> : ").concat(e.precisionRound(t.accuracy,2),"m\n      "),n.querySelector(".debug-high-accuracy").innerHTML="\n        <b>".concat(i("highAccuracy"),"</b> : ").concat(!0===r.enableHighAccuracy?i("enabled"):i("disabled"),"\n      "),n.querySelector(".debug-pos-max-age").innerHTML="\n        <b>".concat(i("posAge"),"</b> : ").concat(r.maximumAge/1e3,"s\n      "),n.querySelector(".debug-pos-timeout").innerHTML="\n        <b>".concat(i("posTimeout"),"</b> : ").concat(r.timeout/1e3,"s\n      "),n.querySelector(".debug-zoom-level").innerHTML="\n        <b>".concat(i("zoom"),"</b> : ").concat(a.map.getZoom(),"\n      "),n.querySelector(".debug-marks-amount").innerHTML="\n        <b>".concat(i("marks"),"</b> : ").concat(c,"\n      ")}}},{key:"getPoints",value:function(n){return new Promise((function(t){e.getReq("http://localhost:8000/".concat(n)).then(t)}))}},{key:"getSpots",value:function(){return new Promise((function(n){e.getPoints("spot").then(n)}))}},{key:"getStores",value:function(){return new Promise((function(n){e.getPoints("store").then(n)}))}},{key:"getBars",value:function(){return new Promise((function(n){e.getPoints("bar").then(n)}))}},{key:"getPreference",value:function(e){return localStorage.getItem(e)||null}},{key:"setPreference",value:function(e,n){localStorage.setItem(e,n)}},{key:"RANGE_COLOR",get:function(){return"#ffd87d"}},{key:"USER_COLOR",get:function(){return"#63fff5"}},{key:"SPOT_COLOR",get:function(){return"#26ad23"}},{key:"STORE_COLOR",get:function(){return"#247dc9"}},{key:"BAR_COLOR",get:function(){return"#ca2a3d"}},{key:"CIRCLE_RADIUS",get:function(){return 100}},{key:"NEW_MARKER_RANGE",get:function(){return 200}},{key:"MAP_BOUNDS",get:function(){return window.L.latLngBounds(window.L.latLng(-89.98155760646617,-180),window.L.latLng(89.99346179538875,180))}},{key:"HIGH_ACCURACY",get:function(){return{enableHighAccuracy:!0,maximumAge:1e3,timeout:900}}},{key:"OPTIMIZED_ACCURACY",get:function(){return{enableHighAccuracy:!1,maximumAge:3e4,timeout:29e3}}},{key:"SUPPORTED_LANGUAGE",get:function(){return["en","fr","es","de"]}}],null&&t(n.prototype,null),r&&t(n,r),Object.defineProperty(n,"prototype",{writable:!1}),e}();function a(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(n,t){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e),this._lang=-1!==r.SUPPORTED_LANGUAGE.indexOf(n)?n:"en",this._values={},this._init().then(t)}var n,t;return n=e,(t=[{key:"_init",value:function(){var e=this;return new Promise((function(n,t){r.fetchFile("assets/nls/".concat(e._lang,".json")).then((function(t){e._values=JSON.parse(t),n()})).catch(t)}))}},{key:"debug",value:function(e){return this._values.debug[e]||""}},{key:"notif",value:function(e){return this._values.notif[e]||""}},{key:"nav",value:function(e){return this._values.nav[e]||""}},{key:"map",value:function(e){return this._values.map[e]||""}},{key:"spot",value:function(e){return this._values.spot[e]||""}},{key:"store",value:function(e){return this._values.store[e]||""}},{key:"bar",value:function(e){return this._values.bar[e]||""}},{key:"popup",value:function(e){return this._values.popup[e]||""}},{key:"modal",value:function(e){return this._values.modal[e]||""}},{key:"login",value:function(e){return this._values.auth.login[e]||""}},{key:"register",value:function(e){return this._values.auth.register[e]||""}}])&&a(n.prototype,t),Object.defineProperty(n,"prototype",{writable:!1}),e}();function o(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var c=function(){function e(){!function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}(this,e);var n=function(){};document.body.className.includes("login")?n=this._handleLogin.bind(this):document.body.className.includes("register")&&(n=this._handleRegister.bind(this)),this._lang=new i(window.navigator.language.substring(0,2),n.bind(this))}var n,t;return n=e,(t=[{key:"_handleLogin",value:function(){var e=this;document.title=this.nls.login("headTitle"),r.replaceString(document.body,"{{LOGIN_SUBTITLE}}",this.nls.login("subtitle")),r.replaceString(document.body,"{{LOGIN_HIDDEN_ERROR}}",this.nls.login("hiddenError")),r.replaceString(document.body,"{{LOGIN_USERNAME_LABEL}}",this.nls.login("username")),r.replaceString(document.body,"{{LOGIN_USERNAME_PASSWORD}}",this.nls.login("password")),r.replaceString(document.body,"{{LOGIN_BUTTON}}",this.nls.login("login")),r.replaceString(document.body,"{{LOGIN_NOT_REGISTERED}}",this.nls.login("notRegistered")),r.replaceString(document.body,"{{LOGIN_REGISTER}}",this.nls.login("register"));var n=document.getElementById("login-error"),t=document.getElementById("username"),a=document.getElementById("password"),i=function(e){console.log(e),window.location="authindex.html"};document.getElementById("login-submit").addEventListener("click",(function(){n.classList.remove("visible"),t.classList.remove("error"),a.classList.remove("error"),(""===t.value&&""===a.value?(n.classList.add("visible"),n.innerHTML=e.nls.login("bothEmpty"),t.classList.add("error"),a.classList.add("error"),0):""===t.value?(n.classList.add("visible"),n.innerHTML=e.nls.login("usernameEmpty"),t.classList.add("error"),0):""!==a.value||(n.classList.add("visible"),n.innerHTML=e.nls.login("passwordEmpty"),a.classList.add("error"),0))&&r.postReq("/api/login/submit").then(i).catch((function(){n.classList.add("visible"),n.innerHTML=e.nls.login("serverError")}))}),!1)}},{key:"_handleRegister",value:function(){var e=this;document.title=this.nls.register("headTitle"),r.replaceString(document.body,"{{REGISTER_SUBTITLE}}",this.nls.register("subtitle")),r.replaceString(document.body,"{{REGISTER_HIDDEN_ERROR}}",this.nls.register("hiddenError")),r.replaceString(document.body,"{{REGISTER_USERNAME_LABEL}}",this.nls.register("username")),r.replaceString(document.body,"{{REGISTER_USERNAME_PASSWORD_1}}",this.nls.register("password1")),r.replaceString(document.body,"{{REGISTER_USERNAME_PASSWORD_2}}",this.nls.register("password2")),r.replaceString(document.body,"{{REGISTER_BUTTON}}",this.nls.register("register")),r.replaceString(document.body,"{{REGISTER_ALREADY_DONE}}",this.nls.register("notRegistered")),r.replaceString(document.body,"{{REGISTER_LOGIN}}",this.nls.register("login"));var n=document.getElementById("register-error"),t=document.getElementById("username"),a=document.getElementById("password1"),i=document.getElementById("password2"),o=function(e){console.log(e),window.location="authindex.html"};document.getElementById("register-submit").addEventListener("click",(function(){n.classList.remove("visible"),t.classList.remove("error"),a.classList.remove("error"),i.classList.remove("error"),(""===t.value||""===a.value||""===i.value?(n.classList.add("visible"),n.innerHTML=e.nls.register("fieldEmpty"),""===t.value&&t.classList.add("error"),""===a.value&&a.classList.add("error"),""===i.value&&i.classList.add("error"),0):a.value===i.value||(n.classList.add("visible"),n.innerHTML=e.nls.register("notMatchingPassword"),a.classList.add("error"),i.classList.add("error"),0))&&r.postReq("/api/register/submit").then(o).catch((function(){n.classList.add("visible"),n.innerHTML=e.nls.register("serverError")}))}),!1)}},{key:"nls",get:function(){return this._lang}}])&&o(n.prototype,t),Object.defineProperty(n,"prototype",{writable:!1}),e}();window.BeerCrackerz=n.default}();