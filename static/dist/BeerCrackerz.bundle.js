!function(){"use strict";var e={d:function(t,n){for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t={};function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.d(t,{default:function(){return E}});var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._csrfToken=this._getCsrfCookie(),this._headers=this._createRequestHeaders(),this.isValid=this._checkValidity()}var t,r;return t=e,r=[{key:"_getCsrfCookie",value:function(){if(document.cookie&&""!==document.cookie)for(var e=document.cookie.split(";"),t=0;t<e.length;++t){var n=e[t].split("=");if(void 0!==n&&n[0].toLowerCase().includes("srf"))return decodeURIComponent(n[1])}return null}},{key:"_createRequestHeaders",value:function(){return[["Content-Type","application/json; charset=UTF-8"],["Accept","application/json"],["X-CSRFToken",this._csrfToken]]}},{key:"_checkValidity",value:function(){return null!==this._csrfToken&&3===this._headers.length}},{key:"_resolveAs",value:function(e,t){return new Promise((function(n,r){t?"raw"===e?200===t.status?n(t.responseText):r(t.status):"json"===e||"text"===e?t[e]?n(t[e]()):r(t.status):"dom"===e?t.text().then((function(e){n(document.createRange().createContextualFragment(e))})).catch(r):n():r("F_KOM_MISSING_ARGUMENT")}))}},{key:"_resolveAsJSON",value:function(e){return this._resolveAs("json",e)}},{key:"_resolveAsText",value:function(e){return this._resolveAs("text",e)}},{key:"_resolveAsDom",value:function(e){return this._resolveAs("dom",e)}},{key:"get",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._resolveAsJSON.bind(this);return new Promise((function(r,a){var o={method:"GET",headers:new Headers([t._headers[0]])};fetch(e,o).then((function(e){return 200!==e.status&&a(e),n(e)})).then(r).catch(a)}))}},{key:"getText",value:function(e){return this.get(e,this._resolveAsText.bind(this))}},{key:"getTemplate",value:function(e){return this.get(e,this._resolveAsDom.bind(this))}},{key:"post",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._resolveAsJSON.bind(this);return new Promise((function(a,o){var i={method:"POST",headers:new Headers(n._headers),body:JSON.stringify(t)};fetch(e,i).then((function(e){return e.status>=400&&o(e),null!=r?r(e):e})).then(a).catch(o)}))}},{key:"postText",value:function(e,t){return this.post(e,t,this._resolveAsText.bind(this))}},{key:"patch",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._resolveAsJSON.bind(this);return new Promise((function(a,o){var i={method:"PATCH",headers:new Headers(n._headers),body:JSON.stringify(t)};fetch(e,i).then((function(e){return e.status>=400&&o(e),null!=r?r(e):e})).then(a).catch(o)}))}},{key:"delete",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._resolveAsJSON.bind(this);return new Promise((function(a,o){var i={method:"DELETE",headers:new Headers(n._headers),body:JSON.stringify(t)};fetch(e,i).then((function(e){return e.status>=400&&o(e),null!=r?r(e):e})).then(a).catch(o)}))}},{key:"_getMarks",value:function(e){var t=this;return new Promise((function(n,r){t.get("http://localhost:8080/api/".concat(e)).then(n).catch(r)}))}},{key:"getSpots",value:function(){return this._getMarks("spot")}},{key:"getShops",value:function(){return this._getMarks("shop")}},{key:"getBars",value:function(){return this._getMarks("bar")}},{key:"_saveMark",value:function(e,t){var n=this;return new Promise((function(r,a){n.post("http://localhost:8080/api/".concat(e,"/"),t,null).then(r).catch(a)}))}},{key:"spotCreated",value:function(e){return this._saveMark("spot",e)}},{key:"shopCreated",value:function(e){return this._saveMark("shop",e)}},{key:"barCreated",value:function(e){return this._saveMark("bar",e)}},{key:"_editMark",value:function(e,t,n){var r=this;return new Promise((function(a,o){r.patch("http://localhost:8080/api/".concat(e,"/").concat(t,"/"),n,null).then(a).catch(o)}))}},{key:"spotEdited",value:function(e,t){return this._editMark("spot",e,t)}},{key:"shopEdited",value:function(e,t){return this._editMark("shop",e,t)}},{key:"barEdited",value:function(e,t){return this._editMark("bar",e,t)}},{key:"_deleteMark",value:function(e,t,n){var r=this;return new Promise((function(a,o){r.delete("http://localhost:8080/api/".concat(e,"/").concat(t,"/"),n,null).then(a).catch(o)}))}},{key:"spotDeleted",value:function(e,t){return this._deleteMark("spot",e,t)}},{key:"shopDeleted",value:function(e,t){return this._deleteMark("shop",e,t)}},{key:"barDeleted",value:function(e,t){return this._deleteMark("bar",e,t)}},{key:"csrf",get:function(){return null}}],r&&n(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),a=r;function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var i=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,n=[{key:"stripDom",value:function(e){return(new DOMParser).parseFromString(e,"text/html").body.textContent||""}},{key:"replaceString",value:function(e,t,n){e.innerHTML=e.innerHTML.replace(t,n)}},{key:"getDistanceBetweenCoords",value:function(e,t){var n=e[1]*Math.PI/180,r=e[0]*Math.PI/180,a=t[1]*Math.PI/180,o=t[0]*Math.PI/180,i=o-r,c=a-n,s=Math.pow(Math.sin(i/2),2)+Math.cos(r)*Math.cos(o)*Math.pow(Math.sin(c/2),2);return 2*Math.asin(Math.sqrt(s))*6371*1e3}},{key:"precisionRound",value:function(e,t){var n=Math.pow(10,t||0);return Math.round(e*n)/n}},{key:"initDebugInterface",value:function(){var e=window.BeerCrackerz.nls.debug.bind(window.BeerCrackerz.nls),t=document.createElement("DIV"),n=document.createElement("P"),r=document.createElement("P"),a=document.createElement("P"),o=document.createElement("P"),i=document.createElement("P"),c=document.createElement("P"),s=document.createElement("P"),l=document.createElement("P"),u=document.createElement("P"),d=document.createElement("BUTTON");return t.classList.add("debug-container"),n.classList.add("debug-user-lat"),r.classList.add("debug-user-lng"),a.classList.add("debug-updates-amount"),o.classList.add("debug-user-accuracy"),i.classList.add("debug-high-accuracy"),c.classList.add("debug-pos-max-age"),s.classList.add("debug-pos-timeout"),l.classList.add("debug-zoom-level"),u.classList.add("debug-marks-amount"),d.classList.add("debug-export-data"),n.innerHTML="<b>".concat(e("lat"),"</b> : -"),r.innerHTML="<b>".concat(e("lng"),"</b> : -"),a.innerHTML="<b>".concat(e("updates"),"</b> : 0"),o.innerHTML="<b>".concat(e("accuracy"),"</b> : -"),i.innerHTML="<b>".concat(e("highAccuracy"),"</b> : -"),c.innerHTML="<b>".concat(e("posAge"),"</b> : -"),s.innerHTML="<b>".concat(e("posTimeout"),"</b> : -"),l.innerHTML="<b>".concat(e("zoom"),"</b> : -"),u.innerHTML="<b>".concat(e("marks"),"</b> : -"),d.innerHTML=e("export"),t.appendChild(n),t.appendChild(r),t.appendChild(a),t.appendChild(o),t.appendChild(i),t.appendChild(c),t.appendChild(s),t.appendChild(l),t.appendChild(u),t.appendChild(d),d.addEventListener("click",window.BeerCrackerz.downloadData.bind(window.BeerCrackerz)),t}},{key:"updateDebugInterface",value:function(t,n,r){if(!0===window.DEBUG){var a=window.BeerCrackerz,o=a.nls.debug.bind(a.nls),i=parseInt(t.querySelector(".debug-updates-amount").innerHTML.split(" : ")[1])+1,c=a.marks.spot.length+a.marks.shop.length+a.marks.bar.length;t.querySelector(".debug-user-lat").innerHTML="\n        <b>".concat(o("lat"),"</b> : ").concat(n.lat,"\n      "),t.querySelector(".debug-user-lng").innerHTML="\n        <b>".concat(o("lng"),"</b> : ").concat(n.lng,"\n      "),t.querySelector(".debug-updates-amount").innerHTML="\n        <b>".concat(o("updates"),"</b> : ").concat(i,"\n      "),t.querySelector(".debug-user-accuracy").innerHTML="\n        <b>".concat(o("accuracy"),"</b> : ").concat(e.precisionRound(n.accuracy,2),"m\n      "),t.querySelector(".debug-high-accuracy").innerHTML="\n        <b>".concat(o("highAccuracy"),"</b> : ").concat(!0===r.enableHighAccuracy?o("enabled"):o("disabled"),"\n      "),t.querySelector(".debug-pos-max-age").innerHTML="\n        <b>".concat(o("posAge"),"</b> : ").concat(r.maximumAge/1e3,"s\n      "),t.querySelector(".debug-pos-timeout").innerHTML="\n        <b>".concat(o("posTimeout"),"</b> : ").concat(r.timeout/1e3,"s\n      "),t.querySelector(".debug-zoom-level").innerHTML="\n        <b>".concat(o("zoom"),"</b> : ").concat(a.map.getZoom(),"\n      "),t.querySelector(".debug-marks-amount").innerHTML="\n        <b>".concat(o("marks"),"</b> : ").concat(c,"\n      ")}}},{key:"getPreference",value:function(e){return localStorage.getItem(e)||null}},{key:"setPreference",value:function(e,t){localStorage.setItem(e,t)}},{key:"RANGE_COLOR",get:function(){return"#ffd87d"}},{key:"USER_COLOR",get:function(){return"#63fff5"}},{key:"SPOT_COLOR",get:function(){return"#26ad23"}},{key:"SHOP_COLOR",get:function(){return"#247dc9"}},{key:"BAR_COLOR",get:function(){return"#ca2a3d"}},{key:"CIRCLE_RADIUS",get:function(){return 100}},{key:"NEW_MARKER_RANGE",get:function(){return 200}},{key:"MAP_BOUNDS",get:function(){return window.L.latLngBounds(window.L.latLng(-89.98155760646617,-180),window.L.latLng(89.99346179538875,180))}},{key:"HIGH_ACCURACY",get:function(){return{enableHighAccuracy:!0,maximumAge:1e3,timeout:900}}},{key:"OPTIMIZED_ACCURACY",get:function(){return{enableHighAccuracy:!1,maximumAge:3e4,timeout:29e3}}},{key:"SUPPORTED_LANGUAGE",get:function(){return["en","fr","es","de","pt"]}}],null&&o(t.prototype,null),n&&o(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function c(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var s=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._lang=-1!==i.SUPPORTED_LANGUAGE.indexOf(t)?t:"en",this._fullLang=t,this._values={},this._init().then(n).catch(r)}var t,n;return t=e,(n=[{key:"_init",value:function(){var e=this;return new Promise((function(t,n){fetch("/static/nls/".concat(e._lang,".json")).then((function(r){200!==r.status&&(r.msg="Fetching the i18n file failed",n(r)),r.text().then((function(a){try{e._values=JSON.parse(a)}catch(e){r.msg="Parsing the i18n file failed",n(r)}t()})).catch(n)})).catch(n)}))}},{key:"debug",value:function(e){return this._values.debug[e]||""}},{key:"notif",value:function(e){return this._values.notif[e]||""}},{key:"nav",value:function(e){return this._values.nav[e]||""}},{key:"map",value:function(e){return this._values.map[e]||""}},{key:"spot",value:function(e){return this._values.spot[e]||""}},{key:"shop",value:function(e){return this._values.shop[e]||""}},{key:"bar",value:function(e){return this._values.bar[e]||""}},{key:"popup",value:function(e){return this._values.popup[e]||""}},{key:"modal",value:function(e){return this._values.modal[e]||""}},{key:"login",value:function(e){return this._values.auth.login[e]||""}},{key:"register",value:function(e){return this._values.auth.register[e]||""}},{key:"forgotPassword",value:function(e){return this._values.auth.forgotPassword[e]||""}},{key:"fullLang",get:function(){return this._fullLang}}])&&c(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),l=Object.freeze({blue:new window.L.Icon({iconUrl:"/static/img/marker/marker-icon-blue.png",shadowUrl:"/static/img/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),gold:new window.L.Icon({iconUrl:"/static/img/marker/marker-icon-gold.png",shadowUrl:"/static/img/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),red:new window.L.Icon({iconUrl:"/static/img/marker/marker-icon-red.png",shadowUrl:"/static/img/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),green:new window.L.Icon({iconUrl:"/static/img/marker/marker-icon-green.png",shadowUrl:"/static/img/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),orange:new window.L.Icon({iconUrl:"/static/img/marker/marker-icon-orange.png",shadowUrl:"/static/img/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),yellow:new window.L.Icon({iconUrl:"/static/img/marker/marker-icon-yellow.png",shadowUrl:"/static/img/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),violet:new window.L.Icon({iconUrl:"/static/img/marker/marker-icon-violet.png",shadowUrl:"/static/img/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),grey:new window.L.Icon({iconUrl:"/static/img/marker/marker-icon-grey.png",shadowUrl:"/static/img/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),black:new window.L.Icon({iconUrl:"/static/img/marker/marker-icon-black.png",shadowUrl:"/static/img/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),user:new window.L.Icon({iconUrl:"/static/img/marker/user-position.png",shadowUrl:"/static/img/marker/user-position-shadow.png",iconSize:[32,32],iconAnchor:[16,16],popupAnchor:[1,-34],shadowSize:[32,32]})});function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var d=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._container=null,this._items=[],this._currentRate=n||0,this._clicked=n||-1,this._init(t),this._events()}var t,n;return t=e,(n=[{key:"_init",value:function(e){this._container=e;for(var t=0;t<e.children.length;++t)this._items.push(e.children[t]);for(var n=0;n<this._currentRate+1;++n)this._items[n].classList.add("active"),this._items[n].classList.add("selected")}},{key:"_events",value:function(){this._container.addEventListener("mouseover",this._containerHovered.bind(this),!1),this._container.addEventListener("mouseout",this._pointerExit.bind(this),!1);for(var e=0;e<this._items.length;++e)this._items[e].addEventListener("click",this._starClicked.bind(this),!1)}},{key:"_containerHovered",value:function(e){"IMG"===e.target.tagName&&(this._currentRate=parseInt(e.target.dataset.id),this._container.dataset.rate=this._currentRate,this.updateStars())}},{key:"_pointerExit",value:function(){this._currentRate=-1===this._clicked?0:this._clicked,this._container.dataset.rate=this._currentRate,this.updateStars()}},{key:"_starClicked",value:function(e){this._currentRate=parseInt(e.target.dataset.id),this._container.dataset.rate=this._currentRate,this._clicked=this._currentRate,this.updateStars()}},{key:"updateStars",value:function(){for(var e=0;e<this._items.length;++e)e<=this._currentRate?(this._items[e].classList.add("active"),e<=this._clicked&&this._items[e].classList.add("selected")):(this._items[e].classList.remove("active"),this._items[e].classList.remove("selected"))}},{key:"currentRate",get:function(){return this._currentRate}}])&&u(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var m=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,(n=[{key:"placeMarker",value:function(e){var t=this,n=l.black;"shop"===e.type?n=l.blue:"spot"===e.type?n=l.green:"bar"===e.type?n=l.red:"user"===e.type&&(n=l.user);var r=window.L.marker([e.lat,e.lng],{icon:n}).on("click",(function(){"true"===i.getPreference("map-center-on-user")&&t.toggleFocusLock(),t.map.flyTo([e.lat,e.lng],18)}));return e.dom&&r.bindPopup(e.dom),-1===["spot","shop","bar"].indexOf(e.type)&&r.addTo(this.map),r}},{key:"drawUserMarker",value:function(){this.user.marker?(this.user.marker.setLatLng(this.user),this.user.range.setLatLng(this.user),this.user.circle.setLatLng(this.user),this.user.circle.setRadius(this.user.accuracy)):(this.user.type="user",this.user.marker=this.placeMarker(this.user),this.user.radius=this.user.accuracy,this.user.circle=this.drawCircle(this.user),this.user.range=this.drawCircle({lat:this.user.lat,lng:this.user.lng,radius:i.NEW_MARKER_RANGE,color:i.RANGE_COLOR}),"true"===i.getPreference("poi-show-circle")&&(this.user.circle.setStyle({opacity:1,fillOpacity:.1}),this.user.range.setStyle({opacity:1,fillOpacity:.1})),this.user.marker.on("click",this.mapClicked.bind(this)))}},{key:"definePOI",value:function(e,t){var n=this,r={wrapper:document.createElement("DIV"),title:document.createElement("P"),spot:document.createElement("BUTTON"),shop:document.createElement("BUTTON"),bar:document.createElement("BUTTON")};r.wrapper.className="new-poi",r.title.innerHTML=this.nls.map("newTitle"),r.spot.innerHTML=this.nls.map("newSpot"),r.shop.innerHTML=this.nls.map("newShop"),r.bar.innerHTML=this.nls.map("newBar"),r.spot.dataset.type="spot",r.shop.dataset.type="shop",r.bar.dataset.type="bar",r.wrapper.appendChild(r.title),r.wrapper.appendChild(r.spot),r.wrapper.appendChild(r.shop),r.wrapper.appendChild(r.bar),e.dom=r.wrapper;var a=this.placeMarker(e).openPopup();e.marker=a,e.addedCallback=t;var o=function(t){a.isBeingDefined=!0,a.closePopup(),n.defineMarkFactory(t.target.dataset.type,e)};return r.spot.addEventListener("click",o),r.shop.addEventListener("click",o),r.bar.addEventListener("click",o),a.on("popupclose",(function(){a.isBeingDefined||(a.popupClosed=!0,a.removeFrom(n.map))})),a}},{key:"defineMarkFactory",value:function(e,t){var n=this;this._kom.getTemplate("/modal/new".concat(e)).then((function(r){var a=r.querySelector("#".concat(e,"-name")),o=r.querySelector("#".concat(e,"-desc")),c=new d(r.querySelector("#".concat(e,"-rating"))),s=r.querySelector("#".concat(e,"-submit")),l=r.querySelector("#".concat(e,"-cancel")),u=r.querySelector("#modal-close");i.replaceString(r.querySelector("#nls-".concat(e,"-title")),"{".concat(e.toUpperCase(),"_TITLE}"),n.nls[e]("title")),i.replaceString(r.querySelector("#nls-".concat(e,"-subtitle")),"{".concat(e.toUpperCase(),"_SUBTITLE}"),n.nls[e]("subtitle")),i.replaceString(r.querySelector("#nls-".concat(e,"-name")),"{".concat(e.toUpperCase(),"_NAME}"),n.nls[e]("nameLabel")),i.replaceString(r.querySelector("#nls-".concat(e,"-desc")),"{".concat(e.toUpperCase(),"_DESC}"),n.nls[e]("descLabel")),i.replaceString(r.querySelector("#nls-".concat(e,"-rate")),"{".concat(e.toUpperCase(),"_RATE}"),n.nls[e]("rateLabel")),i.replaceString(s,"{".concat(e.toUpperCase(),"_SUBMIT}"),n.nls.nav("add")),i.replaceString(l,"{".concat(e.toUpperCase(),"_CANCEL}"),n.nls.nav("cancel"));var p=function(){t.marker.isBeingDefined=!1,t.marker.removeFrom(n.map),n.closeModal(null,!0)};s.addEventListener("click",(function(){""===a.value?n._notification.raise(n.nls.notif("markNameEmpty")):(p(),t.type=e,t.name=a.value,t.description=o.value,t.rate=c.currentRate,n.markPopupFactory(t).then((function(e){t.dom=e,t.marker=n.placeMarker(t),t.addedCallback(t)})))})),l.addEventListener("click",p),u.addEventListener("click",p),n.newMarkModal(r)}))}},{key:"defineNewSpot",value:function(e){this.defineMarkFactory("spot",e)}},{key:"defineNewShop",value:function(e){this.defineMarkFactory("shop",e)}},{key:"defineNewBar",value:function(e){this.defineMarkFactory("bar",e)}},{key:"markPopupFactory",value:function(e){var t=this;return new Promise((function(n){t._kom.getTemplate("/popup/".concat(e.type)).then((function(r){var a=document.createElement("DIV");a.appendChild(r);var o=e.user||t.user.username,c=i.stripDom(e.description)||t.nls.popup("".concat(e.type,"NoDesc"));e.creationDate||(e.creationDate=(new Date).toISOString().slice(0,10));var s=new Intl.DateTimeFormat(t.nls.fullLang,{dateStyle:"long"}).format(new Date(e.creationDate));i.replaceString(a,"{".concat(e.type.toUpperCase(),"_NAME}"),i.stripDom(e.name)),i.replaceString(a,"{".concat(e.type.toUpperCase(),"_FINDER}"),o),i.replaceString(a,"{".concat(e.type.toUpperCase(),"_FOUND_BY}"),t.nls.popup("".concat(e.type,"FoundBy"))),i.replaceString(a,"{".concat(e.type.toUpperCase(),"_FOUND_WHEN}"),t.nls.popup("".concat(e.type,"FoundWhen"))),i.replaceString(a,"{".concat(e.type.toUpperCase(),"_FOUND_DATE}"),s),i.replaceString(a,"{".concat(e.type.toUpperCase(),"_RATE}"),e.rate+1),i.replaceString(a,"{".concat(e.type.toUpperCase(),"_DESC}"),c);for(var l=a.querySelector("#".concat(e.type,"-rating")),u=0;u<e.rate+1;++u)l.children[u].classList.add("active");i.getDistanceBetweenCoords([t.user.lat,t.user.lng],[e.lat,e.lng])>i.CIRCLE_RADIUS&&a.querySelector("#popup-social").parentNode.removeChild(a.querySelector("#popup-social")),o!==t.user.username?a.querySelector("#popup-edit").parentNode.removeChild(a.querySelector("#popup-edit")):(a.querySelector("#edit-mark").addEventListener("click",t.editMarker.bind(t,e),!1),a.querySelector("#delete-mark").addEventListener("click",t.deleteMarker.bind(t,e),!1)),e.color=i["".concat(e.type.toUpperCase(),"_COLOR")],e.circle=t.drawCircle(e),e.tooltip=window.L.tooltip({permanent:!0,direction:"center",className:"marker-tooltip",interactive:!0}).setContent(e.name).setLatLng(e.circle.getLatLng()),"true"===i.getPreference("poi-marker-label")&&e.tooltip.addTo(t.map),n(a)}))}))}},{key:"drawCircle",value:function(e){return window.L.circle(e,{color:e.color,fillColor:e.color,opacity:0,fillOpacity:0,radius:e.radius?e.radius:i.CIRCLE_RADIUS}).addTo(this.map)}},{key:"setMarkerCircles",value:function(e,t){for(var n=0;n<e.length;++n)t?(e[n].circle.setStyle({opacity:1,fillOpacity:.1}),e[n].circle.addTo(this.map)):(e[n].circle.setStyle({opacity:0,fillOpacity:0}),e[n].circle.removeFrom(this.map))}},{key:"setMarkerLabels",value:function(e,t){for(var n=0;n<e.length;++n)t?e[n].tooltip.addTo(this.map):e[n].tooltip.removeFrom(this.map)}}])&&p(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function h(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var g=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._map=t,this._container=document.querySelector("#zoom-slider"),this._slider=document.querySelector("#slider-position"),this._zoomRange=this._map.getMaxZoom()-this._map.getMinZoom(),this._timeoutId=-1,this._events()}var t,n;return t=e,(n=[{key:"_events",value:function(){var e=this;this._map.on("zoomstart",(function(){clearTimeout(e._timeoutId),e._timeoutId=-1,e._container.classList.add("opened")})),this._map.on("zoomend",(function(){var t=e._map.getZoom()-e._map.getMinZoom();e._slider.style.height="".concat(100*t/e._zoomRange,"%"),e._timeoutId=setTimeout((function(){return e._container.classList.remove("opened")}),1500)})),this._map.on("zoom",(function(){clearTimeout(e._timeoutId),e._timeoutId=-1;var t=e._map.getZoom()-e._map.getMinZoom();e._slider.style.height="".concat(100*t/e._zoomRange,"%")})),this._container.addEventListener("mouseover",(function(){clearTimeout(e._timeoutId),e._timeoutId=-1})),this._container.addEventListener("mouseleave",(function(){e._timeoutId=setTimeout((function(){return e._container.classList.remove("opened")}),1500)})),this._container.querySelector("#zoom-more").addEventListener("click",(function(){e._map.setZoom(e._map.getZoom()+1)})),this._container.querySelector("#zoom-less").addEventListener("click",(function(){e._map.setZoom(e._map.getZoom()-1)}))}}])&&h(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var y=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._container=document.querySelector("#notification-wrapper"),this._message=document.querySelector("#notification-message"),this._timeoutId=null}var t,n;return t=e,(n=[{key:"raise",value:function(e){var t=this;clearTimeout(this._timeoutId),this._message.innerHTML=e,this._container.classList.add("opened"),this._timeoutId=setTimeout((function(){t._container.classList.remove("opened"),t._message.innerHTML=""}),2e3)}}])&&f(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),k=Object.freeze({spot:new window.L.MarkerClusterGroup({animateAddingMarkers:!0,disableClusteringAtZoom:18,spiderfyOnMaxZoom:!1,iconCreateFunction:function(e){return window.L.divIcon({className:"cluster-icon-wrapper",html:'\n          <img src="/static/img/marker/cluster-icon-green.png" class="cluster-icon">\n          <span class="cluster-label">'.concat(e.getChildCount(),"</span>\n        ")})}}),shop:new window.L.MarkerClusterGroup({animateAddingMarkers:!0,disableClusteringAtZoom:18,spiderfyOnMaxZoom:!1,iconCreateFunction:function(e){return window.L.divIcon({className:"cluster-icon-wrapper",html:'\n          <img src="/static/img/marker/cluster-icon-blue.png" class="cluster-icon">\n          <span class="cluster-label">'.concat(e.getChildCount(),"</span>\n        ")})}}),bar:new window.L.MarkerClusterGroup({animateAddingMarkers:!0,disableClusteringAtZoom:18,spiderfyOnMaxZoom:!1,iconCreateFunction:function(e){return window.L.divIcon({className:"cluster-icon-wrapper",html:'\n          <img src="/static/img/marker/cluster-icon-red.png" class="cluster-icon">\n          <span class="cluster-label">'.concat(e.getChildCount(),"</span>\n        ")})}})}),_=Object.freeze({planOsm:window.L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',maxZoom:21,maxNativeZoom:19,minZoom:2}),satEsri:window.L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:'&copy; <a href="https://www.arcgis.com/home/item.html?id=10df2279f9684e4a9f6a7f08febac2a9">Esri Imagery</a>',minZoom:2,maxNativeZoom:19,maxZoom:21})});function v(e){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v(e)}function b(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function w(e,t){return w=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},w(e,t)}function L(e,t){if(t&&("object"===v(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return S(e)}function S(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function M(e){return M=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},M(e)}var E=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&w(e,t)}(l,e);var t,n,r,o,c=(r=l,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=M(r);if(o){var n=M(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return L(this,e)});function l(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l),(e=c.call(this))._map=null,e._zoomSlider=null,e._notification=null,e._user={lat:48.853121540141096,lng:2.3498955769881156,accuracy:0,marker:null,circle:null,range:null,color:i.USER_COLOR,id:-1,username:""},e._marks={spot:[],shop:[],bar:[]},e._clusters={spot:{},shop:{},bar:{}},e._newMarker=null,e._debugElement=null,e._watchId=null,e._isZooming=!1,e._kom=new a,e._lang=new s(window.navigator.language.substring(0,2),e._init.bind(S(e))),e}return t=l,(n=[{key:"_init",value:function(){this._debugElement=i.initDebugInterface(),this._notification=new y,this._initUser().then(this._initPreferences.bind(this)).then(this._initGeolocation.bind(this)).then(this._initMap.bind(this)).then(this._initEvents.bind(this)).then(this._initMarkers.bind(this))}},{key:"_initUser",value:function(){var e=this;return new Promise((function(t,n){e._kom.get("/api/user/me/").then((function(n){e._user.id=n.id,e._user.username=n.username,t()})).catch(n)}))}},{key:"_initPreferences",value:function(){var e=this;return new Promise((function(t){null===i.getPreference("poi-show-spot")&&i.setPreference("poi-show-spot",!0),null===i.getPreference("poi-show-shop")&&i.setPreference("poi-show-shop",!0),null===i.getPreference("poi-show-bar")&&i.setPreference("poi-show-bar",!0),null===i.getPreference("map-plan-layer")&&i.setPreference("map-plan-layer",!0),!0!==window.DEBUG&&"true"!==i.getPreference("app-debug")||(window.DEBUG=!0,i.setPreference("app-debug",!0),e.addDebugUI()),"true"===i.getPreference("map-center-on-user")&&document.getElementById("center-on").classList.add("lock-center-on"),t()}))}},{key:"_initGeolocation",value:function(){var e=this;return new Promise((function(t){if("geolocation"in navigator){var n="true"===i.getPreference("map-high-accuracy")?i.HIGH_ACCURACY:i.OPTIMIZED_ACCURACY;e._watchId=navigator.geolocation.watchPosition((function(n){e._user.lat=n.coords.latitude,e._user.lng=n.coords.longitude,e._user.accuracy=n.coords.accuracy,e._map&&(e.drawUserMarker(),e.updateMarkerCirclesVisibility(),"true"!==i.getPreference("map-center-on-user")||e._isZooming||e._map.setView(e._user),e.updateDebugUI()),t()}),t,n)}else e._notification.raise(e.nls.notif("geolocationError")),t()}))}},{key:"_initMap",value:function(){var e=this;return new Promise((function(t){e._map=window.L.map("beer-crakerz-map",{zoomControl:!1}).setView([e._user.lat,e._user.lng],18),window.L.control.scale().addTo(e._map),e.drawUserMarker();var n=_.planOsm,r=_.satEsri;e._map.setMaxBounds(i.MAP_BOUNDS);var a={};if(a["<p>".concat(e.nls.map("planLayerOSM"),"</p>")]=n,a["<p>".concat(e.nls.map("satLayerEsri"),"</p>")]=r,i.getPreference("map-plan-layer"))switch(i.getPreference("map-plan-layer")){case e.nls.map("planLayerOSM"):n.addTo(e._map);break;case e.nls.map("satLayerEsri"):r.addTo(e._map);break;default:n.addTo(e._map)}else n.addTo(e._map);window.L.control.layers(a,{},{position:"bottomright"}).addTo(e._map),e._zoomSlider=new g(e._map),t()}))}},{key:"_initEvents",value:function(){var e=this;return new Promise((function(t){document.getElementById("user-profile").addEventListener("click",e.userProfileModal.bind(e)),document.getElementById("hide-show").addEventListener("click",e.hidShowModal.bind(e)),document.getElementById("center-on").addEventListener("click",e.toggleFocusLock.bind(e)),document.getElementById("overlay").addEventListener("click",e.closeModal.bind(e)),e._map.on("click",e.mapClicked.bind(e)),e._map.on("drag",(function(){e._map.panInsideBounds(i.MAP_BOUNDS,{animate:!0}),"true"===i.getPreference("map-center-on-user")&&e.toggleFocusLock()})),e._map.on("zoomstart",(function(){e._isZooming=!0,"true"===i.getPreference("poi-show-circle")&&(e.setMarkerCircles(e._marks.spot,!1),e.setMarkerCircles(e._marks.shop,!1),e.setMarkerCircles(e._marks.bar,!1),e.setMarkerCircles([e._user],!1),e.setMarkerCircles([{circle:e._user.range}],!1))})),e._map.on("zoomend",(function(){e._isZooming=!1,"true"===i.getPreference("poi-show-circle")&&e._map.getZoom()>=15&&(e.setMarkerCircles(e._marks.spot,!0),e.setMarkerCircles(e._marks.shop,!0),e.setMarkerCircles(e._marks.bar,!0),e.setMarkerCircles([e._user],!0),e.setMarkerCircles([{circle:e._user.range}],!0)),"true"===i.getPreference("poi-marker-label")&&(e._map.getZoom()<15?(e.setMarkerLabels(e._marks.spot,!1),e.setMarkerLabels(e._marks.shop,!1),e.setMarkerLabels(e._marks.bar,!1)):(e.setMarkerLabels(e._marks.spot,!0),e.setMarkerLabels(e._marks.shop,!0),e.setMarkerLabels(e._marks.bar,!0))),e.updateDebugUI()})),e._map.on("baselayerchange",(function(e){i.setPreference("map-plan-layer",i.stripDom(e.name))})),t()}))}},{key:"_initMarkers",value:function(){var e=this;return new Promise((function(t){e._clusters.spot=k.spot,e._clusters.shop=k.shop,e._clusters.bar=k.bar,"true"===i.getPreference("poi-show-spot")&&e._map.addLayer(e._clusters.spot),"true"===i.getPreference("poi-show-shop")&&e._map.addLayer(e._clusters.shop),"true"===i.getPreference("poi-show-bar")&&e._map.addLayer(e._clusters.bar);var n=function(t){e.markPopupFactory(t).then((function(n){t.dom=n,t.marker=e.placeMarker(t),e._marks[t.type].push(t),e._clusters[t.type].addLayer(t.marker)}))};e._kom.getSpots().then((function(e){for(var t=0;t<e.length;++t)n(e[t])})),e._kom.getShops().then((function(e){for(var t=0;t<e.length;++t)n(e[t])})),e._kom.getBars().then((function(e){for(var t=0;t<e.length;++t)n(e[t])})),t()}))}},{key:"toggleFocusLock",value:function(){"true"===i.getPreference("map-center-on-user")?(this._notification.raise(this.nls.notif("unlockFocusOn")),document.getElementById("center-on").classList.remove("lock-center-on"),i.setPreference("map-center-on-user","false")):(this._notification.raise(this.nls.notif("lockFocusOn")),document.getElementById("center-on").classList.add("lock-center-on"),this._map.flyTo([this._user.lat,this._user.lng],18),i.setPreference("map-center-on-user","true"))}},{key:"toggleLabel",value:function(){var e=!("true"===i.getPreference("poi-marker-label"));this.setMarkerLabels(this._marks.spot,e),this.setMarkerLabels(this._marks.shop,e),this.setMarkerLabels(this._marks.bar,e),i.setPreference("poi-marker-label",e)}},{key:"toggleCircle",value:function(){var e=!("true"===i.getPreference("poi-show-circle"));this.setMarkerCircles(this._marks.spot,e),this.setMarkerCircles(this._marks.shop,e),this.setMarkerCircles(this._marks.bar,e),this.setMarkerCircles([this._user],e),this.setMarkerCircles([{circle:this._user.range}],e),i.setPreference("poi-show-circle",e)}},{key:"toggleMarkers",value:function(e){var t=!("true"===i.getPreference("poi-show-".concat(e)));!0===t?this._map.addLayer(this._clusters[e]):this._map.removeLayer(this._clusters[e]),i.setPreference("poi-show-".concat(e),t)}},{key:"toggleHighAccuracy",value:function(){var e=!("true"===i.getPreference("map-high-accuracy"));i.setPreference("map-high-accuracy",e),navigator.geolocation.clearWatch(this._watchId),this._initGeolocation().then(this.updateDebugUI.bind(this))}},{key:"toggleDebug",value:function(){var e=!window.DEBUG;window.DEBUG=e,i.setPreference("app-debug",e),e?this.addDebugUI():this.removeDebugUI()}},{key:"newMarkModal",value:function(e){document.getElementById("overlay").appendChild(e),document.getElementById("overlay").style.display="flex",setTimeout((function(){return document.getElementById("overlay").style.opacity=1}),50)}},{key:"editMarkModal",value:function(e){var t=this;this._kom.getTemplate("/modal/edit".concat(e.type)).then((function(n){var r=n.querySelector("#".concat(e.type,"-name")),a=n.querySelector("#".concat(e.type,"-desc")),o=n.querySelector("#".concat(e.type,"-submit")),c=n.querySelector("#".concat(e.type,"-cancel")),s=n.querySelector("#".concat(e.type,"-rating")),l=new d(s,e.rate);i.replaceString(n.querySelector("#nls-modal-title"),"{MODAL_TITLE}",t.nls.modal("".concat(e.type,"EditTitle"))),i.replaceString(n.querySelector("#nls-".concat(e.type,"-name")),"{".concat(e.type.toUpperCase(),"_NAME}"),t.nls[e.type]("nameLabel")),i.replaceString(n.querySelector("#nls-".concat(e.type,"-desc")),"{".concat(e.type.toUpperCase(),"_DESC}"),t.nls[e.type]("descLabel")),i.replaceString(n.querySelector("#nls-".concat(e.type,"-rate")),"{".concat(e.type.toUpperCase(),"_RATE}"),t.nls[e.type]("rateLabel")),i.replaceString(o,"{".concat(e.type.toUpperCase(),"_SUBMIT}"),t.nls.nav("edit")),i.replaceString(c,"{".concat(e.type.toUpperCase(),"_CANCEL}"),t.nls.nav("cancel")),r.value=e.name,a.value=e.description,o.addEventListener("click",(function(){for(var n=0;n<t._marks[e.type].length;++n)if(e.lat===t._marks[e.type][n].lat&&e.lng===t._marks[e.type][n].lng){t._marks[e.type][n].name=r.value,t._marks[e.type][n].description=a.value,t._marks[e.type][n].rate=l.currentRate,e.tooltip.removeFrom(t.map),t.markPopupFactory(e).then((function(n){e.dom=n,e.marker.setPopupContent(e.dom),t._kom["".concat(e.type,"Edited")](e.id,t.formatMarker(e)).then((function(){t._notification.raise(t.nls.notif("".concat(e.type,"Edited"))),t.closeModal(null,!0)}))}));break}})),c.addEventListener("click",t.closeModal.bind(t,null,!0)),document.getElementById("overlay").appendChild(n),document.getElementById("overlay").style.display="flex",setTimeout((function(){return document.getElementById("overlay").style.opacity=1}),50)}))}},{key:"deleteMarkModal",value:function(e){var t=this;this._kom.getTemplate("/modal/deletemark").then((function(n){i.replaceString(n.querySelector("#nls-modal-title"),"{MODAL_TITLE}",t.nls.modal("deleteMarkTitle")),i.replaceString(n.querySelector("#nls-modal-desc"),"{MODAL_DESC}",t.nls.modal("deleteMarkDesc")),i.replaceString(n.querySelector("#cancel-close"),"{MODAL_CANCEL}",t.nls.nav("cancel")),i.replaceString(n.querySelector("#delete-close"),"{MODAL_DELETE}",t.nls.nav("delete")),document.getElementById("overlay").appendChild(n),document.getElementById("overlay").style.display="flex",document.getElementById("cancel-close").addEventListener("click",(function(n){t.closeModal(n),e(!1)}),!1),document.getElementById("delete-close").addEventListener("click",(function(n){t.closeModal(n),e(!0)}),!1),setTimeout((function(){return document.getElementById("overlay").style.opacity=1}),50)}))}},{key:"userProfileModal",value:function(){var e=this;this._kom.getTemplate("/modal/user").then((function(t){i.replaceString(t.querySelector("#nls-modal-title"),"{MODAL_TITLE}",e.nls.modal("userTitle")),i.replaceString(t.querySelector("#nls-user-modal-accuracy"),"{ACCURACY_USER_MODAL}",e.nls.modal("userAccuracyPref")),i.replaceString(t.querySelector("#nls-user-modal-debug"),"{DEBUG_USER_MODAL}",e.nls.modal("userDebugPref")),i.replaceString(t.querySelector("#nls-about-desc"),"{BEERCRACKERZ_DESC}",e.nls.modal("aboutDesc")),document.getElementById("overlay").appendChild(t),document.getElementById("overlay").style.display="flex","true"===i.getPreference("map-high-accuracy")&&(document.getElementById("high-accuracy-toggle").checked=!0),!0!==window.DEBUG&&"true"!==i.getPreference("app-debug")||(document.getElementById("debug-toggle").checked=!0),document.getElementById("high-accuracy-toggle").addEventListener("change",e.toggleHighAccuracy.bind(e)),document.getElementById("debug-toggle").addEventListener("change",e.toggleDebug.bind(e)),setTimeout((function(){return document.getElementById("overlay").style.opacity=1}),50),document.getElementById("logout").addEventListener("click",(function(){e._kom.post("api/auth/logout/",null).then((function(){window.location="/welcome"}))}))}))}},{key:"hidShowModal",value:function(){var e=this;this._kom.getTemplate("/modal/hideshow").then((function(t){i.replaceString(t.querySelector("#nls-hideshow-modal-title"),"{MODAL_TITLE}",e.nls.modal("hideShowTitle")),i.replaceString(t.querySelector("#nls-hideshow-modal-labels"),"{LABELS_HIDESHOW_MODAL}",e.nls.modal("hideShowLabels")),i.replaceString(t.querySelector("#nls-hideshow-modal-circles"),"{CIRCLES_HIDESHOW_MODAL}",e.nls.modal("hideShowCircles")),i.replaceString(t.querySelector("#nls-hideshow-modal-spots"),"{SPOTS_HIDESHOW_MODAL}",e.nls.modal("hideShowSpots")),i.replaceString(t.querySelector("#nls-hideshow-modal-shops"),"{SHOPS_HIDESHOW_MODAL}",e.nls.modal("hideShowShops")),i.replaceString(t.querySelector("#nls-hideshow-modal-bars"),"{BARS_HIDESHOW_MODAL}",e.nls.modal("hideShowBars")),i.replaceString(t.querySelector("#modal-close-button"),"{MODAL_CLOSE}",e.nls.nav("close")),document.getElementById("overlay").appendChild(t),document.getElementById("overlay").style.display="flex","true"===i.getPreference("poi-marker-label")&&(document.getElementById("label-toggle").checked=!0),"true"===i.getPreference("poi-show-circle")&&(document.getElementById("circle-toggle").checked=!0),"true"===i.getPreference("poi-show-spot")&&(document.getElementById("show-spots").checked=!0),"true"===i.getPreference("poi-show-shop")&&(document.getElementById("show-shops").checked=!0),"true"===i.getPreference("poi-show-bar")&&(document.getElementById("show-bars").checked=!0),document.getElementById("label-toggle").addEventListener("change",e.toggleLabel.bind(e)),document.getElementById("circle-toggle").addEventListener("change",e.toggleCircle.bind(e)),document.getElementById("show-spots").addEventListener("change",e.toggleMarkers.bind(e,"spot")),document.getElementById("show-shops").addEventListener("change",e.toggleMarkers.bind(e,"shop")),document.getElementById("show-bars").addEventListener("change",e.toggleMarkers.bind(e,"bar")),setTimeout((function(){return document.getElementById("overlay").style.opacity=1}),50)}))}},{key:"closeModal",value:function(e,t){!0!==t&&"overlay"!==e.target.id&&-1===e.target.id.indexOf("close")||(document.getElementById("overlay").style.opacity=0,setTimeout((function(){document.getElementById("overlay").style.display="none",document.getElementById("overlay").innerHTML=""}),300))}},{key:"mapClicked",value:function(e){this._newMarker&&this._newMarker.popupClosed?this._newMarker=null:null!==this._newMarker&&this._newMarker.isBeingDefined||(i.getDistanceBetweenCoords([this._user.lat,this._user.lng],[e.latlng.lat,e.latlng.lng])<i.NEW_MARKER_RANGE?this._newMarker=this.definePOI(e.latlng,this._markerSaved.bind(this)):this._notification.raise(this.nls.notif("newMarkerOutside")))}},{key:"_markerSaved",value:function(e){var t=this;this._kom["".concat(e.type,"Created")](this.formatMarker(e)).then((function(){t._marks[e.type].push(e),t._clusters[e.type].addLayer(e.marker),t._notification.raise(t.nls.notif("".concat(e.type,"Added"))),t.updateMarkerCirclesVisibility(),t._newMarker=null}))}},{key:"updateMarkerCirclesVisibility",value:function(){var e=this,t=function(t){for(var n=0;n<t.length;++n)if(e._map.getBounds().contains(t[n].marker.getLatLng())){var r=t[n].marker,a=i.getDistanceBetweenCoords([e._user.lat,e._user.lng],[r.getLatLng().lat,r.getLatLng().lng]);a<i.CIRCLE_RADIUS&&!t[n].circle.visible?(t[n].circle.visible=!0,t[n].circle.setStyle({opacity:1,fillOpacity:.1})):a>=i.CIRCLE_RADIUS&&t[n].circle.visible&&(t[n].circle.visible=!1,t[n].circle.setStyle({opacity:0,fillOpacity:0}))}};"true"===i.getPreference("poi-show-circle")&&(t(this._marks.spot),t(this._marks.shop),t(this._marks.bar),t([this._user]))}},{key:"formatMarker",value:function(e){return{name:e.name,description:e.description,lat:e.lat,lng:e.lng,rate:e.rate}}},{key:"editMarker",value:function(e){this._map.closePopup(),this.editMarkModal(e)}},{key:"deleteMarker",value:function(e){var t=this;this.deleteMarkModal((function(n){!0===n&&function(){for(var n=t._marks[e.type],r=function(r){if(e.lat===n[r].lat&&e.lng===n[r].lng)return t._kom["".concat(e.type,"Deleted")](n[r].id,t.formatMarker(n[r])).then((function(){t.setMarkerCircles([n[r]],!1),t.setMarkerLabels([n[r]],!1),t._clusters[e.type].removeLayer(n[r].marker),n.splice(r,1),t._marks[e.type]=n,t._notification.raise(t.nls.notif("".concat(e.type,"Deleted")))})),"break"},a=0;a<n.length&&"break"!==r(a);++a);}()}))}},{key:"addDebugUI",value:function(){document.body.appendChild(this._debugElement)}},{key:"removeDebugUI",value:function(){document.body.removeChild(this._debugElement)}},{key:"updateDebugUI",value:function(){var e="true"===i.getPreference("map-high-accuracy")?i.HIGH_ACCURACY:i.OPTIMIZED_ACCURACY;i.updateDebugInterface(this._debugElement,this._user,e)}},{key:"downloadData",value:function(){var e="data:text/json;charset=utf-8,".concat(encodeURIComponent(i.getPreference("saved-spot"))),t=document.createElement("A");t.setAttribute("href",e),t.setAttribute("download","BeerCrackerzData.json"),t.click()}},{key:"map",get:function(){return this._map}},{key:"marks",get:function(){return this._marks}},{key:"user",get:function(){return this._user}},{key:"kom",get:function(){return this._kom}},{key:"nls",get:function(){return this._lang}}])&&b(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),l}(m);window.BeerCrackerz=t.default}();