!function(){"use strict";var e={d:function(t,r){for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t={};function r(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}e.d(t,{default:function(){return Ie}});var n=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._csrfToken=this._getCsrfCookie(),this._headers=this._createRequestHeaders(),this.isValid=this._checkValidity()}var t,n;return t=e,n=[{key:"_getCsrfCookie",value:function(){if(document.cookie&&""!==document.cookie)for(var e=document.cookie.split(";"),t=0;t<e.length;++t){var r=e[t].split("=");if(void 0!==r&&r[0].toLowerCase().includes("srf"))return decodeURIComponent(r[1])}return null}},{key:"_createRequestHeaders",value:function(){return[["Content-Type","application/json; charset=UTF-8"],["Accept","application/json"],["X-CSRFToken",this._csrfToken]]}},{key:"_checkValidity",value:function(){return null!==this._csrfToken&&3===this._headers.length}},{key:"_resolveAs",value:function(e,t){return new Promise((function(r,n){t?"raw"===e?200===t.status?r(t.responseText):n(t.status):"json"===e||"text"===e?t[e]?r(t[e]()):n(t.status):"dom"===e?t.text().then((function(e){r(document.createRange().createContextualFragment(e))})).catch(n):r():n("F_KOM_MISSING_ARGUMENT")}))}},{key:"_resolveAsJSON",value:function(e){return this._resolveAs("json",e)}},{key:"_resolveAsText",value:function(e){return this._resolveAs("text",e)}},{key:"_resolveAsDom",value:function(e){return this._resolveAs("dom",e)}},{key:"get",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._resolveAsJSON.bind(this);return new Promise((function(n,i){var o={method:"GET",headers:new Headers([t._headers[0]])};fetch(e,o).then((function(e){return 200!==e.status&&i(e),r(e)})).then(n).catch(i)}))}},{key:"getText",value:function(e){return this.get(e,this._resolveAsText.bind(this))}},{key:"getTemplate",value:function(e){return this.get(e,this._resolveAsDom.bind(this))}},{key:"post",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._resolveAsJSON.bind(this);return new Promise((function(i,o){var s={method:"POST",headers:new Headers(r._headers),body:JSON.stringify(t)};fetch(e,s).then((function(e){return e.status>=400&&o(e),null!=n?n(e):e})).then(i).catch(o)}))}},{key:"postText",value:function(e,t){return this.post(e,t,this._resolveAsText.bind(this))}},{key:"postImage",value:function(e,t){return this.post(e,t,null)}},{key:"patch",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._resolveAsJSON.bind(this);return new Promise((function(i,o){var s={method:"PATCH",headers:new Headers(r._headers),body:JSON.stringify(t)};fetch(e,s).then((function(e){return e.status>=400&&o(e),null!=n?n(e):e})).then(i).catch(o)}))}},{key:"patchImage",value:function(e,t){return this.patch(e,t,null)}},{key:"delete",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._resolveAsJSON.bind(this);return new Promise((function(i,o){var s={method:"DELETE",headers:new Headers(r._headers),body:JSON.stringify(t)};fetch(e,s).then((function(e){return e.status>=400&&o(e),null!=n?n(e):e})).then(i).catch(o)}))}},{key:"_getMarks",value:function(e){var t=this;return new Promise((function(r,n){t.get("http://localhost:8080/api/".concat(e)).then(r).catch(n)}))}},{key:"getSpots",value:function(){return this._getMarks("spot")}},{key:"getShops",value:function(){return this._getMarks("shop")}},{key:"getBars",value:function(){return this._getMarks("bar")}},{key:"_saveMark",value:function(e,t){return this.post("http://localhost:8080/api/".concat(e,"/"),t,this._resolveAsJSON.bind(this))}},{key:"spotCreated",value:function(e){return this._saveMark("spot",e)}},{key:"shopCreated",value:function(e){return this._saveMark("shop",e)}},{key:"barCreated",value:function(e){return this._saveMark("bar",e)}},{key:"_editMark",value:function(e,t,r){return e&&t&&r||Promise.reject(),this.patch("http://localhost:8080/api/".concat(e,"/").concat(t,"/"),r,this._resolveAsJSON.bind(this))}},{key:"spotEdited",value:function(e,t){return this._editMark("spot",e,t)}},{key:"shopEdited",value:function(e,t){return this._editMark("shop",e,t)}},{key:"barEdited",value:function(e,t){return this._editMark("bar",e,t)}},{key:"_deleteMark",value:function(e,t,r){return e&&t&&r||Promise.reject(),this.delete("http://localhost:8080/api/".concat(e,"/").concat(t,"/"),r,null)}},{key:"spotDeleted",value:function(e,t){return this._deleteMark("spot",e,t)}},{key:"shopDeleted",value:function(e,t){return this._deleteMark("shop",e,t)}},{key:"barDeleted",value:function(e,t){return this._deleteMark("bar",e,t)}},{key:"csrf",get:function(){return null}}],n&&r(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),i=n;function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,r=[{key:"stripDom",value:function(e){return!e||"string"!=typeof e&&"number"!=typeof e?"":(new DOMParser).parseFromString(e,"text/html").body.textContent||""}},{key:"replaceString",value:function(e,t,r){return!!(e&&e.innerHTML&&t&&"string"==typeof t&&r&&"string"==typeof r)&&(e.innerHTML=e.innerHTML.replace(t,r),!0)}},{key:"getDistanceBetweenCoords",value:function(e,t){if(!(e&&t&&Array.isArray(e)&&Array.isArray(t)))return-1;if(2!==e.length||"number"!=typeof e[0]||"number"!=typeof e[1])return-1;if(2!==t.length||"number"!=typeof t[0]||"number"!=typeof t[1])return-1;var r=e[0]*Math.PI/180,n=e[1]*Math.PI/180,i=t[0]*Math.PI/180,o=i-r,s=t[1]*Math.PI/180-n,a=Math.pow(Math.sin(o/2),2)+Math.cos(r)*Math.cos(i)*Math.pow(Math.sin(s/2),2);return 2*Math.asin(Math.sqrt(a))*6371e3}},{key:"precisionRound",value:function(e,t){if("number"!=typeof e||"number"!=typeof t)return-1;var r=Math.pow(10,t||0);return Math.round(e*r)/r}},{key:"setDefaultPreferences",value:function(){null===e.getPreference("poi-show-spot")&&e.setPreference("poi-show-spot",!0),null===e.getPreference("poi-show-shop")&&e.setPreference("poi-show-shop",!0),null===e.getPreference("poi-show-bar")&&e.setPreference("poi-show-bar",!0),null===e.getPreference("poi-show-circle")&&e.setPreference("poi-show-circle",!0),null===e.getPreference("poi-show-label")&&e.setPreference("poi-show-label",!0),null===e.getPreference("map-plan-layer")&&e.setPreference("map-plan-layer","Plan OSM"),null===e.getPreference("selected-lang")&&e.setPreference("selected-lang","en"),null===e.getPreference("app-debug")&&e.setPreference("app-debug",!1),null===e.getPreference("map-high-accuracy")&&e.setPreference("map-high-accuracy",!1),null===e.getPreference("map-center-on-user")&&e.setPreference("map-center-on-user",!1),null===e.getPreference("dark-theme")&&e.setPreference("dark-theme",!0)}},{key:"formatMarker",value:function(e){if(!(e&&e.name&&e.types&&e.lat&&e.lng))return null;if("string"!=typeof e.name||!Array.isArray(e.types)||"number"!=typeof e.lat||"number"!=typeof e.lng)return null;for(var t=0;t<e.types.length;++t)if("string"!=typeof e.types[t])return null;if(e.description&&"string"!=typeof e.description)return null;if(e.modifiers){if(!Array.isArray(e.modifiers))return null;for(var r=0;r<e.modifiers.length;++r)if("string"!=typeof e.modifiers[r])return null}return e.rate&&"number"!=typeof e.rate||e.rate<0||e.rate>4||e.price&&"number"!=typeof e.price||e.price<0||e.price>2?null:{name:e.name,types:e.types,lat:e.lat,lng:e.lng,description:e.description,modifiers:e.modifiers,rate:e.rate,price:e.price}}},{key:"removeAllObjectKeys",value:function(e){return!(!e||"object"!==o(e)||Array.isArray(e)||(Object.keys(e).forEach((function(t){delete e[t]})),0))}},{key:"getPreference",value:function(e){return localStorage.getItem(e)||null}},{key:"setPreference",value:function(e,t){localStorage.setItem(e,t)}}],null&&s(t.prototype,null),r&&s(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),c=Object.freeze(["en","fr","es","de","pt"]);function l(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var u=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._lang="",this._fullLang="",this._values={}}var t,r;return t=e,(r=[{key:"_init",value:function(){var e=this;return new Promise((function(t,r){fetch("/static/nls/".concat(e._lang,".json")).then((function(n){200!==n.status&&(n.msg="Fetching the i18n file failed",r(n)),n.text().then((function(i){try{e._values=JSON.parse(i)}catch(e){n.msg="Parsing the i18n file failed",r(n)}t()})).catch(r)})).catch(r)}))}},{key:"updateLang",value:function(e){var t=this;return new Promise((function(r,n){t._lang!==e?(t._lang=-1!==c.indexOf(e)?e:"en",t._fullLang=e,t._init().then(r).catch(n)):r()}))}},{key:"debug",value:function(e){return this._values.debug[e]||""}},{key:"notif",value:function(e){return this._values.notif[e]||""}},{key:"nav",value:function(e){return this._values.nav[e]||""}},{key:"map",value:function(e){return this._values.map[e]||""}},{key:"spot",value:function(e){return this._values.spot[e]||""}},{key:"shop",value:function(e){return this._values.shop[e]||""}},{key:"bar",value:function(e){return this._values.bar[e]||""}},{key:"popup",value:function(e){return this._values.popup[e]||""}},{key:"modal",value:function(e){return this._values.modal[e]||""}},{key:"login",value:function(e){return this._values.auth.login[e]||""}},{key:"register",value:function(e){return this._values.auth.register[e]||""}},{key:"forgotPassword",value:function(e){return this._values.auth.forgotPassword[e]||""}},{key:"resetPassword",value:function(e){return this._values.auth.resetPassword[e]||""}},{key:"handleLoginAside",value:function(e){a.replaceString(e,"{LOGIN_SUBTITLE}",this.login("subtitle")),a.replaceString(e,"{LOGIN_HIDDEN_ERROR}",this.login("hiddenError")),a.replaceString(e,"{LOGIN_USERNAME_LABEL}",this.login("username")),a.replaceString(e,"{LOGIN_USERNAME_PASSWORD}",this.login("password")),a.replaceString(e,"{LOGIN_BUTTON}",this.login("login")),a.replaceString(e,"{LOGIN_NOT_REGISTERED}",this.login("notRegistered")),a.replaceString(e,"{LOGIN_REGISTER}",this.login("register")),a.replaceString(e,"{LOGIN_FORGOT_PASSWORD}",this.login("forgot")),a.replaceString(e,"{LOGIN_PASSWORD_RESET}",this.login("reset"))}},{key:"handleRegisterAside",value:function(e){a.replaceString(e,"{REGISTER_SUBTITLE}",this.register("subtitle")),a.replaceString(e,"{REGISTER_HIDDEN_ERROR}",this.register("hiddenError")),a.replaceString(e,"{REGISTER_USERNAME_LABEL}",this.register("username")),a.replaceString(e,"{REGISTER_MAIL_LABEL}",this.register("mail")),a.replaceString(e,"{REGISTER_USERNAME_PASSWORD_1}",this.register("password1")),a.replaceString(e,"{REGISTER_USERNAME_PASSWORD_2}",this.register("password2")),a.replaceString(e,"{REGISTER_BUTTON}",this.register("register")),a.replaceString(e,"{REGISTER_ALREADY_DONE}",this.register("notRegistered")),a.replaceString(e,"{REGISTER_LOGIN}",this.register("login"))}},{key:"handleForgotPasswordAside",value:function(e){a.replaceString(e,"{FORGOT_PASSWORD_SUBTITLE}",this.forgotPassword("subtitle")),a.replaceString(e,"{FORGOT_PASSWORD_ERROR}",this.register("hiddenError")),a.replaceString(e,"{FORGOT_PASSWORD_MAIL_LABEL}",this.forgotPassword("mail")),a.replaceString(e,"{FORGOT_PASSWORD_BUTTON}",this.forgotPassword("submit")),a.replaceString(e,"{FORGOT_PASSWORD_LOGIN_LABEL}",this.forgotPassword("loginLabel")),a.replaceString(e,"{FORGOT_PASSWORD_LOGIN}",this.forgotPassword("login"))}},{key:"handleResetPasswordAside",value:function(e){a.replaceString(e,"{RESET_PASSWORD_SUBTITLE}",this.resetPassword("subtitle")),a.replaceString(e,"{RESET_PASSWORD_HIDDEN_ERROR}",this.resetPassword("hiddenError")),a.replaceString(e,"{RESET_PASSWORD_1}",this.resetPassword("password1")),a.replaceString(e,"{RESET_PASSWORD_2}",this.resetPassword("password2")),a.replaceString(e,"{RESET_PASSWORD_BUTTON}",this.resetPassword("reset")),a.replaceString(e,"{RESET_PASSWORD_LOGIN_LABEL}",this.resetPassword("loginLabel")),a.replaceString(e,"{RESET_PASSWORD_LOGIN}",this.resetPassword("login"))}},{key:"addMarkModal",value:function(e,t,r){a.replaceString(e.querySelector("#nls-".concat(t,"-title")),"{".concat(t.toUpperCase(),"_TITLE}"),this[t]("".concat(r,"Title"))),a.replaceString(e.querySelector("#nls-".concat(t,"-subtitle")),"{".concat(t.toUpperCase(),"_SUBTITLE}"),this[t]("subtitle")),a.replaceString(e.querySelector("#nls-".concat(t,"-name")),"{".concat(t.toUpperCase(),"_NAME}"),this[t]("nameLabel")),a.replaceString(e.querySelector("#nls-".concat(t,"-desc")),"{".concat(t.toUpperCase(),"_DESC}"),this[t]("descLabel")),a.replaceString(e.querySelector("#nls-".concat(t,"-rate")),"{".concat(t.toUpperCase(),"_RATE}"),this[t]("rateLabel")),a.replaceString(e.querySelector("#nls-".concat(t,"-type")),"{".concat(t.toUpperCase(),"_TYPE}"),this[t]("typeLabel")),a.replaceString(e.querySelector("#nls-".concat(t,"-modifiers")),"{".concat(t.toUpperCase(),"_MODIFIERS}"),this[t]("modifiersLabel")),a.replaceString(e.querySelector("#".concat(t,"-submit")),"{".concat(t.toUpperCase(),"_SUBMIT}"),this.nav("add")),a.replaceString(e.querySelector("#".concat(t,"-close")),"{".concat(t.toUpperCase(),"_CANCEL}"),this.nav("cancel")),e.querySelector("#nls-".concat(t,"-price"))&&a.replaceString(e.querySelector("#nls-".concat(t,"-price")),"{".concat(t.toUpperCase(),"_PRICE}"),this[t]("priceLabel"))}},{key:"deleteMarkModal",value:function(e){a.replaceString(e.querySelector("#nls-modal-title"),"{MODAL_TITLE}",this.modal("deleteMarkTitle")),a.replaceString(e.querySelector("#nls-modal-desc"),"{MODAL_DESC}",this.modal("deleteMarkDesc")),a.replaceString(e.querySelector("#cancel-close"),"{MODAL_CANCEL}",this.nav("cancel")),a.replaceString(e.querySelector("#delete-close"),"{MODAL_DELETE}",this.nav("delete"))}},{key:"userProfileModal",value:function(e){a.replaceString(e.querySelector("#nls-modal-title"),"{MODAL_TITLE}",this.modal("userTitle")),a.replaceString(e.querySelector("#nls-user-high-accuracy"),"{ACCURACY_USER_CHECK}",this.modal("userAccuracyPref")),a.replaceString(e.querySelector("#nls-user-dark-theme"),"{DARK_THEME_CHECK}",this.modal("darkThemePref")),a.replaceString(e.querySelector("#nls-user-debug"),"{DEBUG_USER_CHECK}",this.modal("userDebugPref")),a.replaceString(e.querySelector("#nls-lang-select"),"{LANG_SELECT}",this.modal("langPref")),a.replaceString(e.querySelector("#nls-lang-fr"),"{LANG_FR}",this.modal("langFr")),a.replaceString(e.querySelector("#nls-lang-en"),"{LANG_EN}",this.modal("langEn")),a.replaceString(e.querySelector("#nls-lang-es"),"{LANG_ES}",this.modal("langEs")),a.replaceString(e.querySelector("#nls-lang-de"),"{LANG_DE}",this.modal("langDe")),a.replaceString(e.querySelector("#nls-lang-pt"),"{LANG_PT}",this.modal("langPt")),a.replaceString(e.querySelector("#nls-about-desc"),"{BEERCRACKERZ_DESC}",this.modal("aboutDesc")),a.replaceString(e.querySelector("#nls-update-pp"),"{UPDATE_PROFILE_PIC_LABEL}",this.modal("updatePP"))}},{key:"updateProfilePictureModal",value:function(e){a.replaceString(e.querySelector("#nls-modal-title"),"{MODAL_TITLE}",this.modal("updatePPTitle")),a.replaceString(e.querySelector("#nls-modal-desc"),"{UPDATE_PP_DESC}",this.modal("updatePPDesc")),a.replaceString(e.querySelector("#update-pp-close"),"{UPDATE_PP_CANCEL}",this.nav("cancel")),a.replaceString(e.querySelector("#update-pp-submit"),"{UPDATE_PP_SUBMIT}",this.nav("upload"))}},{key:"hideShowModal",value:function(e){a.replaceString(e.querySelector("#nls-hideshow-modal-title"),"{MODAL_TITLE}",this.modal("hideShowTitle")),a.replaceString(e.querySelector("#nls-hideshow-modal-labels"),"{LABELS_HIDESHOW_MODAL}",this.modal("hideShowLabels")),a.replaceString(e.querySelector("#nls-hideshow-modal-circles"),"{CIRCLES_HIDESHOW_MODAL}",this.modal("hideShowCircles")),a.replaceString(e.querySelector("#nls-hideshow-modal-spots"),"{SPOTS_HIDESHOW_MODAL}",this.modal("hideShowSpots")),a.replaceString(e.querySelector("#nls-hideshow-modal-shops"),"{SHOPS_HIDESHOW_MODAL}",this.modal("hideShowShops")),a.replaceString(e.querySelector("#nls-hideshow-modal-bars"),"{BARS_HIDESHOW_MODAL}",this.modal("hideShowBars")),a.replaceString(e.querySelector("#nls-view-helper-label"),"{HELPER_LABEL}",this.modal("hideShowHelperLabel")),a.replaceString(e.querySelector("#modal-close-button"),"{MODAL_CLOSE}",this.nav("close"))}},{key:"markPopup",value:function(e,t){a.replaceString(e,"{".concat(t.type.toUpperCase(),"_NAME}"),a.stripDom(t.name)),a.replaceString(e,"{".concat(t.type.toUpperCase(),"_FINDER}"),t.user),a.replaceString(e,"{".concat(t.type.toUpperCase(),"_FOUND_BY}"),this.popup("".concat(t.type,"FoundBy"))),a.replaceString(e,"{".concat(t.type.toUpperCase(),"_FOUND_WHEN}"),this.popup("".concat(t.type,"FoundWhen"))),a.replaceString(e,"{".concat(t.type.toUpperCase(),"_FOUND_DATE}"),t.date),a.replaceString(e,"{".concat(t.type.toUpperCase(),"_RATE}"),t.rate+1),a.replaceString(e,"{".concat(t.type.toUpperCase(),"_DESC}"),t.desc)}},{key:"fullLang",get:function(){return this._fullLang}}])&&l(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var h=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._map=t,this._container=document.querySelector("#zoom-slider"),this._slider=document.querySelector("#slider-position"),this._zoomRange=this._map.getMaxZoom()-this._map.getMinZoom(),this._timeoutId=-1,this._events()}var t,r;return t=e,(r=[{key:"_events",value:function(){var e=this;this._map.on("zoomstart",this._zoomStart.bind(this)),this._map.on("zoomend",this._zoomEnd.bind(this)),this._map.on("zoom",(function(){return e._zoom.bind(e)})),this._container.addEventListener("mouseover",this._clearTimeout.bind(this)),this._container.querySelector("#slider-wrapper").addEventListener("click",this._relativeZoom.bind(this)),this._container.addEventListener("mouseleave",this._startTimeout.bind(this)),this._container.querySelector("#zoom-more").addEventListener("click",this._zoomIn.bind(this)),this._container.querySelector("#zoom-less").addEventListener("click",this._zoomOut.bind(this))}},{key:"_zoomStart",value:function(){this._clearTimeout(),this._container.classList.add("opened")}},{key:"_zoomEnd",value:function(){var e=this._map.getZoom()-this._map.getMinZoom();this._slider.style.height="".concat(100*e/this._zoomRange,"%"),this._startTimeout()}},{key:"_zoom",value:function(){this._clearTimeout();var e=this._map.getZoom()-this._map.getMinZoom();this._slider.style.height="".concat(100*e/this._zoomRange,"%")}},{key:"_zoomIn",value:function(){this._map.setZoom(this._map.getZoom()+1)}},{key:"_zoomOut",value:function(){this._map.setZoom(this._map.getZoom()-1)}},{key:"_relativeZoom",value:function(e){this._clearTimeout();var t=this._container.querySelector("#slider-wrapper").getBoundingClientRect(),r=(t.height-(e.pageY-t.top))/t.height;this._slider.style.height="".concat(100*r,"%"),this._map.setZoom(this._map.getMinZoom()+100*r*this._zoomRange/100)}},{key:"_startTimeout",value:function(){var e=this;this._timeoutId=setTimeout((function(){e._container.classList.remove("opened")}),1500)}},{key:"_clearTimeout",value:function(){clearTimeout(this._timeoutId),this._timeoutId=-1}}])&&d(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function p(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var f=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._container=document.querySelector("#notification-wrapper"),this._message=document.querySelector("#notification-message"),this._timeoutId=null}var t,r;return t=e,(r=[{key:"raise",value:function(e){var t=this;clearTimeout(this._timeoutId),this._message.innerHTML=e,this._container.classList.add("opened"),this._timeoutId=setTimeout((function(){t._container.classList.remove("opened"),t._message.innerHTML=""}),2e3)}}])&&p(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),m=Object.freeze({optimized:{enableHighAccuracy:!1,maximumAge:3e4,timeout:29e3},high:{enableHighAccuracy:!0,maximumAge:1e3,timeout:900}}),y=Object.freeze({newMarkRange:"#FFD87D",user:"#63FFF5"}),_=Object.freeze({newMarkRange:55,socialMarkRange:100,mapBounds:window.L.latLngBounds(window.L.latLng(-89.98155760646617,-180),window.L.latLng(89.99346179538875,180))}),g=Object.freeze({blue:new window.L.Icon({iconUrl:"/static/img/marker/marker-icon-blue.png",shadowUrl:"/static/img/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),gold:new window.L.Icon({iconUrl:"/static/img/marker/marker-icon-gold.png",shadowUrl:"/static/img/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),red:new window.L.Icon({iconUrl:"/static/img/marker/marker-icon-red.png",shadowUrl:"/static/img/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),green:new window.L.Icon({iconUrl:"/static/img/marker/marker-icon-green.png",shadowUrl:"/static/img/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),orange:new window.L.Icon({iconUrl:"/static/img/marker/marker-icon-orange.png",shadowUrl:"/static/img/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),yellow:new window.L.Icon({iconUrl:"/static/img/marker/marker-icon-yellow.png",shadowUrl:"/static/img/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),violet:new window.L.Icon({iconUrl:"/static/img/marker/marker-icon-violet.png",shadowUrl:"/static/img/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),grey:new window.L.Icon({iconUrl:"/static/img/marker/marker-icon-grey.png",shadowUrl:"/static/img/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),black:new window.L.Icon({iconUrl:"/static/img/marker/marker-icon-black.png",shadowUrl:"/static/img/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),user:new window.L.Icon({iconUrl:"/static/img/marker/user-position.png",shadowUrl:"/static/img/marker/user-position-shadow.png",iconSize:[32,32],iconAnchor:[16,16],popupAnchor:[1,-34],shadowSize:[32,32]})});function v(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var b=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,r=[{key:"initDebugUI",value:function(){var e=window.BeerCrackerz.nls.debug.bind(window.BeerCrackerz.nls),t=document.createElement("DIV"),r=document.createElement("H1"),n=document.createElement("P"),i=document.createElement("P"),o=document.createElement("P"),s=document.createElement("P"),a=document.createElement("P"),c=document.createElement("P"),l=document.createElement("P"),u=document.createElement("P"),d=document.createElement("P");return t.classList.add("debug-container"),n.classList.add("debug-user-lat"),i.classList.add("debug-user-lng"),o.classList.add("debug-updates-amount"),s.classList.add("debug-user-accuracy"),a.classList.add("debug-high-accuracy"),c.classList.add("debug-pos-max-age"),l.classList.add("debug-pos-timeout"),u.classList.add("debug-zoom-level"),d.classList.add("debug-marks-amount"),r.innerHTML="BeerCrackerz v".concat(window.VERSION),n.innerHTML="<b>".concat(e("lat"),"</b> -"),i.innerHTML="<b>".concat(e("lng"),"</b> -"),o.innerHTML="<b>".concat(e("updates"),"</b> 0"),s.innerHTML="<b>".concat(e("accuracy"),"</b> -"),a.innerHTML="<b>".concat(e("highAccuracy"),"</b> -"),c.innerHTML="<b>".concat(e("posAge"),"</b> -"),l.innerHTML="<b>".concat(e("posTimeout"),"</b> -"),u.innerHTML="<b>".concat(e("zoom"),"</b> -"),d.innerHTML="<b>".concat(e("marks"),"</b> -"),t.appendChild(r),t.appendChild(n),t.appendChild(i),t.appendChild(o),t.appendChild(s),t.appendChild(a),t.appendChild(c),t.appendChild(l),t.appendChild(u),t.appendChild(d),t}},{key:"addDebugUI",value:function(){document.body.appendChild(window.BeerCrackerz.debugElement)}},{key:"removeDebugUI",value:function(){document.body.removeChild(window.BeerCrackerz.debugElement)}},{key:"updateDebugUI",value:function(){if(!0===window.DEBUG){var e="true"===a.getPreference("map-high-accuracy")?m.high:m.optimized,t=window.BeerCrackerz.debugElement,r=window.BeerCrackerz.user,n=window.BeerCrackerz,i=n.nls.debug.bind(n.nls),o=parseInt(t.querySelector(".debug-updates-amount").innerHTML.split(" ")[1])+1,s=n.marks.spot.length+n.marks.shop.length+n.marks.bar.length;t.querySelector(".debug-user-lat").innerHTML="<b>".concat(i("lat"),"</b> ").concat(r.lat),t.querySelector(".debug-user-lng").innerHTML="<b>".concat(i("lng"),"</b> ").concat(r.lng),t.querySelector(".debug-updates-amount").innerHTML="<b>".concat(i("updates"),"</b> ").concat(o),t.querySelector(".debug-user-accuracy").innerHTML="<b>".concat(i("accuracy"),"</b> ").concat(a.precisionRound(r.accuracy,2),"m"),t.querySelector(".debug-high-accuracy").innerHTML="<b>".concat(i("highAccuracy"),"</b> ").concat(!0===e.enableHighAccuracy?i("enabled"):i("disabled")),t.querySelector(".debug-pos-max-age").innerHTML="<b>".concat(i("posAge"),"</b> ").concat(e.maximumAge/1e3,"s"),t.querySelector(".debug-pos-timeout").innerHTML="<b>".concat(i("posTimeout"),"</b> ").concat(e.timeout/1e3,"s"),t.querySelector(".debug-zoom-level").innerHTML="<b>".concat(i("zoom"),"</b> ").concat(n.map.getZoom()),t.querySelector(".debug-marks-amount").innerHTML="<b>".concat(i("marks"),"</b> ").concat(s)}}},{key:"drawUserMarker",value:function(){window.BeerCrackerz.user.marker?(window.BeerCrackerz.user.marker.setLatLng(window.BeerCrackerz.user),window.BeerCrackerz.user.range.setLatLng(window.BeerCrackerz.user),window.BeerCrackerz.user.circle.setLatLng(window.BeerCrackerz.user),window.BeerCrackerz.user.circle.setRadius(window.BeerCrackerz.user.accuracy)):(window.BeerCrackerz.user.type="user",window.BeerCrackerz.user.marker=e.addMark(window.BeerCrackerz.user),window.BeerCrackerz.user.radius=window.BeerCrackerz.user.accuracy,window.BeerCrackerz.user.circle=e.drawCircle(window.BeerCrackerz.user),window.BeerCrackerz.user.range=e.drawCircle({lat:window.BeerCrackerz.user.lat,lng:window.BeerCrackerz.user.lng,radius:_.newMarkRange,color:y.newMarkRange}),window.BeerCrackerz.user.circle.addTo(window.BeerCrackerz.map),window.BeerCrackerz.user.range.addTo(window.BeerCrackerz.map),"true"===a.getPreference("poi-show-circle")&&(window.BeerCrackerz.user.circle.setStyle({opacity:1,fillOpacity:.1}),window.BeerCrackerz.user.range.setStyle({opacity:1,fillOpacity:.1})),window.BeerCrackerz.user.marker.on("click",window.BeerCrackerz.mapClicked.bind(window.BeerCrackerz)))}},{key:"drawCircle",value:function(e){return window.L.circle(e,{color:e.color,fillColor:e.color,opacity:0,fillOpacity:0,radius:e.radius?e.radius:_.socialMarkRange})}},{key:"setMarkerCircles",value:function(e){for(var t=function(t){for(var r=0;r<t.length;++r)e?(t[r].circle.setStyle({opacity:1,fillOpacity:.1}),t[r].circle.addTo(window.BeerCrackerz.map)):(t[r].circle.setStyle({opacity:0,fillOpacity:0}),t[r].circle.removeFrom(window.BeerCrackerz.map))},r=Object.keys(window.BeerCrackerz.marks),n=0;n<r.length;++n)t(window.BeerCrackerz.marks[r[n]]);t([window.BeerCrackerz.user]),t([{circle:window.BeerCrackerz.user.range}])}},{key:"updateMarkerCirclesVisibility",value:function(){if("true"===a.getPreference("poi-show-circle")){var e=function(e){for(var t=0;t<e.length;++t)if(window.BeerCrackerz.map.getBounds().contains(e[t].marker.getLatLng())){var r=e[t].marker,n=a.getDistanceBetweenCoords([window.BeerCrackerz.user.lat,window.BeerCrackerz.user.lng],[r.getLatLng().lat,r.getLatLng().lng]);n<_.socialMarkRange&&!e[t].circle.visible?(e[t].circle.visible=!0,e[t].circle.setStyle({opacity:1,fillOpacity:.1})):n>=_.socialMarkRange&&e[t].circle.visible&&(e[t].circle.visible=!1,e[t].circle.setStyle({opacity:0,fillOpacity:0}))}};e(window.BeerCrackerz.marks.spot),e(window.BeerCrackerz.marks.shop),e(window.BeerCrackerz.marks.bar),e([window.BeerCrackerz.user])}}},{key:"setMarkerLabels",value:function(e){for(var t=function(t){for(var r=0;r<t.length;++r)e&&!1===t[r].clustered?t[r].tooltip.addTo(window.BeerCrackerz.map):t[r].tooltip.removeFrom(window.BeerCrackerz.map)},r=Object.keys(window.BeerCrackerz.marks),n=0;n<r.length;++n)t(window.BeerCrackerz.marks[r[n]])}},{key:"removeMarkDecoration",value:function(e){e.tooltip.removeFrom(window.BeerCrackerz.map),e.circle.setStyle({opacity:0,fillOpacity:0}),e.circle.removeFrom(window.BeerCrackerz.map),e.popup&&e.popup.destroy()}},{key:"addMark",value:function(t){var r=g.black;"shop"===t.type?r=g.blue:"spot"===t.type?r=g.green:"bar"===t.type?r=g.red:"user"===t.type&&(r=g.user);var n=window.L.marker([t.lat,t.lng],{icon:r}).on("click",e.centerOn.bind(e,t));return t.dom&&n.bindPopup(t.dom),-1===["spot","shop","bar"].indexOf(t.type)&&n.addTo(window.BeerCrackerz.map),n}},{key:"toggleLabel",value:function(){var t=!("true"===a.getPreference("poi-show-label"));e.setMarkerLabels(t),a.setPreference("poi-show-label",t)}},{key:"toggleCircle",value:function(){var t=!("true"===a.getPreference("poi-show-circle"));e.setMarkerCircles(t),a.setPreference("poi-show-circle",t)}},{key:"toggleMarkers",value:function(e){var t=e.target.dataset.type,r=!("true"===a.getPreference("poi-show-".concat(t)));if(!0===r){for(var n=0;n<window.BeerCrackerz.marks[t].length;++n)window.BeerCrackerz.marks[t][n].visible=!0,window.BeerCrackerz.marks[t][n].circle.setStyle({opacity:1,fillOpacity:.1});window.BeerCrackerz.map.addLayer(window.BeerCrackerz.clusters[t])}else{for(var i=0;i<window.BeerCrackerz.marks[t].length;++i)window.BeerCrackerz.marks[t][i].visible=!1,window.BeerCrackerz.marks[t][i].circle.setStyle({opacity:0,fillOpacity:0});window.BeerCrackerz.map.removeLayer(window.BeerCrackerz.clusters[t])}a.setPreference("poi-show-".concat(t),r)}},{key:"toggleDebug",value:function(){var t=!window.DEBUG;window.DEBUG=t,a.setPreference("app-debug",t),t?e.addDebugUI():e.removeDebugUI()}},{key:"toggleDarkTheme",value:function(){var e="true"===a.getPreference("dark-theme");a.setPreference("dark-theme",!e),!0===e?(document.body.classList.remove("dark-theme"),document.body.classList.add("light-theme")):(document.body.classList.remove("light-theme"),document.body.classList.add("dark-theme"))}},{key:"toggleFocusLock",value:function(){"true"===a.getPreference("map-center-on-user")?(window.BeerCrackerz.notification.raise(window.BeerCrackerz.nls.notif("unlockFocusOn")),document.getElementById("center-on").classList.remove("lock-center-on"),a.setPreference("map-center-on-user","false")):(window.BeerCrackerz.notification.raise(window.BeerCrackerz.nls.notif("lockFocusOn")),document.getElementById("center-on").classList.add("lock-center-on"),window.BeerCrackerz.map.flyTo([window.BeerCrackerz.user.lat,window.BeerCrackerz.user.lng],18),a.setPreference("map-center-on-user","true"))}},{key:"centerOn",value:function(t){"true"===a.getPreference("map-center-on-user")&&e.toggleFocusLock(),window.BeerCrackerz.map.flyTo([t.lat,t.lng],18)}},{key:"checkClusteredMark",value:function(e){if("true"===a.getPreference("poi-show-label"))for(var t=window.BeerCrackerz.marks[e],r=0;r<t.length;++r){var n=window.BeerCrackerz.map.hasLayer(t[r].marker);t[r].clustered=!n,n?t[r].tooltip.addTo(window.BeerCrackerz.map):t[r].tooltip.removeFrom(window.BeerCrackerz.map)}}}],null&&v(t.prototype,null),r&&v(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function w(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var k=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._opts=t,this._popup=null,this._cb=r,this._evtIds=[],this._fetchTemplate().then(this._init.bind(this)).then(this._events.bind(this)).finally(this._ready.bind(this))}var t,r;return t=e,(r=[{key:"destroy",value:function(){for(var e=0;e<this._evtIds.length;++e)window.Evts.removeEvent(this._evtIds[e]);this._opts=null,this._popup=null,this._cb=null,this._evtIds=[]}},{key:"_fetchTemplate",value:function(){var e=this;return new Promise((function(t,r){window.BeerCrackerz.kom.getTemplate("/popup/".concat(e._opts.type)).then(t).catch(r)}))}},{key:"_init",value:function(e){var t=this;return new Promise((function(r){t._popup=document.createElement("DIV"),t._popup.appendChild(e);var n=t._opts.user||window.BeerCrackerz.user.username,i=a.stripDom(t._opts.description)||window.BeerCrackerz.nls.popup("".concat(t._opts.type,"NoDesc"));t._opts.creationDate||(t._opts.creationDate=(new Date).toISOString().slice(0,10));var o=new Intl.DateTimeFormat(window.BeerCrackerz.nls.fullLang,{dateStyle:"long"}).format(new Date(t._opts.creationDate));window.BeerCrackerz.nls.markPopup(t._popup,{type:t._opts.type,name:t._opts.name,user:n,rate:t._opts.rate,desc:i,date:o});for(var s=t._popup.querySelector("#".concat(t._opts.type,"-rating")),c=0;c<t._opts.rate+1;++c)s.children[c].classList.add("active");a.getDistanceBetweenCoords([window.BeerCrackerz.user.lat,window.BeerCrackerz.user.lng],[t._opts.lat,t._opts.lng])>_.socialMarkRange&&t._popup.querySelector("#popup-social").parentNode.removeChild(t._popup.querySelector("#popup-social")),n!==window.BeerCrackerz.user.username&&t._popup.querySelector("#popup-edit").parentNode.removeChild(t._popup.querySelector("#popup-edit")),t._opts.color=a["".concat(t._opts.type.toUpperCase(),"_COLOR")],t._opts.circle=b.drawCircle(t._opts),t._opts.circle.addTo(window.BeerCrackerz.map);var l=document.createElement("P");if(l.innerHTML=t._opts.name,t._opts.price){var u=document.createElement("DIV");u.classList.add("label-pricing");for(var d=0;d<t._opts.price+1;++d){var h=document.createElement("IMG");h.src="static/img/logo/dollar.svg",u.appendChild(h)}l.appendChild(u)}t._opts.tooltip=window.L.tooltip({permanent:!0,direction:"center",className:"marker-tooltip",interactive:!0}).setContent(l).setLatLng(t._opts.circle.getLatLng()),t._opts.tooltip.addTo(window.BeerCrackerz.map),"false"===a.getPreference("poi-show-label")&&t._opts.tooltip.removeFrom(window.BeerCrackerz.map),r()}))}},{key:"_events",value:function(){var e=this;return new Promise((function(t){e._opts.user===window.BeerCrackerz.user.username&&(e._evtIds.push(window.Evts.addEvent("click",e._popup.querySelector("#edit-mark"),(function(){window.Evts.publish("editMark",e._opts)}),e)),e._evtIds.push(window.Evts.addEvent("click",e._popup.querySelector("#delete-mark"),(function(){window.Evts.publish("deleteMark",e._opts)}),e))),e._evtIds.push(window.Evts.addEvent("click",e._opts.tooltip.getElement(),(function(t){t.preventDefault(),t.stopPropagation(),window.Evts.publish("centerOn",e._opts)}),e)),t()}))}},{key:"_ready",value:function(){this._cb(this._popup)}},{key:"dom",get:function(){return this._popup}},{key:"options",get:function(){return this._opts}}])&&w(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function E(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var S=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._type=t,this._url="/modal/".concat(this._type),this._rootElement=null,this._modalOverlay=null,this._closeButton=null,this._evtIds=[],this._loadTemplate()}var t,r;return t=e,(r=[{key:"destroy",value:function(){for(var e=this,t=0;t<this._evtIds.length;++t)window.Evts.removeEvent(this._evtIts);Object.keys(this).forEach((function(t){delete e[t]}))}},{key:"_loadTemplate",value:function(){var e=this;window.BeerCrackerz.kom.getTemplate(this._url).then((function(t){e._rootElement=t.firstElementChild,e._rootElement.classList.add("".concat(e._type,"-modal")),e._modalOverlay=document.createElement("DIV"),e._modalOverlay.id="overlay",e._modalOverlay.classList.add("overlay"),document.body.appendChild(e._modalOverlay),e._closeButton=e._rootElement.querySelector("#modal-close"),e.open(),e._fillAttributes()})).catch((function(e){console.error(e)}))}},{key:"_fillAttributes",value:function(){}},{key:"open",value:function(){var e=this;this._evtIds.push(window.Evts.addEvent("click",this._modalOverlay,this.close,this)),this._evtIds.push(window.Evts.addEvent("click",this._closeButton,this.close,this)),this._modalOverlay.appendChild(this._rootElement),this._modalOverlay.style.display="flex",setTimeout((function(){return e._modalOverlay.style.opacity=1}),50)}},{key:"close",value:function(e,t){var r=this;e&&e.stopPropagation&&e.stopPropagation(),!0!==t&&"overlay"!==e.target.id&&-1===e.target.id.indexOf("close")||(this._modalOverlay.style.opacity=0,setTimeout((function(){r._modalOverlay.style.display="none",r._modalOverlay.innerHTML="",r.destroy()}),200))}}])&&E(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),P=Object.freeze({spot:{types:["forest","river","mountain","beach","city","pov"],modifiers:["bench","covered","toilet","store","trash","parking"]},shop:{types:["store","super","hyper","cellar"],modifiers:["bio","craft","fresh","card","choice"]},bar:{types:["regular","snack","cellar","rooftop"],modifiers:["tobacco","food","card","choice","outdoor"]}});function z(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var C=function(){function e(t,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._container=null,this._items=[],this._currentRate=r||0,this._clicked=r||-1,this._init(t),this._events()}var t,r;return t=e,(r=[{key:"_init",value:function(e){this._container=e;for(var t=0;t<e.children.length;++t)this._items.push(e.children[t]);for(var r=0;r<this._currentRate+1;++r)this._items[r].classList.add("active"),this._items[r].classList.add("selected")}},{key:"_events",value:function(){this._container.addEventListener("mouseover",this._containerHovered.bind(this),!1),this._container.addEventListener("mouseout",this._pointerExit.bind(this),!1);for(var e=0;e<this._items.length;++e)this._items[e].addEventListener("click",this._starClicked.bind(this),!1)}},{key:"_containerHovered",value:function(e){"IMG"===e.target.tagName&&(this._currentRate=parseInt(e.target.dataset.id),this._container.dataset.rate=this._currentRate,this.updateVisu())}},{key:"_pointerExit",value:function(){this._currentRate=-1===this._clicked?0:this._clicked,this._container.dataset.rate=this._currentRate,this.updateVisu()}},{key:"_starClicked",value:function(e){this._currentRate=parseInt(e.target.dataset.id),this._container.dataset.rate=this._currentRate,this._clicked=this._currentRate,this.updateVisu()}},{key:"updateVisu",value:function(){for(var e=0;e<this._items.length;++e)e<=this._currentRate?(this._items[e].classList.add("active"),e<=this._clicked&&this._items[e].classList.add("selected")):(this._items[e].classList.remove("active"),this._items[e].classList.remove("selected"))}},{key:"updateRate",value:function(e){this.currentRate=e,this.clicked=e}},{key:"currentRate",get:function(){return this._currentRate},set:function(e){this._currentRate=e}},{key:"clicked",set:function(e){this._clicked=e}}])&&z(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function O(e){return O="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},O(e)}function R(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function L(e,t){return L=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},L(e,t)}function M(e,t){if(t&&("object"===O(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function B(e){return B=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},B(e)}var T=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&L(e,t)}(s,e);var t,r,n,i,o=(n=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=B(n);if(i){var r=B(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return M(this,e)});function s(e,t){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(r=o.call(this,"".concat(e).concat(t.type)))._opts=t,r._action=e,r._name="",r._description="",r._rating=null,r._pricing=null,r}return t=s,(r=[{key:"_fillAttributes",value:function(){this._opts.user=window.BeerCrackerz.user.username,window.BeerCrackerz.nls.addMarkModal(this._rootElement,this._opts.type,this._action);var e=function(e){e.target.closest("p").classList.contains("selected")?e.target.closest("p").classList.remove("selected"):e.target.closest("p").classList.add("selected")};this._name=this._rootElement.querySelector("#".concat(this._opts.type,"-name"));for(var t=this._rootElement.querySelector("#".concat(this._opts.type,"-types")),r=0;r<P[this._opts.type].types.length;++r){var n=document.createElement("P"),i=document.createElement("IMG");n.dataset.type=P[this._opts.type].types[r],i.dataset.type=n.dataset.type,i.src="/static/img/logo/".concat(P[this._opts.type].types[r],".svg"),n.innerHTML=window.BeerCrackerz.nls[this._opts.type]("".concat(P[this._opts.type].types[r],"Type")),n.insertBefore(i,n.firstChild),t.appendChild(n),this._evtIds.push(window.Evts.addEvent("click",n,e,this))}this._description=this._rootElement.querySelector("#".concat(this._opts.type,"-desc"));for(var o=this._rootElement.querySelector("#".concat(this._opts.type,"-modifiers")),s=0;s<P[this._opts.type].modifiers.length;++s){var a=document.createElement("P"),c=document.createElement("IMG");a.dataset.type=P[this._opts.type].modifiers[s],c.dataset.type=a.dataset.type,c.src="/static/img/logo/".concat(P[this._opts.type].modifiers[s],".svg"),a.innerHTML=window.BeerCrackerz.nls[this._opts.type]("".concat(P[this._opts.type].modifiers[s],"Modifier")),a.insertBefore(c,a.firstChild),o.appendChild(a),this._evtIds.push(window.Evts.addEvent("click",a,e,this))}this._rating=new C(this._rootElement.querySelector("#".concat(this._opts.type,"-rating"))),this._rootElement.querySelector("#nls-".concat(this._opts.type,"-price"))&&(this._pricing=new C(this._rootElement.querySelector("#".concat(this._opts.type,"-pricing")))),this._events()}},{key:"_events",value:function(){this._evtIds.push(window.Evts.addEvent("click",this._rootElement.querySelector("#".concat(this._opts.type,"-close")),this.close,this)),this._evtIds.push(window.Evts.addEvent("click",this._rootElement.querySelector("#".concat(this._opts.type,"-submit")),this.submit,this))}},{key:"submit",value:function(e){e.preventDefault();var t=!0;return this._rootElement.querySelector("#nls-".concat(this._opts.type,"-name")).classList.remove("error"),this._name.classList.remove("error"),this._rootElement.querySelector("#nls-".concat(this._opts.type,"-type")).classList.remove("error"),""===this._name.value?(this._rootElement.querySelector("#nls-".concat(this._opts.type,"-name")).classList.add("error"),this._name.classList.add("error"),window.BeerCrackerz.notification.raise(window.BeerCrackerz.nls.notif("markNameEmpty")),t=!1):0===this.getTypes().length&&(this._rootElement.querySelector("#nls-".concat(this._opts.type,"-type")).classList.add("error"),window.BeerCrackerz.notification.raise(window.BeerCrackerz.nls.notif("markTypeEmpty")),t=!1),t}},{key:"getTypes",value:function(){for(var e=[],t=this._rootElement.querySelector("#".concat(this._opts.type,"-types")),r=0;r<t.children.length;++r)t.children[r].classList.contains("selected")&&e.push(t.children[r].dataset.type);return e}},{key:"getModifiers",value:function(){for(var e=[],t=this._rootElement.querySelector("#".concat(this._opts.type,"-modifiers")),r=0;r<t.children.length;++r)t.children[r].classList.contains("selected")&&e.push(t.children[r].dataset.type);return e}}])&&R(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),s}(S);function I(e){return I="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},I(e)}function A(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function D(){return D="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=j(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},D.apply(this,arguments)}function j(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=x(e)););return e}function q(e,t){return q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},q(e,t)}function U(e,t){if(t&&("object"===I(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function x(e){return x=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},x(e)}var H=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&q(e,t)}(s,e);var t,r,n,i,o=(n=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=x(n);if(i){var r=x(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return U(this,e)});function s(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),o.call(this,"add",e)}return t=s,(r=[{key:"submit",value:function(e){D(x(s.prototype),"submit",this).call(this,e)&&(this._opts.name=this._name.value,this._opts.description=this._description.value,this._opts.types=this.getTypes(),this._opts.modifiers=this.getModifiers(),this._opts.rate=this._rating.currentRate,this._rootElement.querySelector("#nls-".concat(this._opts.type,"-price"))&&(this._opts.price=this._pricing.currentRate),window.Evts.publish("onMarkAdded",this._opts),this.close(null,!0))}},{key:"close",value:function(e,t){!0!==t&&"overlay"!==e.target.id&&-1===e.target.id.indexOf("close")||(this._opts.marker.isBeingDefined=!1,this._opts.marker.removeFrom(window.BeerCrackerz.map)),D(x(s.prototype),"close",this).call(this,e,t)}}])&&A(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),s}(T);function N(e){return N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},N(e)}function G(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function F(e,t){return F=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},F(e,t)}function W(e,t){if(t&&("object"===N(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Z(e){return Z=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Z(e)}var V=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&F(e,t)}(s,e);var t,r,n,i,o=(n=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Z(n);if(i){var r=Z(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return W(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=o.call(this,"deletemark"))._opts=e,t._footerCancelButton=null,t._footerSubmitButton=null,t}return t=s,(r=[{key:"_fillAttributes",value:function(){window.BeerCrackerz.nls.deleteMarkModal(this._rootElement),this._footerCancelButton=this._rootElement.querySelector("#cancel-close"),this._footerSubmitButton=this._rootElement.querySelector("#delete-close"),this._events()}},{key:"_events",value:function(){this._evtIds.push(window.Evts.addEvent("click",this._footerCancelButton,this.close,this)),this._evtIds.push(window.Evts.addEvent("click",this._footerSubmitButton,this.submit,this))}},{key:"submit",value:function(e){e.preventDefault(),window.Evts.publish("onMarkDeleted",this._opts)}}])&&G(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),s}(S);function Y(e){return Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Y(e)}function J(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function X(){return X="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,r){var n=K(e,t);if(n){var i=Object.getOwnPropertyDescriptor(n,t);return i.get?i.get.call(arguments.length<3?e:r):i.value}},X.apply(this,arguments)}function K(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ee(e)););return e}function Q(e,t){return Q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Q(e,t)}function $(e,t){if(t&&("object"===Y(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function ee(e){return ee=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ee(e)}var te=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Q(e,t)}(s,e);var t,r,n,i,o=(n=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ee(n);if(i){var r=ee(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return $(this,e)});function s(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),o.call(this,"edit",e)}return t=s,(r=[{key:"_fillAttributes",value:function(){var e=this;X(ee(s.prototype),"_fillAttributes",this).call(this),this._rootElement.querySelector("#".concat(this._opts.type,"-name")).value=this._opts.name,this._rootElement.querySelector("#".concat(this._opts.type,"-desc")).value=this._opts.description,this._rating.updateRate(this._opts.rate),this._opts.price&&this._pricing.updateRate(this._opts.price),requestAnimationFrame((function(){e._rating.updateVisu(),e._opts.price&&e._pricing.updateVisu()}))}},{key:"submit",value:function(e){X(ee(s.prototype),"submit",this).call(this,e)&&(this._opts.name=this._name,this._opts.description=this._description,this._opts.types=this.getTypes(),this._opts.modifiers=this.getModifiers(),this._opts.rating=this._rating.currentRate,this._rootElement.querySelector("#nls-".concat(this._opts.type,"-price"))&&(this._opts.price=this._pricing.currentRate),window.Evts.publish("onMarkEdited",this._opts))}}])&&J(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),s}(T);function re(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var ne=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._target=t.target,this._onDropCB=t.onDrop,this._evtIds=[],this._movementCounter=0,this._transparentBorder="",this._buildElements(),this._events()}var t,r;return t=e,(r=[{key:"destroy",value:function(){a.removeAllObjectKeys(this)}},{key:"_buildElements",value:function(){this._transparentBorder="dashed 3px transparent",this._target.style.border=this._transparentBorder}},{key:"_events",value:function(){this._target.addEventListener("dragenter",this._dragEnter.bind(this)),this._target.addEventListener("dragover",this._dragOver.bind(this)),this._target.addEventListener("dragleave",this._dragLeave.bind(this)),this._target.addEventListener("drop",this._drop.bind(this))}},{key:"_dragEnter",value:function(e){this._eventBehavior(e),++this._movementCounter,this._target.style.border="dashed 3px #ffa800"}},{key:"_dragOver",value:function(e){this._eventBehavior(e),e.dataTransfer.dropEffect="copy"}},{key:"_dragLeave",value:function(e){this._eventBehavior(e),--this._movementCounter,0===this._movementCounter&&(this._target.style.border=this._transparentBorder)}},{key:"_drop",value:function(e){this._eventBehavior(e),this._target.style.border=this._transparentBorder,this._onDropCB(e.dataTransfer)}},{key:"_eventBehavior",value:function(e){e.preventDefault(),e.stopPropagation()}},{key:"_isTouchEventInTarget",value:function(e){var t=this._target.getBoundingClientRect(),r=e.pageX>=t.x&&e.pageX<=t.x+t.width,n=e.pageY>=t.y&&e.pageY<=t.y+t.height;return r&&n}}])&&re(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function ie(e){return ie="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ie(e)}function oe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function se(e,t){return se=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},se(e,t)}function ae(e,t){if(t&&("object"===ie(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function ce(e){return ce=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ce(e)}var le=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&se(e,t)}(s,e);var t,r,n,i,o=(n=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ce(n);if(i){var r=ce(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return ae(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=o.call(this,"user"))._opts=e,t._footerCancelButton=null,t._footerSubmitButton=null,t}return t=s,(r=[{key:"_fillAttributes",value:function(){window.BeerCrackerz.nls.userProfileModal(this._rootElement),this._rootElement.querySelector("#user-pp").src=window.BeerCrackerz.user.pp,this._rootElement.querySelector("#user-name").innerHTML=window.BeerCrackerz.user.username,this._rootElement.querySelector("#user-email").innerHTML=window.BeerCrackerz.user.email,new ne({target:this._rootElement.querySelector("#update-pp-wrapper"),onDrop:this.updateProfilePicture.bind(this)}),new ne({target:this._rootElement.querySelector("#drop-user-pp"),onDrop:this.updateProfilePicture.bind(this)}),"true"===a.getPreference("map-high-accuracy")&&(this._rootElement.querySelector("#high-accuracy-toggle").checked=!0),"true"===a.getPreference("dark-theme")&&(this._rootElement.querySelector("#dark-theme-toggle").checked=!0),!0!==window.DEBUG&&"true"!==a.getPreference("app-debug")||(this._rootElement.querySelector("#debug-toggle").checked=!0);for(var e=this._rootElement.querySelector("#lang-select").getElementsByTagName("option"),t=a.getPreference("selected-lang"),r=0;r<e.length;++r)e[r].value===t&&(e[r].selected="selected");this._events()}},{key:"_events",value:function(){this._evtIds.push(window.Evts.addEvent("change",this._rootElement.querySelector("#high-accuracy-toggle"),window.BeerCrackerz.toggleHighAccuracy,window.BeerCrackerz)),this._evtIds.push(window.Evts.addEvent("change",this._rootElement.querySelector("#dark-theme-toggle"),b.toggleDarkTheme,b)),this._evtIds.push(window.Evts.addEvent("change",this._rootElement.querySelector("#debug-toggle"),b.toggleDebug,b)),this._evtIds.push(window.Evts.addEvent("change",this._rootElement.querySelector("#lang-select"),window.BeerCrackerz.updateLang,window.BeerCrackerz)),this._evtIds.push(window.Evts.addEvent("change",this._rootElement.querySelector("#update-pp"),this.updateProfilePicture,this)),this._evtIds.push(window.Evts.addEvent("click",this._rootElement.querySelector("#user-pp"),this.updateProfilePicture,this)),this._evtIds.push(window.Evts.addEvent("click",this._rootElement.querySelector("#logout"),this.logout,this))}},{key:"updateProfilePicture",value:function(e){if("click"===e.type){var t=document.createEvent("MouseEvents");return t.initEvent("click",!0,!1),void document.getElementById("update-pp").dispatchEvent(t)}var r={files:document.getElementById("update-pp").files};if(e.files&&1===e.files.length&&(r={files:e.files}),r.files&&1===r.files.length){if(r.files[0].size>2621440)return document.getElementById("update-pp").value="",document.getElementById("update-pp").classList.add("error"),void(document.getElementById("update-pp-error").innerHTML=window.BeerCrackerz.nls.modal("updatePPSizeError"));if(FileReader){var n=new FileReader;n.onload=function(){var e=new Image;e.src=n.result,e.onload=function(){if(e.width<512||e.height<512)return document.getElementById("update-pp").value="",document.getElementById("update-pp").classList.add("error"),void(document.getElementById("update-pp-error").innerHTML=window.BeerCrackerz.nls.modal("updatePPDimensionError"));window.Evts.publish("updateProfile",{image:e,b64:n.result})}},n.readAsDataURL(r.files[0])}else console.error("Couldnt read file")}}},{key:"logout",value:function(){window.BeerCrackerz.kom.post("api/auth/logout/",null).then((function(){window.location="/welcome"}))}}])&&oe(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),s}(S);function ue(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var de=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._width=t.width,this._height=t.height,this._dom={wrapper:t.wrapper,container:null,resizer:null,tl:null,tr:null,br:null,bl:null,l:null,t:null,r:null,b:null},this._grab={tl:!1,tr:!1,br:!1,bl:!1,l:!1,t:!1,r:!1,b:!1,resizer:!1},this._min={x:0,y:0},this._max={x:500,y:500},this._pointer={x:0,y:0},this.containerRect={},this.resizerRect={},this._buildUI(),this._events()}var t,r;return t=e,(r=[{key:"_buildUI",value:function(){var e=this;this._dom.wrapper.classList.add("image-resizer"),this._dom.container=document.createElement("DIV"),this._dom.resizer=document.createElement("DIV"),this._dom.tl=document.createElement("DIV"),this._dom.tr=document.createElement("DIV"),this._dom.br=document.createElement("DIV"),this._dom.bl=document.createElement("DIV"),this._dom.l=document.createElement("DIV"),this._dom.t=document.createElement("DIV"),this._dom.r=document.createElement("DIV"),this._dom.b=document.createElement("DIV"),this._dom.container.classList.add("container"),this._dom.resizer.classList.add("resizer"),this._dom.tl.classList.add("tl-grab"),this._dom.tl.dataset.loc="tl",this._dom.tr.classList.add("tr-grab"),this._dom.tr.dataset.loc="tr",this._dom.br.classList.add("br-grab"),this._dom.br.dataset.loc="br",this._dom.bl.classList.add("bl-grab"),this._dom.bl.dataset.loc="bl",this._dom.l.classList.add("l-grab"),this._dom.l.dataset.loc="l",this._dom.t.classList.add("t-grab"),this._dom.t.dataset.loc="t",this._dom.r.classList.add("r-grab"),this._dom.r.dataset.loc="r",this._dom.b.classList.add("b-grab"),this._dom.b.dataset.loc="b",this._dom.resizer.dataset.loc="resizer",this._dom.resizer.appendChild(this._dom.tl),this._dom.resizer.appendChild(this._dom.tr),this._dom.resizer.appendChild(this._dom.br),this._dom.resizer.appendChild(this._dom.bl),this._dom.resizer.appendChild(this._dom.l),this._dom.resizer.appendChild(this._dom.t),this._dom.resizer.appendChild(this._dom.r),this._dom.resizer.appendChild(this._dom.b),this._dom.wrapper.appendChild(this._dom.container),this._dom.wrapper.appendChild(this._dom.resizer),requestAnimationFrame((function(){e.containerRect=e._dom.container.getBoundingClientRect(),e._initResizer(),e.resizerRect=e._dom.resizer.getBoundingClientRect()}))}},{key:"_events",value:function(){this._dom.resizer.addEventListener("mousedown",this._mouseDown.bind(this)),document.body.addEventListener("mousemove",this._mouseMove.bind(this)),document.body.addEventListener("mouseup",this._mouseUp.bind(this)),this._dom.resizer.addEventListener("touchstart",this._mouseDown.bind(this)),document.body.addEventListener("touchmove",this._mouseMove.bind(this)),document.body.addEventListener("touchend",this._mouseUp.bind(this))}},{key:"_initResizer",value:function(){if(this._width>this._height){var e=this._dom.resizer.getBoundingClientRect();this._dom.resizer.style.left=(e.width-e.height)/2,this._dom.resizer.style.right=(e.width-e.height)/2}else if(this._width<this._height){var t=this._dom.resizer.getBoundingClientRect();this._dom.resizer.style.top=(t.height-t.width)/2,this._dom.resizer.style.bottom=(t.height-t.width)/2}}},{key:"_mouseDown",value:function(e){-1!==Object.keys(this._grab).indexOf(e.target.dataset.loc)&&(this._grab[e.target.dataset.loc]=!0,this.containerRect=this._dom.container.getBoundingClientRect(),this.resizerRect=this._dom.resizer.getBoundingClientRect(),this._pointer.x=e.pageX-this.containerRect.x,this._pointer.y=e.pageY-this.containerRect.y,e.touches&&e.touches.length&&(this._pointer.x=e.touches[0].clientX-this.containerRect.x,this._pointer.y=e.touches[0].clientY-this.containerRect.y))}},{key:"_mouseMove",value:function(e){if(this._isGrabbed()){e.touches&&e.touches.length&&(e.pageX=e.touches[0].clientX,e.pageY=e.touches[0].clientY);var t=e.pageX-this.containerRect.x,r=e.pageY-this.containerRect.y;t<0&&(t=0),t>this.containerRect.width&&(t=this.containerRect.width),r<0&&(r=0),r>this.containerRect.height&&(r=this.containerRect.height);var n=this.resizerRect.x-this.containerRect.x,i=this.resizerRect.y-this.containerRect.y,o=this.resizerRect.x+this.resizerRect.width-this.containerRect.x,s=this.resizerRect.y+this.resizerRect.height-this.containerRect.y,a=this.containerRect.width-512*this.containerRect.width/this._width,c=this.containerRect.height-512*this.containerRect.height/this._height;if(this._grab.tl){if(i+(t-n)<0){var l=this._dom.resizer.style.top.slice(0,-2);return this._dom.resizer.style.top=0,void(this._dom.resizer.style.left=this._dom.resizer.style.left.slice(0,-2)-l)}if(i+(t-n)>c)return;this._dom.resizer.style.left=n+(t-n),this._dom.resizer.style.top=i+(t-n)}else if(this._grab.tr){if(i+(o-t)<0){var u=this._dom.resizer.style.top.slice(0,-2);return this._dom.resizer.style.top=0,void(this._dom.resizer.style.right=this._dom.resizer.style.right.slice(0,-2)-u)}if(i+(o-t)>c)return;this._dom.resizer.style.right=this.containerRect.width-o+o-t,this._dom.resizer.style.top=i+(o-t)}else if(this._grab.br){if(this.containerRect.height-s+o-t<0){var d=this._dom.resizer.style.bottom.slice(0,-2);return this._dom.resizer.style.bottom=0,void(this._dom.resizer.style.right=this._dom.resizer.style.right.slice(0,-2)-d)}if(this.containerRect.height-s+o-t>c)return;this._dom.resizer.style.right=this.containerRect.width-o+o-t,this._dom.resizer.style.bottom=this.containerRect.height-s+o-t}else if(this._grab.bl){if(this.containerRect.height-s+(t-n)<0){var h=this._dom.resizer.style.bottom.slice(0,-2);return this._dom.resizer.style.bottom=0,void(this._dom.resizer.style.left=this._dom.resizer.style.left.slice(0,-2)-h)}if(this.containerRect.height-s+(t-n)>c)return;this._dom.resizer.style.left=n+(t-n),this._dom.resizer.style.bottom=this.containerRect.height-s+(t-n)}else if(this._grab.l){if(i+(t-n)/2<0){var p=this._dom.resizer.style.top.slice(0,-2);return this._dom.resizer.style.top=0,this._dom.resizer.style.left=this._dom.resizer.style.left.slice(0,-2)-p,void(this._dom.resizer.style.bottom=this._dom.resizer.style.bottom.slice(0,-2)-p)}if(this.containerRect.height-s+(t-n)/2<0){var f=this._dom.resizer.style.bottom.slice(0,-2);return this._dom.resizer.style.bottom=0,this._dom.resizer.style.top=this._dom.resizer.style.top.slice(0,-2)-f/2,void(this._dom.resizer.style.left=this._dom.resizer.style.left.slice(0,-2)-f/2)}if(n+(t-n)>a)return;this._dom.resizer.style.left=n+(t-n),this._dom.resizer.style.bottom=this.containerRect.height-s+(t-n)/2,this._dom.resizer.style.top=i+(t-n)/2}else if(this._grab.t){if(n+(r-i)/2<0){var m=this._dom.resizer.style.left.slice(0,-2);return this._dom.resizer.style.left=0,this._dom.resizer.style.right=this._dom.resizer.style.right.slice(0,-2)-m/2,void(this._dom.resizer.style.top=this._dom.resizer.style.top.slice(0,-2)-m/2)}if(this.containerRect.width-o+(r-i)/2<0){var y=this._dom.resizer.style.right.slice(0,-2);return this._dom.resizer.style.right=0,this._dom.resizer.style.top=this._dom.resizer.style.top.slice(0,-2)-y/2,void(this._dom.resizer.style.left=this._dom.resizer.style.left.slice(0,-2)-y/2)}if(i+(r-i)>c)return;this._dom.resizer.style.top=i+(r-i),this._dom.resizer.style.left=n+(r-i)/2,this._dom.resizer.style.right=this.containerRect.width-o+(r-i)/2}else if(this._grab.r){if(i+(o-t)/2<0){var _=this._dom.resizer.style.top.slice(0,-2);return this._dom.resizer.style.top=0,this._dom.resizer.style.right=this._dom.resizer.style.right.slice(0,-2)-_/2,void(this._dom.resizer.style.bottom=this._dom.resizer.style.bottom.slice(0,-2)-_/2)}if(this.containerRect.height-s+(o-t)/2<0){var g=this._dom.resizer.style.bottom.slice(0,-2);return this._dom.resizer.style.bottom=0,this._dom.resizer.style.top=this._dom.resizer.style.top.slice(0,-2)-g/2,void(this._dom.resizer.style.right=this._dom.resizer.style.right.slice(0,-2)-g/2)}if(this.containerRect.width-o+o-t>a)return;this._dom.resizer.style.right=this.containerRect.width-o+o-t,this._dom.resizer.style.bottom=this.containerRect.height-s+(o-t)/2,this._dom.resizer.style.top=i+(o-t)/2}else if(this._grab.b){if(n+(s-r)/2<0){var v=this._dom.resizer.style.left.slice(0,-2);return this._dom.resizer.style.left=0,this._dom.resizer.style.right=this._dom.resizer.style.right.slice(0,-2)-v/2,void(this._dom.resizer.style.bottom=this._dom.resizer.style.bottom.slice(0,-2)-v/2)}if(this.containerRect.width-o+(s-r)/2<0){var b=this._dom.resizer.style.right.slice(0,-2);return this._dom.resizer.style.right=0,this._dom.resizer.style.bottom=this._dom.resizer.style.bottom.slice(0,-2)-b/2,void(this._dom.resizer.style.left=this._dom.resizer.style.left.slice(0,-2)-b/2)}if(this.containerRect.height-s+s-r>c)return;this._dom.resizer.style.bottom=this.containerRect.height-s+s-r,this._dom.resizer.style.left=n+(s-r)/2,this._dom.resizer.style.right=this.containerRect.width-o+(s-r)/2}else if(this._grab.resizer){if(this._pointer.x-t>0)if(n-(this._pointer.x-t)<0){var w=this._dom.resizer.style.left.slice(0,-2);this._dom.resizer.style.left=0,this._dom.resizer.style.right=this._dom.resizer.style.right.slice(0,-2)-w}else this._dom.resizer.style.left=n-(this._pointer.x-t),this._dom.resizer.style.right=this.containerRect.width-o+(this._pointer.x-t);else if(this.containerRect.width-o+(this._pointer.x-t)<0){var k=this._dom.resizer.style.right.slice(0,-2);this._dom.resizer.style.right=0,this._dom.resizer.style.left=this._dom.resizer.style.left.slice(0,-2)-k}else this._dom.resizer.style.left=n-(this._pointer.x-t),this._dom.resizer.style.right=this.containerRect.width-o+(this._pointer.x-t);if(this._pointer.y-r>0)if(i-(this._pointer.y-r)<0){var E=this._dom.resizer.style.top.slice(0,-2);this._dom.resizer.style.top=0,this._dom.resizer.style.bottom=this._dom.resizer.style.bottom.slice(0,-2)-E}else this._dom.resizer.style.top=i-(this._pointer.y-r),this._dom.resizer.style.bottom=this.containerRect.height-s+(this._pointer.y-r);else if(this.containerRect.height-s+(this._pointer.y-r)<0){var S=this._dom.resizer.style.bottom.slice(0,-2);this._dom.resizer.style.bottom=0,this._dom.resizer.style.top=this._dom.resizer.style.top.slice(0,-2)-S}else this._dom.resizer.style.top=i-(this._pointer.y-r),this._dom.resizer.style.bottom=this.containerRect.height-s+(this._pointer.y-r)}}}},{key:"_mouseUp",value:function(e){e.preventDefault(),this._grab.tl=!1,this._grab.tr=!1,this._grab.br=!1,this._grab.bl=!1,this._grab.l=!1,this._grab.t=!1,this._grab.r=!1,this._grab.b=!1,this._grab.resizer=!1,this._computMinMax()}},{key:"_computMinMax",value:function(){this.containerRect=this._dom.container.getBoundingClientRect(),this.resizerRect=this._dom.resizer.getBoundingClientRect(),this._min={x:this.resizerRect.x-this.containerRect.x||0,y:this.resizerRect.y-this.containerRect.y||0},this._max={x:this.resizerRect.x+this.resizerRect.width-this.containerRect.x||this.containerRect.x,y:this.resizerRect.y+this.resizerRect.height-this.containerRect.y||this.containerRect.y}}},{key:"_isGrabbed",value:function(){return!!(this._grab.tl||this._grab.tr||this._grab.bl||this._grab.br)||!!(this._grab.l||this._grab.t||this._grab.r||this._grab.b)||!!this._grab.resizer}},{key:"getMinPoint",value:function(){return this._computMinMax(),{x:this._min.x/this.containerRect.width*this._width,y:this._min.y/this.containerRect.height*this._height}}},{key:"getMaxPoint",value:function(){return this._computMinMax(),{x:this._max.x/this.containerRect.width*this._width,y:this._max.y/this.containerRect.height*this._height}}}])&&ue(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function he(e){return he="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},he(e)}function pe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function fe(e,t){return fe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},fe(e,t)}function me(e,t){if(t&&("object"===he(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function ye(e){return ye=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ye(e)}function _e(e){return _e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_e(e)}function ge(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ve(e,t){return ve=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ve(e,t)}function be(e,t){if(t&&("object"===_e(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function we(e){return we=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},we(e)}function ke(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ee={AddMarkModal:H,DeleteMarkModal:V,EditMarkModal:te,UserModal:le,UpdateProfilePictureModal:function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&fe(e,t)}(s,e);var t,r,n,i,o=(n=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ye(n);if(i){var r=ye(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return me(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=o.call(this,"updatepp"))._opts=e,t._footerCancelButton=null,t._footerSubmitButton=null,t}return t=s,(r=[{key:"_fillAttributes",value:function(){window.BeerCrackerz.nls.updateProfilePictureModal(this._rootElement),this._rootElement.querySelector("#wip-pp").src=this._opts.b64,this._imageResizer=new de({wrapper:this._rootElement.querySelector("#wip-pp-wrapper"),width:this._opts.image.width,height:this._opts.image.height}),this._footerCancelButton=this._rootElement.querySelector("#update-pp-close"),this._footerSubmitButton=this._rootElement.querySelector("#update-pp-submit"),this._events()}},{key:"_events",value:function(){this._evtIds.push(window.Evts.addEvent("click",this._footerCancelButton,this.close,this)),this._evtIds.push(window.Evts.addEvent("click",this._footerSubmitButton,this.submit,this))}},{key:"submit",value:function(e){e.preventDefault(),this._opts.imageResizer=this._imageResizer,window.Evts.publish("onProfilePictureUpdated",this._opts)}}])&&pe(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),s}(S),HideShowModal:function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ve(e,t)}(s,e);var t,r,n,i,o=(n=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=we(n);if(i){var r=we(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return be(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=o.call(this,"hideshow"))._opts=e,t._footerCancelButton=null,t._footerSubmitButton=null,t}return t=s,(r=[{key:"_fillAttributes",value:function(){window.BeerCrackerz.nls.hideShowModal(this._rootElement),"true"===a.getPreference("poi-show-label")&&(this._rootElement.querySelector("#label-toggle").checked=!0),"true"===a.getPreference("poi-show-circle")&&(this._rootElement.querySelector("#circle-toggle").checked=!0),"true"===a.getPreference("poi-show-spot")&&(this._rootElement.querySelector("#show-spots").checked=!0),"true"===a.getPreference("poi-show-shop")&&(this._rootElement.querySelector("#show-shops").checked=!0),"true"===a.getPreference("poi-show-bar")&&(this._rootElement.querySelector("#show-bars").checked=!0),this._footerCancelButton=this._rootElement.querySelector("#cancel-close"),this._events()}},{key:"_events",value:function(){this._evtIds.push(window.Evts.addEvent("change",this._rootElement.querySelector("#label-toggle"),b.toggleLabel,b)),this._evtIds.push(window.Evts.addEvent("change",this._rootElement.querySelector("#circle-toggle"),b.toggleCircle,b)),this._evtIds.push(window.Evts.addEvent("change",this._rootElement.querySelector("#show-spots"),b.toggleMarkers,b)),this._evtIds.push(window.Evts.addEvent("change",this._rootElement.querySelector("#show-shops"),b.toggleMarkers,b)),this._evtIds.push(window.Evts.addEvent("change",this._rootElement.querySelector("#show-bars"),b.toggleMarkers,b)),this._evtIds.push(window.Evts.addEvent("mouseover",this._rootElement.querySelector("#labels-toggle"),this._updateHelper,this)),this._evtIds.push(window.Evts.addEvent("mouseover",this._rootElement.querySelector("#circles-toggle"),this._updateHelper,this)),this._evtIds.push(window.Evts.addEvent("mouseover",this._rootElement.querySelector("#spots-toggle"),this._updateHelper,this)),this._evtIds.push(window.Evts.addEvent("mouseover",this._rootElement.querySelector("#shops-toggle"),this._updateHelper,this)),this._evtIds.push(window.Evts.addEvent("mouseover",this._rootElement.querySelector("#bars-toggle"),this._updateHelper,this)),this._evtIds.push(window.Evts.addEvent("click",this._footerCancelButton,this.close,this))}},{key:"_updateHelper",value:function(e){var t=e.target.dataset.type;document.getElementById("nls-viewer-helper").innerHTML=window.BeerCrackerz.nls.modal("".concat(t,"HelperHideShow"))||""}}])&&ge(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),s}(S)},Se=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,r=[{key:"build",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Ee["".concat(e,"Modal")]?new(Ee["".concat(e,"Modal")])(t):null}}],null&&ke(t.prototype,null),r&&ke(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),Pe=Se;function ze(e){return ze="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ze(e)}function Ce(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Oe(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Re=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Ce(this,e),"boolean"!=typeof t&&(t=!1),this._debug=t,this._idIncrementor=5678*Math.floor(Math.random()*Math.floor(256)),this._regularEvents=[],this._customEvents={},this.version="1.2.1"}var t,r;return t=e,r=[{key:"destroy",value:function(){this._raise("log","CustomEvents.destroy"),this.removeAllEvents(),a.removeAllObjectKeys(this)}},{key:"addEvent",value:function(e,t,r){var n=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t,o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(this._raise("log","CustomEvents.addEvent: ".concat(e," ").concat(t," ").concat(r," ").concat(i," ").concat(o)),null==e||null==t||null==r)return this._raise("error","CustomEvents.addEvent: Missing mandatory arguments"),!1;var s=function(){n._raise("error","CustomEvents.addEvent: Wrong type for argument")};return"string"!=typeof e||"object"!==ze(t)||"function"!=typeof r||null!=i&&"object"!==ze(i)&&"function"!=typeof i||null!=o&&"object"!==ze(o)&&"boolean"!=typeof o&&"string"!=typeof o&&"number"!=typeof o?(s(),!1):(r=r.bind(i),this._regularEvents.push({id:this._idIncrementor,element:t,eventName:e,scope:i,callback:r,options:o}),t.addEventListener(e,r,o),this._idIncrementor++)}},{key:"removeEvent",value:function(e){if(this._raise("log","Events.removeEvent: ".concat(e)),null==e)return this._raise("error","CustomEvents.removeEvent: Missing mandatory arguments"),!1;if("number"!=typeof e)return this._raise("error","CustomEvents.removeEvent: Wrong type for argument"),!1;for(var t=!1,r=this._regularEvents.length-1;r>=0;--r)this._regularEvents[r].id===e&&(t=!0,this._clearRegularEvent(r));return t}},{key:"removeAllEvents",value:function(){this._raise("log","CustomEvents.removeAllEvents");for(var e=!1,t=this._regularEvents.length>0,r=this._regularEvents.length-1;r>=0;--r)this._clearRegularEvent(r);return 0===this._regularEvents.length&&t&&(e=!0),e}},{key:"_clearRegularEvent",value:function(e){if(this._raise("log","CustomEvents._clearRegularEvent: ".concat(e)),null==e)return this._raise("error","CustomEvents._clearRegularEvent: Missing mandatory argument"),!1;if("number"!=typeof e)return this._raise("error","CustomEvents._clearRegularEvent: Wrong type for argument"),!1;if(this._regularEvents[e]){var t=this._regularEvents[e];return t.element.removeEventListener(t.eventName,t.callback,t.options),this._regularEvents.splice(e,1),!0}return!1}},{key:"subscribe",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this._raise("log","CustomEvents.subscribe: ".concat(e," ").concat(t," ").concat(n)),null==e||null==t)return this._raise("error","CustomEvents.subscribe","Missing mandatory arguments"),!1;var i=function(){r._raise("error","CustomEvents.subscribe: Wrong type for argument")};return"string"!=typeof e||"function"!=typeof t||null!=n&&"boolean"!=typeof n?(i(),!1):(this._customEvents[e]||(this._customEvents[e]=[]),this._customEvents[e].push({id:this._idIncrementor,name:e,os:n,callback:t}),this._idIncrementor++)}},{key:"unsubscribe",value:function(e){if(this._raise("log","CustomEvents.unsubscribe: ".concat(e)),null==e)return this._raise("error","CustomEvents.unsubscribe: Missing mandatory arguments"),!1;if("number"!=typeof e)return this._raise("error","CustomEvents.unsubscribe: Wrong type for argument"),!1;for(var t=!1,r=Object.keys(this._customEvents),n=r.length-1;n>=0;--n)for(var i=this._customEvents[r[n]],o=0;o<i.length;++o)if(i[o].id===e){this._raise("log","CustomEvents.unsubscribe: subscription found\n",i[o],"\nSubscription n".concat(e," for ").concat(i.name," has been removed")),t=!0,i.splice(o,1),0===i.length&&delete this._customEvents[r[n]];break}return t}},{key:"unsubscribeAllFor",value:function(e){if(this._raise("log","CustomEvents.unsubscribeAllFor: ".concat(e)),null==e)return this._raise("error","CustomEvents.unsubscribeAllFor: Missing mandatory arguments"),!1;if("string"!=typeof e)return this._raise("error","CustomEvents.unsubscribeAllFor: Wrong type for argument"),!1;for(var t=!1,r=Object.keys(this._customEvents),n=0;n<r.length;++n)if(r[n]===e)for(var i=this._customEvents[r[n]],o=i.length-1;o>=0;--o)t=!0,i.splice(o,1),0===i.length&&delete this._customEvents[r[n]];return t}},{key:"publish",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._raise("log","CustomEvents.publish: ".concat(e," ").concat(t)),null==e)return this._raise("error","CustomEvents.publish: Missing mandatory arguments"),!1;if("string"!=typeof e||void 0!==t&&"object"!==ze(t))return this._raise("error","CustomEvents.publish: Wrong type for argument"),!1;for(var r=!1,n=Object.keys(this._customEvents),i=0;i<n.length;++i)if(n[i]===e){r=!0;for(var o=this._customEvents[n[i]],s=o.length-1;s>=0;--s)this._raise("log","CustomEvents.publish: fire callback for ".concat(e,", subscription n").concat(o[s].id),o[s]),o[s].callback(t),o[s].os&&(this._raise("log","CustomEvents.publish: remove subscription because one shot usage is done"),o.splice(s,1),0===o.length&&delete this._customEvents[n[i]])}return r}},{key:"_raise",value:function(e,t){this._debug&&console[e](t)}}],r&&Oe(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),Le=Re,Me=Object.freeze({spot:new window.L.MarkerClusterGroup({animateAddingMarkers:!0,disableClusteringAtZoom:18,spiderfyOnMaxZoom:!1,maxClusterRadius:360,iconCreateFunction:function(e){return window.L.divIcon({className:"cluster-icon-wrapper",html:'\n          <img src="/static/img/marker/marker-icon-green.png" class="cluster-icon">\n          <span class="cluster-label">'.concat(e.getChildCount(),"</span>\n        ")})}}),shop:new window.L.MarkerClusterGroup({animateAddingMarkers:!0,disableClusteringAtZoom:18,spiderfyOnMaxZoom:!1,maxClusterRadius:360,iconCreateFunction:function(e){return window.L.divIcon({className:"cluster-icon-wrapper",html:'\n          <img src="/static/img/marker/marker-icon-blue.png" class="cluster-icon">\n          <span class="cluster-label">'.concat(e.getChildCount(),"</span>\n        ")})}}),bar:new window.L.MarkerClusterGroup({animateAddingMarkers:!0,disableClusteringAtZoom:18,spiderfyOnMaxZoom:!1,maxClusterRadius:360,iconCreateFunction:function(e){return window.L.divIcon({className:"cluster-icon-wrapper",html:'\n          <img src="/static/img/marker/marker-icon-red.png" class="cluster-icon">\n          <span class="cluster-label">'.concat(e.getChildCount(),"</span>\n        ")})}})}),Be=Object.freeze({planOsm:window.L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',minZoom:5,maxNativeZoom:19,maxZoom:21}),satEsri:window.L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:'&copy; <a href="https://www.arcgis.com/home/item.html?id=10df2279f9684e4a9f6a7f08febac2a9">Esri Imagery</a>',minZoom:5,maxNativeZoom:19,maxZoom:21})});function Te(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}window.VERSION="0.0.2",window.Evts=new Le;var Ie=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._map=null,this._zoomSlider=null,this._notification=null,this._user={lat:48.853121540141096,lng:2.3498955769881156,accuracy:0,marker:null,circle:null,range:null,color:y.user,id:-1,username:""},this._marks={spot:[],shop:[],bar:[]},this._clusters={spot:{},shop:{},bar:{}},this._newMarker=null,this.debugElement=null,this._watchId=null,this._isZooming=!1,this._kom=new i,this._lang=new u,this._init()}var t,r;return t=e,(r=[{key:"_init",value:function(){this._notification=new f,this._initUser().then(this._initPreferences.bind(this)).then(this._initGeolocation.bind(this)).then(this._initMap.bind(this)).then(this._initMarkers.bind(this)).then(this._initEvents.bind(this))}},{key:"_initUser",value:function(){var e=this;return new Promise((function(t,r){e._kom.get("/api/user/me/").then((function(r){e._user.id=r.id,e._user.username=r.username,e._user.email=r.email,e._user.pp=r.profilePicture,e._user.isActive=r.isActive,t()})).catch(r)}))}},{key:"_initPreferences",value:function(){var e=this;return new Promise((function(t,r){a.setDefaultPreferences(),"true"===a.getPreference("map-center-on-user")&&document.getElementById("center-on").classList.add("lock-center-on"),"false"===a.getPreference("dark-theme")&&(document.body.classList.remove("dark-theme"),document.body.classList.add("light-theme")),e.nls.updateLang(a.getPreference("selected-lang")).then((function(){e.debugElement=b.initDebugUI(),!0!==window.DEBUG&&"true"!==a.getPreference("app-debug")||(window.DEBUG=!0,a.setPreference("app-debug",!0),b.addDebugUI()),t()})).catch(r)}))}},{key:"_initGeolocation",value:function(){var e=this;return new Promise((function(t){if("geolocation"in navigator){var r="true"===a.getPreference("map-high-accuracy")?m.high:m.optimized;e._watchId=navigator.geolocation.watchPosition((function(r){e._user.lat=r.coords.latitude,e._user.lng=r.coords.longitude,e._user.accuracy=r.coords.accuracy,e._map&&(b.drawUserMarker(),b.updateMarkerCirclesVisibility(),"true"!==a.getPreference("map-center-on-user")||e._isZooming||e._map.setView(e._user),b.updateDebugUI()),t()}),t,r)}else e.notification.raise(e.nls.notif("geolocationError")),t()}))}},{key:"_initMap",value:function(){var e=this;return new Promise((function(t){e._map=window.L.map("beer-crakerz-map",{zoomControl:!1}).setView([e._user.lat,e._user.lng],18),window.L.control.scale().addTo(e._map),b.drawUserMarker();var r=Be.planOsm,n=Be.satEsri;e._map.setMaxBounds(_.mapBounds);var i={};if(i["<p>".concat(e.nls.map("planLayerOSM"),"</p>")]=r,i["<p>".concat(e.nls.map("satLayerEsri"),"</p>")]=n,a.getPreference("map-plan-layer"))switch(a.getPreference("map-plan-layer")){case e.nls.map("planLayerOSM"):r.addTo(e._map);break;case e.nls.map("satLayerEsri"):n.addTo(e._map);break;default:r.addTo(e._map)}else r.addTo(e._map);window.L.control.layers(i,{},{position:"bottomright"}).addTo(e._map),e._zoomSlider=new h(e._map),t()}))}},{key:"_initMarkers",value:function(){var e=this;return new Promise((function(t){e._clusters.spot=Me.spot,e._clusters.shop=Me.shop,e._clusters.bar=Me.bar,"true"===a.getPreference("poi-show-spot")&&e._map.addLayer(e._clusters.spot),"true"===a.getPreference("poi-show-shop")&&e._map.addLayer(e._clusters.shop),"true"===a.getPreference("poi-show-bar")&&e._map.addLayer(e._clusters.bar);var r=function(t){var r=new k(t,(function(n){t.dom=n,t.marker=b.addMark(t),t.popup=r,e._marks[t.type].push(t),e._clusters[t.type].addLayer(t.marker)}))};e._kom.getSpots().then((function(e){for(var t=0;t<e.length;++t)r(e[t])})),e._kom.getShops().then((function(e){for(var t=0;t<e.length;++t)r(e[t])})),e._kom.getBars().then((function(e){for(var t=0;t<e.length;++t)r(e[t])})),b.updateMarkerCirclesVisibility(),t()}))}},{key:"_initEvents",value:function(){var e=this;return new Promise((function(t){e._map.on("click",e.mapClicked.bind(e)),e._map.on("drag",(function(){e._map.panInsideBounds(_.mapBounds,{animate:!0}),"true"===a.getPreference("map-center-on-user")&&b.toggleFocusLock()})),e._map.on("zoomstart",(function(){e._isZooming=!0,"true"===a.getPreference("poi-show-circle")&&b.setMarkerCircles(!1)})),e._map.on("zoomend",(function(){e._isZooming=!1,"true"===a.getPreference("poi-show-circle")&&e._map.getZoom()>=10&&b.setMarkerCircles(!0),"true"===a.getPreference("poi-show-label")&&(e._map.getZoom()<16?b.setMarkerLabels(!1):b.setMarkerLabels(!0)),b.updateDebugUI()})),e._map.on("baselayerchange",(function(e){a.setPreference("map-plan-layer",a.stripDom(e.name))})),e._clusters.spot.on("animationend",b.checkClusteredMark.bind(e,"spot")),e._clusters.shop.on("animationend",b.checkClusteredMark.bind(e,"shop")),e._clusters.bar.on("animationend",b.checkClusteredMark.bind(e,"bar")),window.Evts.addEvent("click",document.getElementById("user-profile"),e.userProfile,e),window.Evts.addEvent("click",document.getElementById("hide-show"),e.hidShowMenu,e),window.Evts.addEvent("click",document.getElementById("center-on"),b.toggleFocusLock,e),window.Evts.subscribe("addMark",e.addMark.bind(e)),window.Evts.subscribe("onMarkAdded",e._onMarkAdded.bind(e)),window.Evts.subscribe("deleteMark",e.deleteMark.bind(e)),window.Evts.subscribe("onMarkDeleted",e._onMarkDeleted.bind(e)),window.Evts.subscribe("editMark",e.editMark.bind(e)),window.Evts.subscribe("onMarkEdited",e._onMarkEdited.bind(e)),window.Evts.subscribe("updateProfile",e.updateProfilePicture.bind(e)),window.Evts.subscribe("onProfilePictureUpdated",e._onProfilePictureUpdated.bind(e)),window.Evts.subscribe("centerOn",b.centerOn.bind(b)),t()}))}},{key:"toggleHighAccuracy",value:function(){var e=!("true"===a.getPreference("map-high-accuracy"));a.setPreference("map-high-accuracy",e),navigator.geolocation.clearWatch(this._watchId),this._initGeolocation().then(b.updateDebugUI.bind(b))}},{key:"updateLang",value:function(e){var t=this;a.setPreference("selected-lang",e.target.value),this.nls.updateLang(a.getPreference("selected-lang")).then((function(){t._modal?(t._modal.close(null,!0),b.updateDebugUI(),setTimeout(t.userProfile.bind(t),200)):window.location.reload()}))}},{key:"mapClicked",value:function(e){this._newMarker&&this._newMarker.popupClosed?this._newMarker=null:null!==this._newMarker&&this._newMarker.isBeingDefined||(a.getDistanceBetweenCoords([this._user.lat,this._user.lng],[e.latlng.lat,e.latlng.lng])<_.newMarkRange?this.addMarkPopup(e.latlng):this.notification.raise(this.nls.notif("newMarkerOutside")))}},{key:"addMarkPopup",value:function(e){var t=this,r={wrapper:document.createElement("DIV"),title:document.createElement("P"),spot:document.createElement("BUTTON"),shop:document.createElement("BUTTON"),bar:document.createElement("BUTTON")};r.wrapper.className="new-poi",r.title.innerHTML=this.nls.map("newTitle"),r.spot.innerHTML=this.nls.map("newSpot"),r.shop.innerHTML=this.nls.map("newShop"),r.bar.innerHTML=this.nls.map("newBar"),r.spot.dataset.type="spot",r.shop.dataset.type="shop",r.bar.dataset.type="bar",r.wrapper.appendChild(r.title),r.wrapper.appendChild(r.spot),r.wrapper.appendChild(r.shop),r.wrapper.appendChild(r.bar),e.dom=r.wrapper,this._newMarker=b.addMark(e).openPopup(),e.marker=this._newMarker;var n=function(r){t._newMarker.isBeingDefined=!0,t._newMarker.closePopup(),e.type=r.target.dataset.type,window.Evts.publish("addMark",e)};r.spot.addEventListener("click",n),r.shop.addEventListener("click",n),r.bar.addEventListener("click",n),this._newMarker.on("popupclose",(function(){t._newMarker.isBeingDefined||(t._newMarker.popupClosed=!0,t._newMarker.removeFrom(t.map))}))}},{key:"addMark",value:function(e){this._modal=Pe.build("AddMark",e)}},{key:"_onMarkAdded",value:function(e){var t=this,r=new k(e,(function(n){e.dom=n,e.marker=b.addMark(e),e.popup=r,t._kom["".concat(e.type,"Created")](a.formatMarker(e)).then((function(r){e.id=r.id,e.name=r.name,e.description=r.description,e.lat=r.lat,e.lng=r.lng,t._marks[e.type].push(e),t._clusters[e.type].addLayer(e.marker),t.notification.raise(t.nls.notif("".concat(e.type,"Added"))),b.updateMarkerCirclesVisibility(),t._newMarker=null})).catch((function(){t.notification.raise(t.nls.notif("".concat(e.type,"NotAdded")))}))}))}},{key:"deleteMark",value:function(e){this._map.closePopup(),this._modal=Pe.build("DeleteMark",e)}},{key:"_onMarkDeleted",value:function(e){for(var t=this,r=this._marks[e.type],n=function(n){if(e.lat===r[n].lat&&e.lng===r[n].lng)return t._kom["".concat(e.type,"Deleted")](r[n].id,a.formatMarker(r[n])).then((function(){b.removeMarkDecoration(r[n]),t._clusters[e.type].removeLayer(r[n].marker),r.splice(n,1),t._marks[e.type]=r,t.notification.raise(t.nls.notif("".concat(e.type,"Deleted")))})).catch((function(){t.notification.raise(t.nls.notif("".concat(e.type,"NotDeleted")))})),"break"},i=0;i<r.length&&"break"!==n(i);++i);}},{key:"editMark",value:function(e){this._map.closePopup(),this._modal=Pe.build("EditMark",e)}},{key:"_onMarkEdited",value:function(e){for(var t=this,r=0;r<this._marks[e.type].length&&(e.lat!==this._marks[e.type][r].lat||e.lng!==this._marks[e.type][r].lng||"break"!==function(){t._marks[e.type][r].name=e.name.value,t._marks[e.type][r].description=e.description.value,t._marks[e.type][r].rate=e.rating.currentRate,e.tooltip.removeFrom(t.map);var n=new k(e,(function(r){e.dom=r,e.marker.setPopupContent(e.dom),e.popup=n,t._kom["".concat(e.type,"Edited")](e.id,a.formatMarker(e)).then((function(r){e.id=r.id,e.name=r.name,e.description=r.description,e.lat=r.lat,e.lng=r.lng,t.notification.raise(t.nls.notif("".concat(e.type,"Edited")))})).catch((function(){t.notification.raise(t.nls.notif("".concat(e.type,"NotEdited")))})).finally((function(){t._modal.close(null,!0)}))}));return"break"}());++r);}},{key:"userProfile",value:function(){this._modal=Pe.build("User")}},{key:"updateProfilePicture",value:function(e){this._modal=Pe.build("UpdateProfilePicture",e)}},{key:"_onProfilePictureUpdated",value:function(e){var t=this;this._kom.patchImage("api/user/".concat(this._user.id,"/profile-picture/"),{profile_picture:document.getElementById("wip-pp").src,minX:Math.round(e.imageResizer.getMinPoint().x),minY:Math.round(e.imageResizer.getMinPoint().y),maxX:Math.round(e.imageResizer.getMaxPoint().x),maxY:Math.round(e.imageResizer.getMaxPoint().y)}).then((function(){t.notification.raise(t.nls.notif("uploadPPSuccess"))})).catch((function(e){t.notification.raise(t.nls.notif("uploadPPFailed")),console.error(e)})).finally((function(){t._initUser().then((function(){t._modal.close(null,!0)}))}))}},{key:"hidShowMenu",value:function(){this._modal=Pe.build("HideShow")}},{key:"map",get:function(){return this._map}},{key:"marks",get:function(){return this._marks}},{key:"clusters",get:function(){return this._clusters}},{key:"user",get:function(){return this._user}},{key:"kom",get:function(){return this._kom}},{key:"notification",get:function(){return this._notification}},{key:"nls",get:function(){return this._lang}}])&&Te(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();window.BeerCrackerz=t.default}();