!function(){"use strict";var e={d:function(t,r){for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}},t={};function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function n(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(void 0,i=function(e,t){if("object"!==r(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t);if("object"!==r(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(o.key,"string"),"symbol"===r(i)?i:String(i)),o)}var i}e.d(t,{default:function(){return A}});var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._csrfToken=this._getCsrfCookie(),this._headers=this._createRequestHeaders(),this.isValid=this._checkValidity()}var t,r;return t=e,r=[{key:"_getCsrfCookie",value:function(){if(document.cookie&&""!==document.cookie)for(var e=document.cookie.split(";"),t=0;t<e.length;++t){var r=e[t].split("=");if(void 0!==r&&r[0].toLowerCase().includes("srf"))return decodeURIComponent(r[1])}return null}},{key:"_createRequestHeaders",value:function(){return[["Content-Type","application/json; charset=UTF-8"],["Accept","application/json"],["X-CSRFToken",this._csrfToken]]}},{key:"_checkValidity",value:function(){return null!==this._csrfToken&&3===this._headers.length}},{key:"_resolveAs",value:function(e,t){return new Promise((function(r,n){t?"raw"===e?200===t.status?r(t.responseText):n(t.status):"json"===e||"text"===e?t[e]?r(t[e]()):n(t.status):"dom"===e?t.text().then((function(e){r(document.createRange().createContextualFragment(e))})).catch(n):r():n("F_KOM_MISSING_ARGUMENT")}))}},{key:"_resolveAsJSON",value:function(e){return this._resolveAs("json",e)}},{key:"_resolveAsText",value:function(e){return this._resolveAs("text",e)}},{key:"_resolveAsDom",value:function(e){return this._resolveAs("dom",e)}},{key:"get",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._resolveAsJSON.bind(this);return new Promise((function(n,o){var i={method:"GET",headers:new Headers([t._headers[0]])};fetch(e,i).then((function(e){return 200!==e.status&&o(e),r(e)})).then(n).catch(o)}))}},{key:"getText",value:function(e){return this.get(e,this._resolveAsText.bind(this))}},{key:"getTemplate",value:function(e){return this.get(e,this._resolveAsDom.bind(this))}},{key:"post",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._resolveAsJSON.bind(this);return new Promise((function(o,i){var a={method:"POST",headers:new Headers(r._headers),body:JSON.stringify(t)};fetch(e,a).then((function(e){return e.status>=400&&i(e),null!=n?n(e):e})).then(o).catch(i)}))}},{key:"postText",value:function(e,t){return this.post(e,t,this._resolveAsText.bind(this))}},{key:"postImage",value:function(e,t){return this.post(e,t,null)}},{key:"patch",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._resolveAsJSON.bind(this);return new Promise((function(o,i){var a={method:"PATCH",headers:new Headers(r._headers),body:JSON.stringify(t)};fetch(e,a).then((function(e){return e.status>=400&&i(e),null!=n?n(e):e})).then(o).catch(i)}))}},{key:"patchImage",value:function(e,t){return this.patch(e,t,null)}},{key:"delete",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._resolveAsJSON.bind(this);return new Promise((function(o,i){var a={method:"DELETE",headers:new Headers(r._headers),body:JSON.stringify(t)};fetch(e,a).then((function(e){return e.status>=400&&i(e),null!=n?n(e):e})).then(o).catch(i)}))}},{key:"_getMarks",value:function(e){var t=this;return new Promise((function(r,n){t.get("http://localhost:8080/api/".concat(e)).then(r).catch(n)}))}},{key:"getSpots",value:function(){return this._getMarks("spot")}},{key:"getShops",value:function(){return this._getMarks("shop")}},{key:"getBars",value:function(){return this._getMarks("bar")}},{key:"_saveMark",value:function(e,t){return this.post("http://localhost:8080/api/".concat(e,"/"),t,this._resolveAsJSON.bind(this))}},{key:"spotCreated",value:function(e){return this._saveMark("spot",e)}},{key:"shopCreated",value:function(e){return this._saveMark("shop",e)}},{key:"barCreated",value:function(e){return this._saveMark("bar",e)}},{key:"_editMark",value:function(e,t,r){return e&&t&&r||Promise.reject(),this.patch("http://localhost:8080/api/".concat(e,"/").concat(t,"/"),r,this._resolveAsJSON.bind(this))}},{key:"spotEdited",value:function(e,t){return this._editMark("spot",e,t)}},{key:"shopEdited",value:function(e,t){return this._editMark("shop",e,t)}},{key:"barEdited",value:function(e,t){return this._editMark("bar",e,t)}},{key:"_deleteMark",value:function(e,t,r){return e&&t&&r||Promise.reject(),this.delete("http://localhost:8080/api/".concat(e,"/").concat(t,"/"),r,null)}},{key:"spotDeleted",value:function(e,t){return this._deleteMark("spot",e,t)}},{key:"shopDeleted",value:function(e,t){return this._deleteMark("shop",e,t)}},{key:"barDeleted",value:function(e,t){return this._deleteMark("bar",e,t)}},{key:"csrf",get:function(){return null}}],r&&n(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),i=o;function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==a(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t);if("object"!==a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key,"string"),"symbol"===a(o)?o:String(o)),n)}var o}var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,r=[{key:"stripDom",value:function(e){return!e||"string"!=typeof e&&"number"!=typeof e?"":(new DOMParser).parseFromString(e,"text/html").body.textContent||""}},{key:"replaceString",value:function(e,t,r){return!!(e&&e.innerHTML&&t&&"string"==typeof t&&r&&"string"==typeof r)&&(e.innerHTML=e.innerHTML.replace(t,r),!0)}},{key:"getDistanceBetweenCoords",value:function(e,t){if(!(e&&t&&Array.isArray(e)&&Array.isArray(t)))return-1;if(2!==e.length||"number"!=typeof e[0]||"number"!=typeof e[1])return-1;if(2!==t.length||"number"!=typeof t[0]||"number"!=typeof t[1])return-1;var r=e[0]*Math.PI/180,n=e[1]*Math.PI/180,o=t[0]*Math.PI/180,i=o-r,a=t[1]*Math.PI/180-n,s=Math.pow(Math.sin(i/2),2)+Math.cos(r)*Math.cos(o)*Math.pow(Math.sin(a/2),2);return 2*Math.asin(Math.sqrt(s))*6371e3}},{key:"precisionRound",value:function(e,t){if("number"!=typeof e||"number"!=typeof t)return-1;var r=Math.pow(10,t||0);return Math.round(e*r)/r}},{key:"setDefaultPreferences",value:function(){null===e.getPreference("poi-show-spot")&&e.setPreference("poi-show-spot",!0),null===e.getPreference("poi-show-shop")&&e.setPreference("poi-show-shop",!0),null===e.getPreference("poi-show-bar")&&e.setPreference("poi-show-bar",!0),null===e.getPreference("poi-show-circle")&&e.setPreference("poi-show-circle",!0),null===e.getPreference("poi-show-label")&&e.setPreference("poi-show-label",!0),null===e.getPreference("map-plan-layer")&&e.setPreference("map-plan-layer","Plan OSM"),null===e.getPreference("selected-lang")&&e.setPreference("selected-lang","en"),null===e.getPreference("app-debug")&&e.setPreference("app-debug",!1),null===e.getPreference("map-high-accuracy")&&e.setPreference("map-high-accuracy",!1),null===e.getPreference("map-center-on-user")&&e.setPreference("map-center-on-user",!1),null===e.getPreference("dark-theme")&&e.setPreference("dark-theme",!0)}},{key:"formatMarker",value:function(e){if(!(e&&e.name&&e.types&&e.lat&&e.lng))return null;if("string"!=typeof e.name||!Array.isArray(e.types)||"number"!=typeof e.lat||"number"!=typeof e.lng)return null;for(var t=0;t<e.types.length;++t)if("string"!=typeof e.types[t])return null;if(e.description&&"string"!=typeof e.description)return null;if(e.modifiers){if(!Array.isArray(e.modifiers))return null;for(var r=0;r<e.modifiers.length;++r)if("string"!=typeof e.modifiers[r])return null}return e.rate&&"number"!=typeof e.rate||e.rate<0||e.rate>4||e.price&&"number"!=typeof e.price||e.price<0||e.price>2?null:{name:e.name,types:e.types,lat:e.lat,lng:e.lng,description:e.description,modifiers:e.modifiers,rate:e.rate,price:e.price}}},{key:"removeAllObjectKeys",value:function(e){return!(!e||"object"!==a(e)||Array.isArray(e)||(Object.keys(e).forEach((function(t){delete e[t]})),0))}},{key:"getPreference",value:function(e){return localStorage.getItem(e)||null}},{key:"setPreference",value:function(e,t){localStorage.setItem(e,t)}}],null&&s(t.prototype,null),r&&s(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),l=Object.freeze(["en","fr","es","de","pt"]);function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==u(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t);if("object"!==u(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key,"string"),"symbol"===u(o)?o:String(o)),n)}var o}var p=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._lang="",this._fullLang="",this._values={}}var t,r;return t=e,(r=[{key:"_init",value:function(){var e=this;return new Promise((function(t,r){fetch("/static/nls/".concat(e._lang,".json")).then((function(n){200!==n.status&&(n.msg="Fetching the i18n file failed",r(n)),n.text().then((function(o){try{e._values=JSON.parse(o)}catch(e){n.msg="Parsing the i18n file failed",r(n)}t()})).catch(r)})).catch(r)}))}},{key:"updateLang",value:function(e){var t=this;return new Promise((function(r,n){t._lang!==e?(t._lang=-1!==l.indexOf(e)?e:"en",t._fullLang=e,t._init().then(r).catch(n)):r()}))}},{key:"debug",value:function(e){return this._values.debug[e]||""}},{key:"notif",value:function(e){return this._values.notif[e]||""}},{key:"nav",value:function(e){return this._values.nav[e]||""}},{key:"map",value:function(e){return this._values.map[e]||""}},{key:"spot",value:function(e){return this._values.spot[e]||""}},{key:"shop",value:function(e){return this._values.shop[e]||""}},{key:"bar",value:function(e){return this._values.bar[e]||""}},{key:"popup",value:function(e){return this._values.popup[e]||""}},{key:"modal",value:function(e){return this._values.modal[e]||""}},{key:"login",value:function(e){return this._values.auth.login[e]||""}},{key:"register",value:function(e){return this._values.auth.register[e]||""}},{key:"forgotPassword",value:function(e){return this._values.auth.forgotPassword[e]||""}},{key:"resetPassword",value:function(e){return this._values.auth.resetPassword[e]||""}},{key:"handleLoginAside",value:function(e){c.replaceString(e,"{LOGIN_SUBTITLE}",this.login("subtitle")),c.replaceString(e,"{LOGIN_HIDDEN_ERROR}",this.login("hiddenError")),c.replaceString(e,"{LOGIN_USERNAME_LABEL}",this.login("username")),c.replaceString(e,"{LOGIN_USERNAME_PASSWORD}",this.login("password")),c.replaceString(e,"{LOGIN_BUTTON}",this.login("login")),c.replaceString(e,"{LOGIN_NOT_REGISTERED}",this.login("notRegistered")),c.replaceString(e,"{LOGIN_REGISTER}",this.login("register")),c.replaceString(e,"{LOGIN_FORGOT_PASSWORD}",this.login("forgot")),c.replaceString(e,"{LOGIN_PASSWORD_RESET}",this.login("reset"))}},{key:"handleRegisterAside",value:function(e){c.replaceString(e,"{REGISTER_SUBTITLE}",this.register("subtitle")),c.replaceString(e,"{REGISTER_HIDDEN_ERROR}",this.register("hiddenError")),c.replaceString(e,"{REGISTER_USERNAME_LABEL}",this.register("username")),c.replaceString(e,"{REGISTER_MAIL_LABEL}",this.register("mail")),c.replaceString(e,"{REGISTER_USERNAME_PASSWORD_1}",this.register("password1")),c.replaceString(e,"{REGISTER_USERNAME_PASSWORD_2}",this.register("password2")),c.replaceString(e,"{REGISTER_BUTTON}",this.register("register")),c.replaceString(e,"{REGISTER_ALREADY_DONE}",this.register("notRegistered")),c.replaceString(e,"{REGISTER_LOGIN}",this.register("login"))}},{key:"handleForgotPasswordAside",value:function(e){c.replaceString(e,"{FORGOT_PASSWORD_SUBTITLE}",this.forgotPassword("subtitle")),c.replaceString(e,"{FORGOT_PASSWORD_ERROR}",this.register("hiddenError")),c.replaceString(e,"{FORGOT_PASSWORD_MAIL_LABEL}",this.forgotPassword("mail")),c.replaceString(e,"{FORGOT_PASSWORD_BUTTON}",this.forgotPassword("submit")),c.replaceString(e,"{FORGOT_PASSWORD_LOGIN_LABEL}",this.forgotPassword("loginLabel")),c.replaceString(e,"{FORGOT_PASSWORD_LOGIN}",this.forgotPassword("login"))}},{key:"handleResetPasswordAside",value:function(e){c.replaceString(e,"{RESET_PASSWORD_SUBTITLE}",this.resetPassword("subtitle")),c.replaceString(e,"{RESET_PASSWORD_HIDDEN_ERROR}",this.resetPassword("hiddenError")),c.replaceString(e,"{RESET_PASSWORD_1}",this.resetPassword("password1")),c.replaceString(e,"{RESET_PASSWORD_2}",this.resetPassword("password2")),c.replaceString(e,"{RESET_PASSWORD_BUTTON}",this.resetPassword("reset")),c.replaceString(e,"{RESET_PASSWORD_LOGIN_LABEL}",this.resetPassword("loginLabel")),c.replaceString(e,"{RESET_PASSWORD_LOGIN}",this.resetPassword("login"))}},{key:"addMarkModal",value:function(e,t,r){c.replaceString(e.querySelector("#nls-".concat(t,"-title")),"{".concat(t.toUpperCase(),"_TITLE}"),this[t]("".concat(r,"Title"))),c.replaceString(e.querySelector("#nls-".concat(t,"-subtitle")),"{".concat(t.toUpperCase(),"_SUBTITLE}"),this[t]("subtitle")),c.replaceString(e.querySelector("#nls-".concat(t,"-name")),"{".concat(t.toUpperCase(),"_NAME}"),this[t]("nameLabel")),c.replaceString(e.querySelector("#nls-".concat(t,"-desc")),"{".concat(t.toUpperCase(),"_DESC}"),this[t]("descLabel")),c.replaceString(e.querySelector("#nls-".concat(t,"-rate")),"{".concat(t.toUpperCase(),"_RATE}"),this[t]("rateLabel")),c.replaceString(e.querySelector("#nls-".concat(t,"-type")),"{".concat(t.toUpperCase(),"_TYPE}"),this[t]("typeLabel")),c.replaceString(e.querySelector("#nls-".concat(t,"-modifiers")),"{".concat(t.toUpperCase(),"_MODIFIERS}"),this[t]("modifiersLabel")),c.replaceString(e.querySelector("#".concat(t,"-submit")),"{".concat(t.toUpperCase(),"_SUBMIT}"),this.nav(r)),c.replaceString(e.querySelector("#".concat(t,"-close")),"{".concat(t.toUpperCase(),"_CANCEL}"),this.nav("cancel")),e.querySelector("#nls-".concat(t,"-price"))&&c.replaceString(e.querySelector("#nls-".concat(t,"-price")),"{".concat(t.toUpperCase(),"_PRICE}"),this[t]("priceLabel"))}},{key:"deleteMarkModal",value:function(e){c.replaceString(e.querySelector("#nls-modal-title"),"{MODAL_TITLE}",this.modal("deleteMarkTitle")),c.replaceString(e.querySelector("#nls-modal-desc"),"{MODAL_DESC}",this.modal("deleteMarkDesc")),c.replaceString(e.querySelector("#cancel-close"),"{MODAL_CANCEL}",this.nav("cancel")),c.replaceString(e.querySelector("#delete-close"),"{MODAL_DELETE}",this.nav("delete"))}},{key:"userProfileModal",value:function(e){c.replaceString(e.querySelector("#nls-modal-title"),"{MODAL_TITLE}",this.modal("userTitle")),c.replaceString(e.querySelector("#nls-user-high-accuracy"),"{ACCURACY_USER_CHECK}",this.modal("userAccuracyPref")),c.replaceString(e.querySelector("#nls-user-dark-theme"),"{DARK_THEME_CHECK}",this.modal("darkThemePref")),c.replaceString(e.querySelector("#nls-user-debug"),"{DEBUG_USER_CHECK}",this.modal("userDebugPref")),c.replaceString(e.querySelector("#nls-lang-select"),"{LANG_SELECT}",this.modal("langPref")),c.replaceString(e.querySelector("#nls-lang-fr"),"{LANG_FR}",this.modal("langFr")),c.replaceString(e.querySelector("#nls-lang-en"),"{LANG_EN}",this.modal("langEn")),c.replaceString(e.querySelector("#nls-lang-es"),"{LANG_ES}",this.modal("langEs")),c.replaceString(e.querySelector("#nls-lang-de"),"{LANG_DE}",this.modal("langDe")),c.replaceString(e.querySelector("#nls-lang-pt"),"{LANG_PT}",this.modal("langPt")),c.replaceString(e.querySelector("#nls-about-desc"),"{BEERCRACKERZ_DESC}",this.modal("aboutDesc")),c.replaceString(e.querySelector("#nls-update-pp"),"{UPDATE_PROFILE_PIC_LABEL}",this.modal("updatePP"))}},{key:"updateProfilePictureModal",value:function(e){c.replaceString(e.querySelector("#nls-modal-title"),"{MODAL_TITLE}",this.modal("updatePPTitle")),c.replaceString(e.querySelector("#nls-modal-desc"),"{UPDATE_PP_DESC}",this.modal("updatePPDesc")),c.replaceString(e.querySelector("#update-pp-close"),"{UPDATE_PP_CANCEL}",this.nav("cancel")),c.replaceString(e.querySelector("#update-pp-submit"),"{UPDATE_PP_SUBMIT}",this.nav("upload"))}},{key:"hideShowModal",value:function(e){c.replaceString(e.querySelector("#nls-hideshow-modal-title"),"{MODAL_TITLE}",this.modal("hideShowTitle")),c.replaceString(e.querySelector("#nls-hideshow-modal-labels"),"{LABELS_HIDESHOW_MODAL}",this.modal("hideShowLabels")),c.replaceString(e.querySelector("#nls-hideshow-modal-circles"),"{CIRCLES_HIDESHOW_MODAL}",this.modal("hideShowCircles")),c.replaceString(e.querySelector("#nls-hideshow-modal-spots"),"{SPOTS_HIDESHOW_MODAL}",this.modal("hideShowSpots")),c.replaceString(e.querySelector("#nls-hideshow-modal-shops"),"{SHOPS_HIDESHOW_MODAL}",this.modal("hideShowShops")),c.replaceString(e.querySelector("#nls-hideshow-modal-bars"),"{BARS_HIDESHOW_MODAL}",this.modal("hideShowBars")),c.replaceString(e.querySelector("#nls-view-helper-label"),"{HELPER_LABEL}",this.modal("hideShowHelperLabel")),c.replaceString(e.querySelector("#modal-close-button"),"{MODAL_CLOSE}",this.nav("close"))}},{key:"markPopup",value:function(e,t){c.replaceString(e,"{".concat(t.type.toUpperCase(),"_NAME}"),c.stripDom(t.name)),c.replaceString(e,"{".concat(t.type.toUpperCase(),"_FINDER}"),t.user),c.replaceString(e,"{".concat(t.type.toUpperCase(),"_FOUND_BY}"),this.popup("".concat(t.type,"FoundBy"))),c.replaceString(e,"{".concat(t.type.toUpperCase(),"_FOUND_WHEN}"),this.popup("".concat(t.type,"FoundWhen"))),c.replaceString(e,"{".concat(t.type.toUpperCase(),"_FOUND_DATE}"),t.date),c.replaceString(e,"{".concat(t.type.toUpperCase(),"_RATE}"),"".concat(t.rate+1)),c.replaceString(e,"{".concat(t.type.toUpperCase(),"_DESC}"),t.desc)}},{key:"fullLang",get:function(){return this._fullLang}}])&&d(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),m=Object.freeze({optimized:{enableHighAccuracy:!1,maximumAge:3e4,timeout:29e3},high:{enableHighAccuracy:!0,maximumAge:1e3,timeout:900}}),h=Object.freeze({newMarkRange:"#FFD87D",user:"#63FFF5",spot:"#26AD23",shop:"#247DC9",bar:"#CA2A3D"}),g=Object.freeze({newMarkRange:200,socialMarkRange:100,mapBounds:window.L.latLngBounds(window.L.latLng(-89.98155760646617,-180),window.L.latLng(89.99346179538875,180))}),f=Object.freeze({blue:new window.L.Icon({iconUrl:"/static/img/marker/marker-icon-blue.png",shadowUrl:"/static/img/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),gold:new window.L.Icon({iconUrl:"/static/img/marker/marker-icon-gold.png",shadowUrl:"/static/img/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),red:new window.L.Icon({iconUrl:"/static/img/marker/marker-icon-red.png",shadowUrl:"/static/img/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),green:new window.L.Icon({iconUrl:"/static/img/marker/marker-icon-green.png",shadowUrl:"/static/img/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),orange:new window.L.Icon({iconUrl:"/static/img/marker/marker-icon-orange.png",shadowUrl:"/static/img/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),yellow:new window.L.Icon({iconUrl:"/static/img/marker/marker-icon-yellow.png",shadowUrl:"/static/img/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),violet:new window.L.Icon({iconUrl:"/static/img/marker/marker-icon-violet.png",shadowUrl:"/static/img/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),grey:new window.L.Icon({iconUrl:"/static/img/marker/marker-icon-grey.png",shadowUrl:"/static/img/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),black:new window.L.Icon({iconUrl:"/static/img/marker/marker-icon-black.png",shadowUrl:"/static/img/marker/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),user:new window.L.Icon({iconUrl:"/static/img/marker/user-position.png",shadowUrl:"/static/img/marker/user-position-shadow.png",iconSize:[32,32],iconAnchor:[16,16],popupAnchor:[1,-34],shadowSize:[32,32]})});function y(e){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y(e)}function w(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==y(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t);if("object"!==y(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key,"string"),"symbol"===y(o)?o:String(o)),n)}var o}var v=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,r;return t=e,r=[{key:"initDebugUI",value:function(){var e=window.BeerCrackerz.nls.debug.bind(window.BeerCrackerz.nls),t=document.createElement("DIV"),r=document.createElement("H1"),n=document.createElement("P"),o=document.createElement("P"),i=document.createElement("P"),a=document.createElement("P"),s=document.createElement("P"),c=document.createElement("P"),l=document.createElement("P"),u=document.createElement("P"),d=document.createElement("P");return t.classList.add("debug-container"),n.classList.add("debug-user-lat"),o.classList.add("debug-user-lng"),i.classList.add("debug-updates-amount"),a.classList.add("debug-user-accuracy"),s.classList.add("debug-high-accuracy"),c.classList.add("debug-pos-max-age"),l.classList.add("debug-pos-timeout"),u.classList.add("debug-zoom-level"),d.classList.add("debug-marks-amount"),r.innerHTML="BeerCrackerz v".concat(window.VERSION),n.innerHTML="<b>".concat(e("lat"),"</b> -"),o.innerHTML="<b>".concat(e("lng"),"</b> -"),i.innerHTML="<b>".concat(e("updates"),"</b> 0"),a.innerHTML="<b>".concat(e("accuracy"),"</b> -"),s.innerHTML="<b>".concat(e("highAccuracy"),"</b> -"),c.innerHTML="<b>".concat(e("posAge"),"</b> -"),l.innerHTML="<b>".concat(e("posTimeout"),"</b> -"),u.innerHTML="<b>".concat(e("zoom"),"</b> -"),d.innerHTML="<b>".concat(e("marks"),"</b> -"),t.appendChild(r),t.appendChild(n),t.appendChild(o),t.appendChild(i),t.appendChild(a),t.appendChild(s),t.appendChild(c),t.appendChild(l),t.appendChild(u),t.appendChild(d),t}},{key:"addDebugUI",value:function(){document.body.appendChild(window.BeerCrackerz.debugElement)}},{key:"removeDebugUI",value:function(){document.body.removeChild(window.BeerCrackerz.debugElement)}},{key:"updateDebugUI",value:function(){if(!0===window.DEBUG){var e="true"===c.getPreference("map-high-accuracy")?m.high:m.optimized,t=window.BeerCrackerz.debugElement,r=window.BeerCrackerz.user,n=window.BeerCrackerz,o=n.nls.debug.bind(n.nls),i=parseInt(t.querySelector(".debug-updates-amount").innerHTML.split(" ")[1])+1,a=n.marks.spot.length+n.marks.shop.length+n.marks.bar.length;t.querySelector(".debug-user-lat").innerHTML="<b>".concat(o("lat"),"</b> ").concat(r.lat),t.querySelector(".debug-user-lng").innerHTML="<b>".concat(o("lng"),"</b> ").concat(r.lng),t.querySelector(".debug-updates-amount").innerHTML="<b>".concat(o("updates"),"</b> ").concat(i),t.querySelector(".debug-user-accuracy").innerHTML="<b>".concat(o("accuracy"),"</b> ").concat(c.precisionRound(r.accuracy,2),"m"),t.querySelector(".debug-high-accuracy").innerHTML="<b>".concat(o("highAccuracy"),"</b> ").concat(!0===e.enableHighAccuracy?o("enabled"):o("disabled")),t.querySelector(".debug-pos-max-age").innerHTML="<b>".concat(o("posAge"),"</b> ").concat(e.maximumAge/1e3,"s"),t.querySelector(".debug-pos-timeout").innerHTML="<b>".concat(o("posTimeout"),"</b> ").concat(e.timeout/1e3,"s"),t.querySelector(".debug-zoom-level").innerHTML="<b>".concat(o("zoom"),"</b> ").concat(n.map.getZoom()),t.querySelector(".debug-marks-amount").innerHTML="<b>".concat(o("marks"),"</b> ").concat(a)}}},{key:"drawUserMarker",value:function(){window.BeerCrackerz.user.marker?(window.BeerCrackerz.user.marker.setLatLng(window.BeerCrackerz.user),window.BeerCrackerz.user.range.setLatLng(window.BeerCrackerz.user),window.BeerCrackerz.user.circle.setLatLng(window.BeerCrackerz.user),window.BeerCrackerz.user.circle.setRadius(window.BeerCrackerz.user.accuracy)):(window.BeerCrackerz.user.type="user",window.BeerCrackerz.user.marker=e.addMark(window.BeerCrackerz.user),window.BeerCrackerz.user.radius=window.BeerCrackerz.user.accuracy,window.BeerCrackerz.user.circle=e.drawCircle(window.BeerCrackerz.user),window.BeerCrackerz.user.range=e.drawCircle({lat:window.BeerCrackerz.user.lat,lng:window.BeerCrackerz.user.lng,radius:g.newMarkRange,color:h.newMarkRange}),window.BeerCrackerz.user.circle.addTo(window.BeerCrackerz.map),window.BeerCrackerz.user.range.addTo(window.BeerCrackerz.map),"true"===c.getPreference("poi-show-circle")&&(window.BeerCrackerz.user.circle.setStyle({opacity:1,fillOpacity:.1}),window.BeerCrackerz.user.range.setStyle({opacity:1,fillOpacity:.1})),window.BeerCrackerz.user.marker.on("click",window.BeerCrackerz.mapClicked.bind(window.BeerCrackerz)))}},{key:"drawCircle",value:function(e){return window.L.circle(e,{color:e.color,fillColor:e.color,opacity:0,fillOpacity:0,radius:e.radius?e.radius:g.socialMarkRange})}},{key:"setMarkerCircles",value:function(e){for(var t=function(t){for(var r=0;r<t.length;++r)e?(t[r].circle.setStyle({opacity:1,fillOpacity:.1}),t[r].circle.addTo(window.BeerCrackerz.map)):(t[r].circle.setStyle({opacity:0,fillOpacity:0}),t[r].circle.removeFrom(window.BeerCrackerz.map))},r=Object.keys(window.BeerCrackerz.marks),n=0;n<r.length;++n)t(window.BeerCrackerz.marks[r[n]]);t([window.BeerCrackerz.user]),t([{circle:window.BeerCrackerz.user.range}])}},{key:"updateMarkerCirclesVisibility",value:function(){if("true"===c.getPreference("poi-show-circle")){var e=function(e){for(var t=0;t<e.length;++t)if(window.BeerCrackerz.map.getBounds().contains(e[t].marker.getLatLng())){var r=e[t].marker,n=c.getDistanceBetweenCoords([window.BeerCrackerz.user.lat,window.BeerCrackerz.user.lng],[r.getLatLng().lat,r.getLatLng().lng]);n<g.socialMarkRange&&!e[t].circle.visible?(e[t].circle.visible=!0,e[t].circle.setStyle({opacity:1,fillOpacity:.1})):n>=g.socialMarkRange&&e[t].circle.visible&&(e[t].circle.visible=!1,e[t].circle.setStyle({opacity:0,fillOpacity:0}))}};e(window.BeerCrackerz.marks.spot),e(window.BeerCrackerz.marks.shop),e(window.BeerCrackerz.marks.bar),e([window.BeerCrackerz.user])}}},{key:"setMarkerLabels",value:function(e){for(var t=function(t){for(var r=0;r<t.length;++r)e&&!1===t[r].clustered?t[r].tooltip.addTo(window.BeerCrackerz.map):t[r].tooltip.removeFrom(window.BeerCrackerz.map)},r=Object.keys(window.BeerCrackerz.marks),n=0;n<r.length;++n)t(window.BeerCrackerz.marks[r[n]])}},{key:"removeMarkDecoration",value:function(e){e.tooltip.removeFrom(window.BeerCrackerz.map),e.circle.setStyle({opacity:0,fillOpacity:0}),e.circle.removeFrom(window.BeerCrackerz.map),e.popup&&e.popup.destroy()}},{key:"addMark",value:function(t){var r=f.black;"shop"===t.type?r=f.blue:"spot"===t.type?r=f.green:"bar"===t.type?r=f.red:"user"===t.type&&(r=f.user);var n=window.L.marker([t.lat,t.lng],{icon:r}).on("click",e.centerOn.bind(e,t));return t.dom&&n.bindPopup(t.dom),-1===["spot","shop","bar"].indexOf(t.type)&&n.addTo(window.BeerCrackerz.map),n}},{key:"toggleLabel",value:function(){var t=!("true"===c.getPreference("poi-show-label"));e.setMarkerLabels(t),c.setPreference("poi-show-label",t)}},{key:"toggleCircle",value:function(){var t=!("true"===c.getPreference("poi-show-circle"));e.setMarkerCircles(t),c.setPreference("poi-show-circle",t)}},{key:"toggleMarkers",value:function(e){var t=e.target.dataset.type,r=!("true"===c.getPreference("poi-show-".concat(t)));if(!0===r){for(var n=0;n<window.BeerCrackerz.marks[t].length;++n)window.BeerCrackerz.marks[t][n].visible=!0,window.BeerCrackerz.marks[t][n].circle.setStyle({opacity:1,fillOpacity:.1});window.BeerCrackerz.map.addLayer(window.BeerCrackerz.clusters[t])}else{for(var o=0;o<window.BeerCrackerz.marks[t].length;++o)window.BeerCrackerz.marks[t][o].visible=!1,window.BeerCrackerz.marks[t][o].circle.setStyle({opacity:0,fillOpacity:0});window.BeerCrackerz.map.removeLayer(window.BeerCrackerz.clusters[t])}c.setPreference("poi-show-".concat(t),r)}},{key:"toggleDebug",value:function(){var t=!window.DEBUG;window.DEBUG=t,c.setPreference("app-debug",t),t?e.addDebugUI():e.removeDebugUI()}},{key:"toggleDarkTheme",value:function(){var e="true"===c.getPreference("dark-theme");c.setPreference("dark-theme",!e),!0===e?(document.body.classList.remove("dark-theme"),document.body.classList.add("light-theme")):(document.body.classList.remove("light-theme"),document.body.classList.add("dark-theme"))}},{key:"toggleFocusLock",value:function(){"true"===c.getPreference("map-center-on-user")?(window.BeerCrackerz.notification.raise(window.BeerCrackerz.nls.notif("unlockFocusOn")),document.getElementById("center-on").classList.remove("lock-center-on"),c.setPreference("map-center-on-user","false")):(window.BeerCrackerz.notification.raise(window.BeerCrackerz.nls.notif("lockFocusOn")),document.getElementById("center-on").classList.add("lock-center-on"),window.BeerCrackerz.map.flyTo([window.BeerCrackerz.user.lat,window.BeerCrackerz.user.lng],18),c.setPreference("map-center-on-user","true"))}},{key:"centerOn",value:function(t){"true"===c.getPreference("map-center-on-user")&&e.toggleFocusLock(),window.BeerCrackerz.map.flyTo([t.lat,t.lng],window.BeerCrackerz.map.getZoom())}},{key:"checkClusteredMark",value:function(e){if("true"===c.getPreference("poi-show-label"))for(var t=window.BeerCrackerz.marks[e],r=0;r<t.length;++r){var n=window.BeerCrackerz.map.hasLayer(t[r].marker);t[r].clustered=!n,n?t[r].tooltip.addTo(window.BeerCrackerz.map):t[r].tooltip.removeFrom(window.BeerCrackerz.map)}}}],null&&w(t.prototype,null),r&&w(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function k(e){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k(e)}function b(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==k(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t);if("object"!==k(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key,"string"),"symbol"===k(o)?o:String(o)),n)}var o}var _=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._map=t,this._container=document.querySelector("#zoom-slider"),this._slider=document.querySelector("#slider-position"),this._zoomRange=this._map.getMaxZoom()-this._map.getMinZoom(),this._timeoutId=-1,this._events()}var t,r;return t=e,(r=[{key:"_events",value:function(){var e=this;this._map.on("zoomstart",this._zoomStart.bind(this)),this._map.on("zoomend",this._zoomEnd.bind(this)),this._map.on("zoom",(function(){return e._zoom.bind(e)})),this._container.addEventListener("mouseover",this._clearTimeout.bind(this)),this._container.querySelector("#slider-wrapper").addEventListener("click",this._relativeZoom.bind(this)),this._container.addEventListener("mouseleave",this._startTimeout.bind(this)),this._container.querySelector("#zoom-more").addEventListener("click",this._zoomIn.bind(this)),this._container.querySelector("#zoom-less").addEventListener("click",this._zoomOut.bind(this))}},{key:"_zoomStart",value:function(){this._clearTimeout(),this._container.classList.add("opened")}},{key:"_zoomEnd",value:function(){var e=this._map.getZoom()-this._map.getMinZoom();this._slider.style.height="".concat(100*e/this._zoomRange,"%"),this._startTimeout()}},{key:"_zoom",value:function(){this._clearTimeout();var e=this._map.getZoom()-this._map.getMinZoom();this._slider.style.height="".concat(100*e/this._zoomRange,"%")}},{key:"_zoomIn",value:function(){this._map.setZoom(this._map.getZoom()+1)}},{key:"_zoomOut",value:function(){this._map.setZoom(this._map.getZoom()-1)}},{key:"_relativeZoom",value:function(e){this._clearTimeout();var t=this._container.querySelector("#slider-wrapper").getBoundingClientRect(),r=(t.height-(e.pageY-t.top))/t.height;this._slider.style.height="".concat(100*r,"%"),this._map.setZoom(this._map.getMinZoom()+100*r*this._zoomRange/100)}},{key:"_startTimeout",value:function(){var e=this;this._timeoutId=setTimeout((function(){e._container.classList.remove("opened")}),1500)}},{key:"_clearTimeout",value:function(){clearTimeout(this._timeoutId),this._timeoutId=-1}}])&&b(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),S=Object.freeze({spot:new window.L.MarkerClusterGroup({animateAddingMarkers:!0,disableClusteringAtZoom:18,spiderfyOnMaxZoom:!1,maxClusterRadius:360,iconCreateFunction:function(e){return window.L.divIcon({className:"cluster-icon-wrapper",html:'\n          <img src="/static/img/marker/marker-icon-green.png" class="cluster-icon">\n          <span class="cluster-label">'.concat(e.getChildCount(),"</span>\n        ")})},polygonOptions:{fillColor:"#3ABC30",color:"#3ABC30",weight:.5,opacity:1,fillOpacity:.4}}),shop:new window.L.MarkerClusterGroup({animateAddingMarkers:!0,disableClusteringAtZoom:18,spiderfyOnMaxZoom:!1,maxClusterRadius:360,iconCreateFunction:function(e){return window.L.divIcon({className:"cluster-icon-wrapper",html:'\n          <img src="/static/img/marker/marker-icon-blue.png" class="cluster-icon">\n          <span class="cluster-label">'.concat(e.getChildCount(),"</span>\n        ")})},polygonOptions:{fillColor:"#4295CF",color:"#4295CF",weight:.5,opacity:1,fillOpacity:.4}}),bar:new window.L.MarkerClusterGroup({animateAddingMarkers:!0,disableClusteringAtZoom:18,spiderfyOnMaxZoom:!1,maxClusterRadius:360,iconCreateFunction:function(e){return window.L.divIcon({className:"cluster-icon-wrapper",html:'\n          <img src="/static/img/marker/marker-icon-red.png" class="cluster-icon">\n          <span class="cluster-label">'.concat(e.getChildCount(),"</span>\n        ")})},polygonOptions:{fillColor:"#D0465D",color:"#D0465D",weight:.5,opacity:1,fillOpacity:.4}})}),L=Object.freeze({planOsm:window.L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',minZoom:5,maxNativeZoom:19,maxZoom:21}),satEsri:window.L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:'&copy; <a href="https://www.arcgis.com/home/item.html?id=10df2279f9684e4a9f6a7f08febac2a9">Esri Imagery</a>',minZoom:5,maxNativeZoom:19,maxZoom:21})});function E(e){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E(e)}function C(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,o=function(e,t){if("object"!==E(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t);if("object"!==E(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key,"string"),"symbol"===E(o)?o:String(o)),n)}var o}var P=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._user={lat:48.853121540141096,lng:2.3498955769881156,accuracy:0},this._marks={spot:[],shop:[],bar:[]},this._clusters={spot:{},shop:{},bar:{}},this._aside=null,this._isAsideExpanded=!0,this._kom=null,this._lang=new p,this._init()}var t,r;return t=e,r=[{key:"_init",value:function(){var e=this;this.nls.updateLang(c.getPreference("selected-lang")).then((function(){if(e._handleLoginAside(),e._kom=new i,!0===e._kom.isValid){var t=new URLSearchParams(window.location.search),r=Object.fromEntries(t.entries());if(r.activate){var n=document.getElementById("login-error");n.classList.add("visible"),"True"===r.activate?(n.classList.add("success"),n.innerHTML=e.nls.register("activationSuccess")):n.innerHTML=e.nls.register("activationError")}else r.uidb64&&r.token&&e._loadForgotPasswordAside(r);e._initMap().then(e._initGeolocation.bind(e)).then(e._initMarkers.bind(e)).then(e._initEvents.bind(e)).catch(e._fatalError.bind(e))}else e._fatalError({file:"Kom.js",msg:null===e._kom.csrf?"The CSRF token doesn't exists in cookies":"The headers amount is invalid"})}))}},{key:"_initMap",value:function(){var e=this;return new Promise((function(t){e._map=window.L.map("beer-crakerz-map",{zoomControl:!1}).setView([48.853121540141096,2.3498955769881156],12),window.L.control.scale().addTo(e._map),e._drawUserMarker(),e._map.setMaxBounds(g.mapBounds);var r={};r["<p>".concat(e.nls.map("planLayerOSM"),"</p>")]=L.planOsm,r["<p>".concat(e.nls.map("satLayerEsri"),"</p>")]=L.satEsri,L.planOsm.addTo(e._map),window.L.control.layers(r,{},{position:"bottomright"}).addTo(e._map),e._zoomSlider=new _(e._map),t()}))}},{key:"_initGeolocation",value:function(){var e=this;return new Promise((function(t){"geolocation"in navigator?(e._watchId=navigator.geolocation.watchPosition((function(t){e._user.lat=t.coords.latitude,e._user.lng=t.coords.longitude,e._user.accuracy=t.coords.accuracy,e._map&&e._drawUserMarker()}),null,m.high),t()):t()}))}},{key:"_initMarkers",value:function(){var e=this;return new Promise((function(t){e._clusters.spot=S.spot,e._clusters.shop=S.shop,e._clusters.bar=S.bar,e._map.addLayer(e._clusters.spot),e._map.addLayer(e._clusters.shop),e._map.addLayer(e._clusters.bar);var r=function(t){e._markPopupFactory(t).then((function(r){t.dom=r,t.marker=e._createMarker(t),e._marks[t.type].push(t),e._clusters[t.type].addLayer(t.marker)}))};e._kom.getSpots().then((function(e){for(var t=0;t<e.length;++t)r(e[t])})),e._kom.getShops().then((function(e){for(var t=0;t<e.length;++t)r(e[t])})),e._kom.getBars().then((function(e){for(var t=0;t<e.length;++t)r(e[t])})),t()}))}},{key:"_initEvents",value:function(){var e=this;return new Promise((function(t){e._map.on("drag",(function(){e._map.panInsideBounds(g.mapBounds,{animate:!0})})),e._map.on("zoomend",(function(){e._map.getZoom()<15?(e._setMarkerLabels(e._marks.spot,!1),e._setMarkerLabels(e._marks.shop,!1),e._setMarkerLabels(e._marks.bar,!1)):(e._setMarkerLabels(e._marks.spot,!0),e._setMarkerLabels(e._marks.shop,!0),e._setMarkerLabels(e._marks.bar,!0))})),e._clusters.spot.on("animationend",v.checkClusteredMark.bind(e,"spot")),e._clusters.shop.on("animationend",v.checkClusteredMark.bind(e,"shop")),e._clusters.bar.on("animationend",v.checkClusteredMark.bind(e,"bar")),document.getElementById("center-on").addEventListener("click",(function(){e._map.flyTo([e._user.lat,e._user.lng],18)})),t()}))}},{key:"_fatalError",value:function(e){!1===window.DEBUG?(e&&e.status?window.history.pushState("","","/welcome?&page=welcome&code=".concat(e.status,"&url=").concat(e.url,"&msg=").concat(e.msg)):e&&e.file&&e.msg?window.history.pushState("","","/welcome?&page=welcome&file=".concat(e.file,"&msg=").concat(e.msg)):window.history.pushState("","","/welcome?&page=welcome&file=BeerCrackerzAuth.js&msg=An unknown error occured"),window.location.href="/error"):console.error(e)}},{key:"_toggleAside",value:function(){!0===this._isAsideExpanded?(this._isAsideExpanded=!1,document.documentElement.style.setProperty("--aside-offset","-40rem"),document.getElementById("aside-expander-icon").src="/static/img/logo/left.svg",document.getElementById("page-header").classList.add("visible"),setTimeout((function(){return document.getElementById("aside-expander").style.left="-5rem"}),300)):(this._isAsideExpanded=!0,document.documentElement.style.setProperty("--aside-offset","0rem"),document.getElementById("aside-expander-icon").src="/static/img/logo/right.svg",document.getElementById("aside-expander").style.left="0",document.getElementById("page-header").classList.remove("visible"))}},{key:"_loadAside",value:function(e){var t=this;return new Promise((function(r,n){t._kom.getTemplate("/aside/".concat(e)).then((function(n){document.body.classList.add(e),t._aside=document.getElementById("aside"),t._aside.innerHTML="",t._aside.appendChild(n),r()})).catch(n)}))}},{key:"_loadLoginAside",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._loadAside("login").then(this._handleLoginAside.bind(this,t)).catch((function(t){t.msg="Couldn't fetch or build the login aside",e._fatalError(t)}))}},{key:"_loadRegisterAside",value:function(){var e=this;this._loadAside("register").then(this._handleRegisterAside.bind(this)).catch((function(t){t.msg="Couldn't fetch or build the register aside",e._fatalError(t)}))}},{key:"_loadForgotPasswordAside",value:function(e){var t=this;e.uidb64&&e.token?this._loadAside("resetpassword").then(this._handleResetPasswordAside.bind(this,e)).catch((function(e){e.msg="Couldn't fetch or build the forgot password aside",t._fatalError(e)})):this._loadAside("forgotpassword").then(this._handleForgotPasswordAside.bind(this)).catch((function(e){e.msg="Couldn't fetch or build the forgot password aside",t._fatalError(e)}))}},{key:"_handleLoginAside",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];document.title=this.nls.login("headTitle"),this.nls.handleLoginAside(document.getElementById("aside"));var r=document.getElementById("login-error"),n=document.getElementById("username"),o=document.getElementById("password");!0===t&&(r.classList.add("visible"),r.innerHTML=this.nls.login("checkMail"));var i=function(){return r.className="error",""===n.value&&""===o.value?(r.classList.add("visible"),r.innerHTML=e.nls.login("bothEmpty"),n.classList.add("error"),o.classList.add("error"),!1):""===n.value?(r.classList.add("visible"),r.innerHTML=e.nls.login("usernameEmpty"),n.classList.add("error"),!1):""!==o.value||(r.classList.add("visible"),r.innerHTML=e.nls.login("passwordEmpty"),o.classList.add("error"),!1)},a=function(){window.location="/"},s=function(){r.classList.remove("visible"),n.classList.remove("error"),o.classList.remove("error"),i()&&e._kom.post("/api/auth/login/",{username:n.value,password:o.value}).then(a).catch((function(){r.classList.add("visible"),r.innerHTML=e.nls.login("serverError")}))};document.getElementById("login-submit").addEventListener("click",s.bind(this),!1),o.addEventListener("keydown",(function(e){"Enter"===e.key&&s()})),document.getElementById("register-aside").addEventListener("click",this._loadRegisterAside.bind(this),!1),document.getElementById("forgot-password").addEventListener("click",this._loadForgotPasswordAside.bind(this),!1),document.getElementById("aside-expander").addEventListener("click",this._toggleAside.bind(this),!1)}},{key:"_handleRegisterAside",value:function(){var e=this,t=document.getElementById("aside");document.title=this.nls.register("headTitle"),this.nls.handleRegisterAside(t);var r=document.getElementById("register-error"),n=document.getElementById("username"),o=document.getElementById("mail"),i=document.getElementById("password1"),a=document.getElementById("password2"),s=function(){e._loadLoginAside(!0)},c=function(){r.classList.remove("visible"),n.classList.remove("error"),o.classList.remove("error"),i.classList.remove("error"),a.classList.remove("error"),(""===n.value||""===o.value||""===i.value||""===a.value?(r.classList.add("visible"),r.innerHTML=e.nls.register("fieldEmpty"),""===n.value&&n.classList.add("error"),""===o.value&&o.classList.add("error"),""===i.value&&i.classList.add("error"),""===a.value&&a.classList.add("error"),0):i.value===a.value||(r.classList.add("visible"),r.innerHTML=e.nls.register("notMatchingPassword"),i.classList.add("error"),a.classList.add("error"),0))&&e._kom.post("/api/auth/register/",{username:n.value,email:o.value,password1:i.value,password2:a.value}).then(s).catch((function(){r.classList.add("visible"),r.innerHTML=e.nls.register("serverError")}))};document.getElementById("register-submit").addEventListener("click",c.bind(this),!1),a.addEventListener("keydown",(function(e){"Enter"===e.key&&c()})),document.getElementById("login-aside").addEventListener("click",this._loadLoginAside.bind(this),!1),document.getElementById("aside-expander").addEventListener("click",this._toggleAside.bind(this),!1)}},{key:"_handleForgotPasswordAside",value:function(){var e=this,t=document.getElementById("aside");document.title=this.nls.forgotPassword("headTitle"),this.nls.handleForgotPasswordAside(t);var r=document.getElementById("forgot-password-error"),n=document.getElementById("mail"),o=function(){r.classList.add("visible"),r.innerHTML=e.nls.login("checkMail")},i=function(){r.classList.remove("visible"),n.classList.remove("error"),(""!==n.value||(r.classList.add("visible"),r.innerHTML=e.nls.forgotPassword("fieldEmpty"),""===n.value&&n.classList.add("error"),0))&&e._kom.post("/api/auth/password-reset-request/",{email:n.value},null).then(o).catch((function(){r.classList.add("visible"),r.innerHTML=e.nls.forgotPassword("serverError")}))};document.getElementById("forgot-password-submit").addEventListener("click",i.bind(this),!1),n.addEventListener("keydown",(function(e){"Enter"===e.key&&i()})),document.getElementById("login-aside").addEventListener("click",this._loadLoginAside.bind(this),!1),document.getElementById("aside-expander").addEventListener("click",this._toggleAside.bind(this),!1)}},{key:"_handleResetPasswordAside",value:function(e){var t=this,r=document.getElementById("aside");document.title=this.nls.resetPassword("headTitle"),this.nls.handleResetPasswordAside(r);var n=document.getElementById("reset-password-error"),o=document.getElementById("password1"),i=document.getElementById("password2"),a=function(){t._loadLoginAside()},s=function(){n.classList.remove("visible"),o.classList.remove("error"),i.classList.remove("error"),(""===o.value||""===i.value?(n.classList.add("visible"),n.innerHTML=t.nls.resetPassword("fieldEmpty"),""===o.value&&o.classList.add("error"),""===i.value&&i.classList.add("error"),0):o.value===i.value||(n.classList.add("visible"),n.innerHTML=t.nls.resetPassword("notMatchingPassword"),o.classList.add("error"),i.classList.add("error"),0))&&t._kom.post("/api/auth/password-reset/?uidb64=".concat(e.uidb64,"&token=").concat(e.token),{password1:o.value,password2:i.value},null).then(a).catch((function(){n.classList.add("visible"),n.innerHTML=t.nls.resetPassword("serverError")}))};document.getElementById("reset-password-submit").addEventListener("click",s.bind(this),!1),i.addEventListener("keydown",(function(e){"Enter"===e.key&&s()})),document.getElementById("login-aside").addEventListener("click",this._loadLoginAside.bind(this),!1),document.getElementById("aside-expander").addEventListener("click",this._toggleAside.bind(this),!1)}},{key:"_drawUserMarker",value:function(){this.user.marker?this.user.marker.setLatLng(this.user):(this.user.type="user",this.user.marker=this._createMarker(this.user))}},{key:"_createMarker",value:function(e){var t=this,r=f.black;"spot"===e.type?r=f.green:"shop"===e.type?r=f.blue:"bar"===e.type?r=f.red:"user"===e.type&&(r=f.user);var n=window.L.marker([e.lat,e.lng],{icon:r}).on("click",(function(){t.map.flyTo([e.lat,e.lng],18)}));return e.dom&&n.bindPopup(e.dom),-1===["spot","shop","bar"].indexOf(e.type)&&n.addTo(this.map),n}},{key:"_markPopupFactory",value:function(e){var t=this;return new Promise((function(r){t._kom.getTemplate("/popup/".concat(e.type)).then((function(n){var o=document.createElement("DIV");o.appendChild(n);var i=e.user,a=c.stripDom(e.description)||t.nls.popup("".concat(e.type,"NoDesc")),s=new Intl.DateTimeFormat(t.nls.fullLang,{dateStyle:"long"}).format(new Date(e.creationDate));t.nls.markPopup(o,{type:e.type,name:e.name,user:i,rate:e.rate,desc:a,date:s});for(var l=o.querySelector("#".concat(e.type,"-rating")),u=0;u<e.rate+1;++u)l.children[u].classList.add("active");o.querySelector("#popup-social").parentNode.removeChild(o.querySelector("#popup-social")),o.querySelector("#popup-edit").parentNode.removeChild(o.querySelector("#popup-edit")),e.tooltip=window.L.tooltip({permanent:!0,direction:"center",className:"marker-tooltip",interactive:!0}).setContent(e.name).setLatLng(e),e.tooltip.addTo(t.map),r(o)}))}))}},{key:"_setMarkerLabels",value:function(e,t){for(var r=0;r<e.length;++r)t?e[r].tooltip.addTo(this.map):e[r].tooltip.removeFrom(this.map)}},{key:"map",get:function(){return this._map}},{key:"marks",get:function(){return this._marks}},{key:"user",get:function(){return this._user}},{key:"nls",get:function(){return this._lang}}],r&&C(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}(),A=P;window.BeerCrackerz=t.default}();